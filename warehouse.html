`; // ë™ ë°°ì¹˜ë„ ë°ì´í„° ì €ì¥/ë¡œë“œ (postMessage í†µì‹ ) const layoutIframeRef = React.useRef(null); const [layoutData, setLayoutData] = useState(null); const view3dCanvasRef = React.useRef(null); const view3dSceneRef = React.useRef(null); const view3dCtrlRef = React.useRef(null); const view3dWalkRef = React.useRef(null); const [walkHudVisible, setWalkHudVisible] = useState(false);// ì¹´ë©”ë¼/ê¸°ëŠ¥ ì œì–´ìš© useEffect(() => { // ì´ˆê¸° ë¡œë“œ: ì €ì¥ëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ íŒŒì‹± try { const saved = safeStorage.getItem('pbk_layout_data'); if (saved) setLayoutData(JSON.parse(saved)); } catch(ex) {} }, []); useEffect(() => { const handleLayoutMessage = (e) => { if (!e.data || !e.data.type) return; if (e.data.type === 'layoutClear') { try { safeStorage.removeItem('pbk_layout_data'); } catch(ex) {} setLayoutData(null); } if (e.data.type === 'layoutSave') { try { safeStorage.setItem('pbk_layout_data', e.data.data); setLayoutData(JSON.parse(e.data.data)); } catch(ex) {} } if (e.data.type === 'layoutReady') { try { const saved = safeStorage.getItem('pbk_layout_data'); if (saved && layoutIframeRef.current) { const parsed = JSON.parse(saved); if (parsed.R && parsed.R.length > 0) { layoutIframeRef.current.contentWindow.postMessage({ type: 'layoutLoad', data: saved }, '*'); } } } catch(ex) {} } }; window.addEventListener('message', handleLayoutMessage); return () => window.removeEventListener('message', handleLayoutMessage); }, []); // 3D ë·° ë Œë”ë§ const view3dKeyRef = React.useRef(null); useEffect(() => { if(activeTab !== 'view3d' || !layoutData || !view3dCanvasRef.current) return; if(view3dSceneRef.current) { view3dSceneRef.current.renderer.dispose(); view3dSceneRef.current = null; } if(view3dKeyRef.current) { if(view3dKeyRef.current.down){window.removeEventListener('keydown',view3dKeyRef.current.down);window.removeEventListener('keyup',view3dKeyRef.current.up);}else{window.removeEventListener('keydown',view3dKeyRef.current);}view3dKeyRef.current=null; } const loadAndInit = () => { const THREE = window.THREE; if(!THREE) return; const cv = view3dCanvasRef.current; if(!cv) return; const W = cv.clientWidth || 800, H = cv.clientHeight || 600; const S3D = 0.06, BX3D = 50, BY3D = 50; const toM = (px) => px / S3D / 1000; // ì‹œë¦¬ì¦ˆ ìƒ‰ìƒ â€” etcë¥¼ ë°ì€ ì²­ë¡ìƒ‰ìœ¼ë¡œ const SERIES_COLORS = {mx48:0xdc2626,mx16:0x2563eb,hsm:0xd97706,semi:0xeab308,spare:0x7c3aed,etc:0x06b6d4}; const rpx3d = (r) => { var w,h; if(r.t==='custom'){w=(r.cw||1000)*S3D;h=(r.ch||500)*S3D;} else{w=(r.t==='heavy'?1800:900)*S3D;h=450*S3D;} if(r.rot===true||r.rot===90||r.rot===270){var tmp=w;w=h;h=tmp;} return {w:w,h:h}; }; const scene = new THREE.Scene(); scene.background = new THREE.Color(0x0f172a); const camera = new THREE.PerspectiveCamera(50, W/H, 0.1, 200); const renderer = new THREE.WebGLRenderer({canvas:cv, antialias:true, preserveDrawingBuffer:true}); renderer.setSize(W, H); renderer.shadowMap.enabled = true; view3dSceneRef.current = {scene, camera, renderer}; scene.add(new THREE.AmbientLight(0xffffff, 0.5)); const dl = new THREE.DirectionalLight(0xffffff, 0.6); dl.position.set(20, 30, 10); dl.castShadow = true; scene.add(dl); // Floor (L-shape) const whw=toM(564),whh=toM(1890),jy=toM(774),rx=toM(982-BX3D); const floorShape = new THREE.Shape(); floorShape.moveTo(0,0);floorShape.lineTo(whw,0);floorShape.lineTo(whw,jy); floorShape.lineTo(rx,jy);floorShape.lineTo(rx,whh);floorShape.lineTo(0,whh); const floor = new THREE.Mesh(new THREE.ShapeGeometry(floorShape), new THREE.MeshStandardMaterial({color:0x1a2332,side:THREE.DoubleSide})); floor.rotation.x = -Math.PI/2; floor.receiveShadow = true; scene.add(floor); // Walls const wallH = 3.5; const pts = [[0,0],[whw,0],[whw,jy],[rx,jy],[rx,whh],[0,whh]]; for(let i=0;icW-10&&fontSize>8){fontSize-=2;ctx.font='bold '+fontSize+'px sans-serif';} ctx.fillStyle='rgba(0,0,0,0.6)'; var tw=Math.min(ctx.measureText(text).width+16,cW); ctx.fillRect((cW-tw)/2,4,tw,cH-8); ctx.fillStyle=color||'#ffffff'; ctx.textAlign='center';ctx.textBaseline='middle'; ctx.fillText(text,cW/2,cH/2); const tex=new THREE.CanvasTexture(c);tex.minFilter=THREE.LinearFilter; const sp=new THREE.Sprite(new THREE.SpriteMaterial({map:tex,depthWrite:false,depthTest:false})); sp.position.set(x,topY+0.15,z); var s=scale||1.2; sp.scale.set(s,s*cH/cW,1); scene.add(sp); } // ë™ ë Œë”ë§ if(layoutData.R) layoutData.R.forEach(r => { const rp=rpx3d(r),wM=toM(rp.w),dM=toM(rp.h); const xM=toM(r.x-BX3D),zM=toM(r.y-BY3D); const nm=(r.a||'').toUpperCase(); const isPillar=nm.indexOf('PILLAR')>=0||(r.a||'').indexOf('\uae30\ub465')>=0||(r.cc==='#6b7280')||(r.t==='custom'&&(r.cw||0)<=600&&(r.ch||0)<=600&&nm.indexOf('DOOR')<0&&nm.indexOf('PLT')<0); const isDoor=nm.indexOf('DOOR')>=0; const isPLT=nm.indexOf('PLT')>=0; // ë†’ì´ var hM=1.8;// ê¸°ë³¸ 1.8m if(isDoor)hM=2.0; else if(isPLT)hM=0.3; else if(isPillar)hM=1.8;// ê¸°ë‘¥ // ìƒ‰ìƒ var col=isDoor?0x10b981:isPillar?0x6b7280:isPLT?0xa16207:(SERIES_COLORS[r.s]||0x06b6d4); var op=isDoor?0.5:isPillar?0.95:isPLT?0.7:0.9; // DOOR: ì–‡ì€ í”„ë ˆì„ (ë†’ì´ 2m, ê¹Šì´ 0.05m) var geoW=wM,geoH=hM,geoD=dM; if(isDoor){geoD=Math.max(dM,0.05);geoW=Math.max(wM,0.05);} const mesh=new THREE.Mesh(new THREE.BoxGeometry(geoW,geoH,geoD),new THREE.MeshStandardMaterial({color:col,transparent:true,opacity:op})); mesh.position.set(xM+wM/2,geoH/2,zM+dM/2);mesh.castShadow=true;scene.add(mesh); // ì—£ì§€ (DOORì€ ë‘ê»ê²Œ) const edgeLine=new THREE.LineSegments(new THREE.EdgesGeometry(new THREE.BoxGeometry(geoW,geoH,geoD)),new THREE.LineBasicMaterial({color:isDoor?0x34d399:isPillar?0x94a3b8:col,transparent:true,opacity:isDoor?0.8:0.4})); edgeLine.position.copy(mesh.position);scene.add(edgeLine); // ë¼ë²¨ var lblScale=Math.max(wM*1.5,1); makeLabel(r.a,xM+wM/2,geoH,zM+dM/2,lblScale,isPillar?'#94a3b8':isDoor?'#34d399':isPLT?'#fbbf24':'#ffffff'); }); // ì¡´ â€” ì´ë¦„ë³„ ë†’ì´/ìƒ‰ìƒ const ZONE_CFG={ 'Packaging Foam':{h:1.8,c:0x22c55e,op:0.6}, 'Spare Part Box':{h:1.8,c:0x22c55e,op:0.6}, 'Injection':{h:0.3,c:0x3b82f6,op:0.3}, 'Stand':{h:1.8,c:0xf59e0b,op:0.9}, 'Tablet':{h:1.8,c:0xf59e0b,op:0.9}, 'Base Plate':{h:0.5,c:0x8b5cf6,op:0.6}, 'Yellow Box':{h:0.8,c:0xeab308,op:0.6}, '8160 Area':{h:3.5,c:0x94a3b8,op:0.5}, 'Barcode/ E6150 Area':{h:0.3,c:0x8b5cf6,op:0.5}, 'Defect Area':{h:0.01,c:0xef4444,op:0.2}, 'Test Area':{h:0.01,c:0x3b82f6,op:0.15}, 'Final QC Area':{h:0.01,c:0x3b82f6,op:0.15} }; if(layoutData.zones) layoutData.zones.forEach(z => { const wM=toM(z.w),dM=toM(z.h),xM=toM(z.x),zM=toM(z.y); var cfg=ZONE_CFG[z.n]; if(!cfg){ // ì´ë¦„ì— 'ê¸°ë‘¥' í¬í•¨ ì‹œ 1.8m ê¸°ë‘¥ìœ¼ë¡œ ì²˜ë¦¬ if(z.n.indexOf('\uae30\ub465')>=0) cfg={h:1.8,c:0x6b7280,op:0.95}; else cfg={h:0.3,c:0x22c55e,op:0.4}; } const mesh=new THREE.Mesh(new THREE.BoxGeometry(wM,cfg.h,dM),new THREE.MeshStandardMaterial({color:cfg.c,transparent:true,opacity:cfg.op})); mesh.position.set(xM+wM/2,cfg.h/2,zM+dM/2); scene.add(mesh); if(cfg.h>=0.1){ var lblScale=Math.max(wM,1.5); makeLabel(z.n,xM+wM/2,cfg.h,zM+dM/2,lblScale,'#ffffff'); } }); // Camera orbit + í™”ì‚´í‘œ í‚¤ ì´ë™ let isDrag=false,prevX=0,prevY=0,theta=0.8,phi=0.5,dist=35; const target=new THREE.Vector3(whw/2,0,whh/3); const updateCam=()=>{camera.position.set(target.x+dist*Math.sin(theta)*Math.cos(phi),dist*Math.sin(phi),target.z+dist*Math.cos(theta)*Math.cos(phi));camera.lookAt(target);}; updateCam(); cv.addEventListener('mousedown',e=>{isDrag=true;prevX=e.clientX;prevY=e.clientY;}); cv.addEventListener('mousemove',e=>{if(!isDrag)return; if(walkState.active){ // ì›Œí¬ìŠ¤ë£¨: ìí‚¤ ë°©í–¥ ì§ì ‘ íšŒì „ walkState.angle-=(e.clientX-prevX)*0.005; walkState.camPhi=Math.max(0.1,Math.min(1.2,walkState.camPhi+(e.clientY-prevY)*0.005)); prevX=e.clientX;prevY=e.clientY; } else { theta+=(e.clientX-prevX)*0.005;phi=Math.max(0.1,Math.min(1.5,phi+(e.clientY-prevY)*0.005));prevX=e.clientX;prevY=e.clientY;updateCam(); } }); window.addEventListener('mouseup',()=>{isDrag=false;}); cv.addEventListener('wheel',e=>{ if(walkState.active){ walkState.camDist=Math.max(2,Math.min(12,walkState.camDist+e.deltaY*0.01)); } else { dist=Math.max(5,Math.min(80,dist+e.deltaY*0.03));updateCam(); } e.preventDefault(); },{passive:false}); const onKey=e=>{ var kl=e.key.toLowerCase(); // ì›Œí¬ìŠ¤ë£¨ ëª¨ë“œ í‚¤ ì²˜ë¦¬ if(walkState.active){ if('wasdqe'.indexOf(kl)>=0){ walkState.keys[kl]=true;e.preventDefault();return; } if(e.key==='Escape'){ if(view3dCtrlRef.current)view3dCtrlRef.current.toggleWalk(); var btn=document.getElementById('btn3dWalk');if(btn)btn.classList.remove('bg-yellow-700'); e.preventDefault();return; } return; } // ì˜¤ë¹— ëª¨ë“œ: WASD + í™”ì‚´í‘œ ëª¨ë‘ ì§€ì› const sp=0.5; var fwdX=Math.sin(theta),fwdZ=Math.cos(theta); var rightX=Math.cos(theta),rightZ=-Math.sin(theta); if(kl==='a'||e.key==='ArrowLeft'){target.x-=rightX*sp;target.z-=rightZ*sp;updateCam();e.preventDefault();} else if(kl==='d'||e.key==='ArrowRight'){target.x+=rightX*sp;target.z+=rightZ*sp;updateCam();e.preventDefault();} else if(kl==='w'||e.key==='ArrowUp'){target.x-=fwdX*sp;target.z-=fwdZ*sp;updateCam();e.preventDefault();} else if(kl==='s'||e.key==='ArrowDown'){target.x+=fwdX*sp;target.z+=fwdZ*sp;updateCam();e.preventDefault();} }; const onKeyUp=e=>{ if(walkState.active){ var kl=e.key.toLowerCase(); if('wasdqe'.indexOf(kl)>=0){walkState.keys[kl]=false;e.preventDefault();} } }; window.addEventListener('keydown',onKey); window.addEventListener('keyup',onKeyUp); view3dKeyRef.current = {down:onKey, up:onKeyUp}; // â”€â”€ ì™¸ë¶€ ì œì–´ í•¨ìˆ˜ ë…¸ì¶œ â”€â”€ view3dCtrlRef.current = { setCamPreset: function(preset){ if(view3dWalkRef.current&&view3dWalkRef.current.active) return;// ì›Œí¬ìŠ¤ë£¨ ì¤‘ í”„ë¦¬ì…‹ ë¹„í™œì„± if(preset==='top'){theta=0;phi=1.5;dist=30;target.set(whw/2,0,whh/2);} else if(preset==='front'){theta=0;phi=0.3;dist=35;target.set(whw/2,0,whh);} else if(preset==='entrance'){theta=0.3;phi=0.4;dist=25;target.set(whw/2,0,2);} else if(preset==='side'){theta=Math.PI/2;phi=0.4;dist=35;target.set(0,0,whh/2);} else if(preset==='iso'){theta=0.8;phi=0.5;dist=35;target.set(whw/2,0,whh/3);} updateCam(); }, }; // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• // â–ˆâ–ˆ ì›Œí¬ìŠ¤ë£¨ ì‹œë®¬ë ˆì´ì…˜ (ìí‚¤ + íŒŒë ›íŠ¸ ë™ì„  ê²€ì¦) â–ˆâ–ˆ // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• // --- ì¶©ëŒ ë°•ìŠ¤ ìˆ˜ì§‘ (ëª¨ë“  ë™, ì¡´, ë²½) --- var colliders = []; if(layoutData.R) layoutData.R.forEach(function(r){ var nm=(r.a||'').toUpperCase(); var rp=rpx3d(r),wM=toM(rp.w),dM=toM(rp.h); var xM=toM(r.x-BX3D),zM=toM(r.y-BY3D); // DOORë§Œ í†µê³¼ ê°€ëŠ¥(passable), PLTëŠ” ì¶©ëŒ ëŒ€ìƒ var pass=(nm.indexOf('DOOR')>=0); colliders.push({minX:xM,maxX:xM+wM,minZ:zM,maxZ:zM+dM,name:r.a||'rack',passable:pass}); }); if(layoutData.zones) layoutData.zones.forEach(function(z){ var wM=toM(z.w),dM=toM(z.h),xM=toM(z.x),zM=toM(z.y); // ëª¨ë“  ë°°ì¹˜ëœ ì¡´ì„ ì¶©ëŒ ëŒ€ìƒìœ¼ë¡œ ë“±ë¡ colliders.push({minX:xM,maxX:xM+wM,minZ:zM,maxZ:zM+dM,name:z.n}); }); // ë²½ ì¶©ëŒ (Lì ê±´ë¬¼ ì™¸ê³½ â€” ë²—ì–´ë‚˜ì§€ ëª»í•˜ë„ë¡) var wallThick=0.05; // í•˜ë‹¨ë²½(z=0), ìš°ì¸¡ë²½(x=whw, zrx), ë‚´ë²½x=rx(z>jy), ìƒë‹¨ë²½z=whh(x=0||nm.indexOf('PILLAR')>=0||nm.indexOf('PLT')>=0||r.t==='custom') return; var rp=rpx3d(r),wM=toM(rp.w),dM=toM(rp.h); var xM=toM(r.x-BX3D)+wM/2,zM=toM(r.y-BY3D)+dM/2; rackInfos.push({x:xM,z:zM,name:r.a||'',series:r.s||'etc',bins:r.b||0}); }); // ê·¼ì ‘ ë™ ë¼ë²¨ (ìµœëŒ€ 3ê°œ) var rackLabels=[]; for(var ri=0;ri<3;ri++){ var rlc=document.createElement('canvas');rlc.width=512;rlc.height=64; var rlTex=new THREE.CanvasTexture(rlc);rlTex.minFilter=THREE.LinearFilter; var rlSp=new THREE.Sprite(new THREE.SpriteMaterial({map:rlTex,depthWrite:false,depthTest:false,transparent:true})); rlSp.scale.set(2.4,0.5,1);rlSp.visible=false;scene.add(rlSp); rackLabels.push({sprite:rlSp,canvas:rlc,texture:rlTex}); } function updateDynLabel(lb,text,color,x,y,z){ var ctx=lb.canvas.getContext('2d'); var cW=lb.canvas.width,cH=lb.canvas.height; ctx.clearRect(0,0,cW,cH); ctx.fillStyle='rgba(0,0,0,0.75)'; ctx.fillRect(8,6,cW-16,cH-12); // ìë™ í°íŠ¸ í¬ê¸° (í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë§ì¶¤) var fs=28; ctx.font='bold '+fs+'px monospace'; while(ctx.measureText(text).width>cW-24&&fs>12){fs-=2;ctx.font='bold '+fs+'px monospace';} ctx.textAlign='center';ctx.textBaseline='middle'; ctx.fillStyle=color;ctx.fillText(text,cW/2,cH/2); lb.texture.needsUpdate=true; lb.sprite.position.set(x,y,z); lb.sprite.visible=true; } // --- ì›Œí¬ìŠ¤ë£¨ ìƒíƒœ --- var walkState = { active: false, posX: 0, posZ: 0, angle: Math.PI/2, speed: 0.06, turnSpeed: 0.04, keys: {w:false,a:false,s:false,d:false,q:false,e:false}, colliding: false, nearestL: 999, nearestR: 999, nearestF: 999, collideName: '', camTheta: 0, camPhi: 0.35, camDist: 4, nearRack: '', // ë¯¸ë‹ˆë§µìš© ì°½ê³  ì¹˜ìˆ˜ (ë¯¸í„°) whw:whw, whh:whh, jy:jy, rx:rx, colliders: colliders }; view3dWalkRef.current = walkState; // ìí‚¤ì˜ AABB êµ¬í•˜ê¸° (ì›”ë“œì¢Œí‘œ) function getJackAABB(px,pz,ang){ // ìí‚¤+íŒŒë ›íŠ¸ í•©ì‚°: í­ 1.1m, ê¸¸ì´ 1.4m (íŒŒë ›íŠ¸1.1 + íŒí”„0.3) var hw=palletW/2+0.05, hd=(palletD+pumpD)/2+0.05;// ë°˜í­, ë°˜ê¸¸ì´ // íšŒì „ëœ 4ê°œ ì½”ë„ˆì˜ AABB var cos=Math.cos(ang),sin=Math.sin(ang); var corners=[[-hw,-hd],[hw,-hd],[hw,hd],[-hw,hd]]; var mnX=1e9,mxX=-1e9,mnZ=1e9,mxZ=-1e9; corners.forEach(function(c){ var rx=c[0]*cos-c[1]*sin+px; var rz=c[0]*sin+c[1]*cos+pz; if(rxmxX)mxX=rx; if(rzmxZ)mxZ=rz; }); return {minX:mnX,maxX:mxX,minZ:mnZ,maxZ:mxZ}; } // ì¶©ëŒ ê²€ì‚¬ function checkCollision(px,pz,ang){ var bb=getJackAABB(px,pz,ang); for(var i=0;ic.minX&&bb.minXc.minZ&&bb.minZ0&&d0&&d0.001&&u>=0&&u<=1) return t; return 999; } // ë ˆì´ vs AABB êµì°¨ (2D) function rayAABB(ox,oz,dir,box){ var tmin=-1e9,tmax=1e9; // X slab if(Math.abs(dir[0])>1e-8){ var t1=(box.minX-ox)/dir[0],t2=(box.maxX-ox)/dir[0]; if(t1>t2){var tmp=t1;t1=t2;t2=tmp;} tmin=Math.max(tmin,t1);tmax=Math.min(tmax,t2); } else { if(oxbox.maxX) return 999; } // Z slab if(Math.abs(dir[1])>1e-8){ var t3=(box.minZ-oz)/dir[1],t4=(box.maxZ-oz)/dir[1]; if(t3>t4){var tmp2=t3;t3=t4;t4=tmp2;} tmin=Math.max(tmin,t3);tmax=Math.min(tmax,t4); } else { if(ozbox.maxZ) return 999; } if(tmax<0||tmin>tmax) return 999; return tmin>0?tmin:tmax>0?tmax:999; } // ì›Œí¬ìŠ¤ë£¨ ì—…ë°ì´íŠ¸ (ë§¤ í”„ë ˆì„) function updateWalkthrough(){ if(!walkState.active)return; var k=walkState.keys; var newX=walkState.posX, newZ=walkState.posZ, newAng=walkState.angle; // íšŒì „ if(k.q) newAng+=walkState.turnSpeed; if(k.e) newAng-=walkState.turnSpeed; // ì „ì§„/í›„ì§„ var fwdX=Math.sin(newAng),fwdZ=Math.cos(newAng); if(k.w){newX+=fwdX*walkState.speed;newZ+=fwdZ*walkState.speed;} if(k.s){newX-=fwdX*walkState.speed;newZ-=fwdZ*walkState.speed;} // ì¢Œìš° ì´ë™ (ìŠ¤íŠ¸ë ˆì´í”„) var sideX=Math.cos(newAng),sideZ=-Math.sin(newAng); if(k.a){newX+=sideX*walkState.speed;newZ+=sideZ*walkState.speed;} if(k.d){newX-=sideX*walkState.speed;newZ-=sideZ*walkState.speed;} // ì¶©ëŒ ê²€ì‚¬ (ìŠ¬ë¼ì´ë”© + ë¼ì„ íƒˆì¶œ) var col=checkCollision(newX,newZ,newAng); if(!col.hit){ // ì´ë™ ì„±ê³µ walkState.colliding=false;walkState.collideName=''; walkState.posX=newX;walkState.posZ=newZ;walkState.angle=newAng; jackBoundVis.material.color.setHex(0x00ff00);jackBoundVis.material.opacity=0.2; } else { // Xì¶•ë§Œ ì´ë™ ì‹œë„ (ë²½ì„ ë”°ë¼ ë¯¸ë„ëŸ¬ì§) var colX=checkCollision(newX,walkState.posZ,newAng); var colZ=checkCollision(walkState.posX,newZ,newAng); if(!colX.hit){ walkState.posX=newX;walkState.angle=newAng; walkState.colliding=false;walkState.collideName=''; jackBoundVis.material.color.setHex(0xffaa00);jackBoundVis.material.opacity=0.3; } else if(!colZ.hit){ walkState.posZ=newZ;walkState.angle=newAng; walkState.colliding=false;walkState.collideName=''; jackBoundVis.material.color.setHex(0xffaa00);jackBoundVis.material.opacity=0.3; } else { // ë¼ì„ ìƒíƒœ: ê°€ì¥ ê°€ê¹Œìš´ ì¥ì• ë¬¼ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ë°€ì–´ë‚´ê¸° ì‹œë„ walkState.angle=newAng;// íšŒì „ì€ í•­ìƒ í—ˆìš© var bb=getJackAABB(walkState.posX,walkState.posZ,newAng); var pushX=0,pushZ=0,pushCount=0; for(var ci=0;cic.minX&&bb.minXc.minZ&&bb.minZ0){ pushX/=pushCount;pushZ/=pushCount; var pushSpd=walkState.speed*0.8; var tryX=walkState.posX+pushX*pushSpd; var tryZ=walkState.posZ+pushZ*pushSpd; if(!checkCollision(tryX,tryZ,newAng).hit){ walkState.posX=tryX;walkState.posZ=tryZ; walkState.colliding=false;walkState.collideName=''; jackBoundVis.material.color.setHex(0xff8800);jackBoundVis.material.opacity=0.3; } else { walkState.colliding=true;walkState.collideName=col.name; jackBoundVis.material.color.setHex(0xff0000);jackBoundVis.material.opacity=0.4; } } else { walkState.colliding=true;walkState.collideName=col.name; jackBoundVis.material.color.setHex(0xff0000);jackBoundVis.material.opacity=0.4; } } } // ëª¨ë¸ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ jackGroup.position.set(walkState.posX,0,walkState.posZ); jackGroup.rotation.y=walkState.angle; // í´ë¦¬ì–´ëŸ°ìŠ¤ ê³„ì‚° var cl=calcClearance(walkState.posX,walkState.posZ,walkState.angle); walkState.nearestL=cl.l;walkState.nearestR=cl.r;walkState.nearestF=cl.f; // í´ë¦¬ì–´ëŸ°ìŠ¤ ë¼ì¸ ì—…ë°ì´íŠ¸ var cos=Math.cos(walkState.angle),sin=Math.sin(walkState.angle); var leftDir=[-cos,-sin],rightDir=[cos,sin]; var hw=palletW/2+0.05; var lx=walkState.posX+leftDir[0]*hw,lz=walkState.posZ+leftDir[1]*hw; var rx2=walkState.posX+rightDir[0]*hw,rz2=walkState.posZ+rightDir[1]*hw; var dL=Math.min(cl.l,3),dR=Math.min(cl.r,3); clearLineL.geometry.dispose(); clearLineL.geometry=new THREE.BufferGeometry().setFromPoints([ new THREE.Vector3(lx,0.3,lz), new THREE.Vector3(lx+leftDir[0]*dL,0.3,lz+leftDir[1]*dL) ]); clearLineL.material.color.setHex(cl.l<0.3?0xff0000:cl.l<0.5?0xffaa00:0x00ff00); clearLineR.geometry.dispose(); clearLineR.geometry=new THREE.BufferGeometry().setFromPoints([ new THREE.Vector3(rx2,0.3,rz2), new THREE.Vector3(rx2+rightDir[0]*dR,0.3,rz2+rightDir[1]*dR) ]); clearLineR.material.color.setHex(cl.r<0.3?0xff0000:cl.r<0.5?0xffaa00:0x00ff00); // ì „ë°© í´ë¦¬ì–´ëŸ°ìŠ¤ ë¼ì¸ var fwdDirV=[Math.sin(walkState.angle),Math.cos(walkState.angle)]; var fEdge=palletD/2+0.1; var fx=walkState.posX+fwdDirV[0]*fEdge,fz=walkState.posZ+fwdDirV[1]*fEdge; var dF=Math.min(cl.f,3); clearLineF.geometry.dispose(); clearLineF.geometry=new THREE.BufferGeometry().setFromPoints([ new THREE.Vector3(fx,0.3,fz), new THREE.Vector3(fx+fwdDirV[0]*dF,0.3,fz+fwdDirV[1]*dF) ]); clearLineF.material.color.setHex(cl.f<0.3?0xff0000:cl.f<0.5?0xffaa00:0x00ff00); // 3D ê±°ë¦¬ ë¼ë²¨ ì—…ë°ì´íŠ¸ var fmtD=function(d){return d>=100?'âˆ':Math.round(d*1000)+'mm';}; var clrHex=function(d){return d<0.3?'#f87171':d<0.5?'#fbbf24':'#4ade80';}; updateDynLabel(labelL,'â—€ '+fmtD(cl.l),clrHex(cl.l),lx+leftDir[0]*Math.min(dL,1.5),0.6,lz+leftDir[1]*Math.min(dL,1.5)); updateDynLabel(labelR,fmtD(cl.r)+' â–¶',clrHex(cl.r),rx2+rightDir[0]*Math.min(dR,1.5),0.6,rz2+rightDir[1]*Math.min(dR,1.5)); updateDynLabel(labelF,'â–² '+fmtD(cl.f),clrHex(cl.f),fx+fwdDirV[0]*Math.min(dF,1.5),0.6,fz+fwdDirV[1]*Math.min(dF,1.5)); // ê·¼ì ‘ ë™ ì •ë³´ í‘œì‹œ (2m ì´ë‚´) var nearRacks=[]; rackInfos.forEach(function(ri){ var dx=ri.x-walkState.posX,dz=ri.z-walkState.posZ; var dist2=Math.sqrt(dx*dx+dz*dz); if(dist2<2.5) nearRacks.push({info:ri,dist:dist2}); }); nearRacks.sort(function(a,b){return a.dist-b.dist;}); for(var rli=0;rli<3;rli++){ if(rli0?(SERIES_NAMES[nearRacks[0].info.series]||nearRacks[0].info.series):''; // ì¹´ë©”ë¼: 3ì¸ì¹­ íŒ”ë¡œìš° (ë§ˆìš°ìŠ¤ë¡œ ì‹œì  ë³€ê²½ ê°€ëŠ¥) var camH=walkState.camDist*Math.sin(walkState.camPhi); var camHoriz=walkState.camDist*Math.cos(walkState.camPhi); var totalAng=walkState.angle; var behindX=walkState.posX-Math.sin(totalAng)*camHoriz; var behindZ=walkState.posZ-Math.cos(totalAng)*camHoriz; camera.position.set(behindX,camH,behindZ); camera.lookAt(walkState.posX,0.5,walkState.posZ); } // ì›Œí¬ìŠ¤ë£¨ ì‹œì‘ ìœ„ì¹˜: ì²« ë²ˆì§¸ DOOR ì•„ë˜ í†µë¡œ ì¤‘ì•™ var startDoor=null; if(layoutData.R){ var allDoors2=layoutData.R.filter(function(r){return (r.a||'').toUpperCase().indexOf('DOOR')>=0;}); startDoor=allDoors2.length>0?allDoors2.reduce(function(a,b){return a.y{if(!view3dSceneRef.current)return;requestAnimationFrame(animate);updateWalkthrough();renderer.render(scene,camera);}; animate(); }; if(!window.THREE){const sc=document.createElement('script');sc.src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';sc.onload=loadAndInit;document.head.appendChild(sc);}else{loadAndInit();} return () => { if(view3dKeyRef.current){window.removeEventListener('keydown',view3dKeyRef.current.down);window.removeEventListener('keyup',view3dKeyRef.current.up);view3dKeyRef.current=null;} if(view3dWalkRef.current){view3dWalkRef.current.active=false;view3dWalkRef.current=null;} if(view3dSceneRef.current){view3dSceneRef.current.renderer.dispose();view3dSceneRef.current=null;} }; }, [activeTab, layoutData]); const [rackDetailModal, setRackDetailModal] = useState(null); // 'items', 'stock', 'weight', 'bins' // ë°±ì—… ëª¨ë‹¬ const [showBackupModal, setShowBackupModal] = useState(false); const [backupData, setBackupData] = useState(''); // ëª¨ë¸ë³„/Sub-component ìƒì‚° ê°€ëŠ¥ ëŒ€ìˆ˜ ìƒì„¸ ëª¨ë‹¬ const [showModelDetailModal, setShowModelDetailModal] = useState(null); // 'excess', 'normal', 'caution', 'urgent' const [showSubcomDetailModal, setShowSubcomDetailModal] = useState(null); const [showShortageDetailModal, setShowShortageDetailModal] = useState(null); // 'critical', 'high', 'withPO', 'noPO' // 'excess', 'normal', 'caution', 'urgent' // Cycle Time ê·¸ë˜í”„ ì„¤ì • const [showGraphModal, setShowGraphModal] = useState(false); const [graphDateRange, setGraphDateRange] = useState({ start: '', end: '' }); const [graphViewType, setGraphViewType] = useState('monthly'); // 'monthly', 'daily', 'custom' const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7)); // YYYY-MM // TO DO ë·° ëª¨ë“œ const [todoViewMode, setTodoViewMode] = useState('list'); // 'list' or 'calendar' // URL íŒŒë¼ë¯¸í„° ì§€ì› const urlParams = useMemo(() => { try { return new URLSearchParams(window.location.search); } catch(e) { return new URLSearchParams(); } }, []); const [locateSearch, setLocateSearch] = useState(urlParams.get('q') || ''); const [locateQuery, setLocateQuery] = useState(urlParams.get('q') || ''); const [calendarMonth, setCalendarMonth] = useState(new Date()); const [selectedCalendarTodo, setSelectedCalendarTodo] = useState(null); const [selectedCategory, setSelectedCategory] = useState(null); // ì˜¨ìŠµë„ Excel ë‚´ë³´ë‚´ê¸° ëª¨ë‹¬ const [showTempHumidityExportModal, setShowTempHumidityExportModal] = useState(false); // ì˜¨ìŠµë„ ê´€ë¦¬ ìƒíƒœ const [tempHumidityData, setTempHumidityData] = useState(() => { const saved = safeStorage.getItem('pbk_temp_humidity_data'); const savedData = saved ? JSON.parse(saved) : {}; // ê³¼ê±° ë°ì´í„°ì™€ ì‚¬ìš©ì ì…ë ¥ ë°ì´í„° ë³‘í•© (ì‚¬ìš©ì ì…ë ¥ì´ ìš°ì„ ) return { ...HISTORICAL_TEMP_HUMIDITY_DATA, ...savedData }; }); const [tempHumidityMonth, setTempHumidityMonth] = useState(() => { const now = new Date(); return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`; }); const [tempHumidityRecorder, setTempHumidityRecorder] = useState(() => { return safeStorage.getItem('pbk_temp_humidity_recorder') || 'JM. Jung'; }); // ì‚­ì œ í™•ì¸ ëª¨ë‹¬ const [deleteConfirm, setDeleteConfirm] = useState({ show: false, type: '', id: null, text: '', count: 0 }); // ========== v15 ì‹ ê·œ ê¸°ëŠ¥ ========== // ë‹¤í¬ ëª¨ë“œ const [darkMode, setDarkMode] = useState(() => { const saved = safeStorage.getItem('pbk_dark_mode'); return saved ? JSON.parse(saved) : false; }); // ì•Œë¦¼ ì„¼í„° const [showNotificationCenter, setShowNotificationCenter] = useState(false); const [notifications, setNotifications] = useState(() => { const saved = safeStorage.getItem('pbk_notifications'); return saved ? JSON.parse(saved) : []; }); // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ (ìë™ ì €ì¥ í‘œì‹œ) const [toasts, setToasts] = useState([]); // ë¡œë”© ìƒíƒœ (loadingTextë§Œ ì¶”ê°€, isLoadingì€ ê¸°ì¡´ ê²ƒ ì‚¬ìš©) const [loadingText, setLoadingText] = useState(''); // ë°ì´í„° ì—…ë¡œë“œ íˆìŠ¤í† ë¦¬ const [dataHistory, setDataHistory] = useState(() => { const saved = safeStorage.getItem('pbk_data_history'); return saved ? JSON.parse(saved) : []; }); const [showHistoryModal, setShowHistoryModal] = useState(false); // ë‹¨ì¶•í‚¤ ë„ì›€ë§ ëª¨ë‹¬ const [showShortcutHelp, setShowShortcutHelp] = useState(false); // ê³µê°„ ìµœì í™” ë¦¬í¬íŠ¸ ëª¨ë‹¬ const [showSpaceOptimizationModal, setShowSpaceOptimizationModal] = useState(false); const [showSeriesCards, setShowSeriesCards] = useState(false); // ê¸°ë³¸ ì ‘í˜ const [showDetailSection, setShowDetailSection] = useState(false); // ìƒì„¸ ì •ë³´ ì ‘í˜ // ========== KPI ê´€ë¦¬ ========== // GR Cancel ê¸°ë³¸ ë°ì´í„° (Movement Type 102 ê¸°ì¤€) // GR Cancel ê¸°ë³¸ê°’ (SUM ì‹œíŠ¸ ê¸°ì¤€ í™•ì • ë°ì´í„°) const DEFAULT_GR_CANCEL_DATA = { '2024-01': 1, '2024-02': 0, '2024-03': 0, '2024-04': 0, '2024-05': 0, '2024-06': 0, '2024-07': 0, '2024-08': 0, '2024-09': 0, '2024-10': 1, '2024-11': 0, '2024-12': 0, '2025-01': 0, '2025-02': 0, '2025-03': 0, '2025-04': 0, '2025-05': 0, '2025-06': 0, '2025-07': 0, '2025-08': 0, '2025-09': 1, '2025-10': 0, '2025-11': 0, '2025-12': 0, '2026-01': 0 }; // GR Qty ê¸°ë³¸ê°’ (SUM ì‹œíŠ¸ ê¸°ì¤€ í™•ì • ë°ì´í„°) - ì—‘ì…€ ì—…ë¡œë“œ ì‹œ ë®ì–´ì”Œì›Œì§ const DEFAULT_GR_CANCEL_QTY = { '2024-01': 91, '2024-02': 201, '2024-03': 123, '2024-04': 68, '2024-05': 65, '2024-06': 110, '2024-07': 114, '2024-08': 85, '2024-09': 107, '2024-10': 108, '2024-11': 167, '2024-12': 138, '2025-01': 83, '2025-02': 0, '2025-03': 0, '2025-04': 0, '2025-05': 0, '2025-06': 0, '2025-07': 0, '2025-08': 0, '2025-09': 0, '2025-10': 0, '2025-11': 0, '2025-12': 0, '2026-01': 83 }; const [kpiData, setKpiData] = useState(() => { const saved = safeStorage.getItem('pbk_kpi_data'); if (saved) { const parsed = JSON.parse(saved); return { grCancel: { ...DEFAULT_GR_CANCEL_DATA, ...parsed.grCancel }, grCancelQty: { ...DEFAULT_GR_CANCEL_QTY, ...parsed.grCancelQty }, inventoryAdjust: parsed.inventoryAdjust || {} }; } return { grCancel: DEFAULT_GR_CANCEL_DATA, grCancelQty: DEFAULT_GR_CANCEL_QTY, inventoryAdjust: {} }; }); // v17: GR Cancel ì—‘ì…€ ì—…ë¡œë“œ ìƒíƒœ const [grCancelUploadStatus, setGrCancelUploadStatus] = useState(null); // null | 'loading' | 'success' | 'error' const [grCancelUploadMsg, setGrCancelUploadMsg] = useState(''); const [inventoryLossUploadStatus, setInventoryLossUploadStatus] = useState(null); const [inventoryLossUploadMsg, setInventoryLossUploadMsg] = useState(''); const [showKpiInputModal, setShowKpiInputModal] = useState(false); const [kpiInputMonth, setKpiInputMonth] = useState(new Date().toISOString().slice(0, 7)); const [kpiInputType, setKpiInputType] = useState('grCancel'); // 'grCancel' or 'inventoryAdjust' const [kpiSelectedYear, setKpiSelectedYear] = useState(new Date().getFullYear()); // KPI ì—°ë„ ì„ íƒ // KPI ì ìˆ˜ ê³„ì‚° í•¨ìˆ˜ const KPI_SCORE_TABLE = { grCancel: [ { score: 100, max: 0 }, { score: 90, max: 1 }, { score: 80, max: 2 }, { score: 70, max: 3 }, { score: 60, max: 4 }, { score: 50, max: 5 }, { score: 40, max: 6 }, { score: 30, max: 7 }, { score: 20, max: 8 }, { score: 10, max: 9 }, ], inventoryAdjust: [ { score: 100, max: 0.02 }, { score: 90, max: 0.04 }, { score: 80, max: 0.064 }, { score: 70, max: 0.08 }, { score: 60, max: 0.10 }, { score: 50, max: 0.12 }, { score: 40, max: 0.14 }, { score: 30, max: 0.16 }, { score: 20, max: 0.18 }, { score: 10, max: 0.20 }, ], kittingLeadTime: [ { score: 100, max: 2 }, { score: 90, max: 2.5 }, { score: 80, max: 3 }, { score: 70, max: 4 }, { score: 60, max: 4.5 }, { score: 50, max: 5 }, { score: 40, max: 5.5 }, { score: 30, max: 6 }, { score: 20, max: 6.5 }, { score: 10, max: 7 }, ], }; const calculateKpiScore = (type, value) => { if (value === null || value === undefined) return null; const table = KPI_SCORE_TABLE[type]; if (!table) return null; for (const row of table) { if (value <= row.max) return row.score; } return 10; // ìµœì € ì ìˆ˜ }; // ========== ìƒíƒœë³„ ìƒ‰ìƒ ì •ì˜ (ì¼ê´€ì„±) ========== const STATUS_COLORS = { danger: { bg: 'bg-red-100', text: 'text-red-700', border: 'border-red-500', badge: 'bg-red-500' }, warning: { bg: 'bg-amber-100', text: 'text-amber-700', border: 'border-amber-500', badge: 'bg-amber-500' }, success: { bg: 'bg-emerald-100', text: 'text-emerald-700', border: 'border-emerald-500', badge: 'bg-emerald-500' }, info: { bg: 'bg-blue-100', text: 'text-blue-700', border: 'border-blue-500', badge: 'bg-blue-500' }, neutral: { bg: 'bg-gray-100', text: 'text-gray-700', border: 'border-gray-500', badge: 'bg-gray-500' } }; // safeStorageì— ì €ì¥ useEffect(() => { safeStorage.setItem('pbk_pick_cycles', JSON.stringify(pickCycles)); }, [pickCycles]); // ë§ˆìš´íŠ¸ ì‹œ ì™„ë£Œëœ pickCyclesì˜ cycleMinì„ ì˜ì—…ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ì¬ê³„ì‚° useEffect(() => { setPickCycles(prev => { let changed = false; const updated = prev.map(p => { if (p.status === 'completed' && p.startTime && p.completed) { const oldMin = p.cycleMin || 0; // ê°„ë‹¨í•œ ì˜ì—…ì‹œê°„ ê³„ì‚° (calculateWorkingMinutesê°€ ì•„ì§ ì•ˆ ë¨ â†’ ì¸ë¼ì¸) const start = new Date(p.startTime); const end = new Date(p.completed); if (!isNaN(start.getTime()) && !isNaN(end.getTime()) && end > start) { let totalMin = 0; const cur = new Date(start); while (cur < end) { const krTime = new Date(cur.toLocaleString('en-US', { timeZone: 'Asia/Seoul' })); const day = krTime.getDay(); const h = krTime.getHours(); const m = krTime.getMinutes(); const t = h + m / 60; const dateStr = krTime.getFullYear() + '-' + String(krTime.getMonth()+1).padStart(2,'0') + '-' + String(krTime.getDate()).padStart(2,'0'); const isWorkday = day >= 1 && day <= 5 && !KR_HOLIDAYS.has(dateStr); const isWorkHour = h >= 7 && h < 16; const isLunch = t >= 12.5 && t < 13.5; if (isWorkday && isWorkHour && !isLunch) totalMin++; cur.setTime(cur.getTime() + 60000); } if (Math.abs(totalMin - oldMin) > 5) { changed = true; return { ...p, cycleMin: totalMin }; } } } return p; }); return changed ? updated : prev; }); }, []); // eslint-disable-line react-hooks/exhaustive-deps useEffect(() => { safeStorage.setItem('pbk_receive_cycles', JSON.stringify(receiveCycles)); }, [receiveCycles]); useEffect(() => { safeStorage.setItem('pbk_kitting_data', JSON.stringify(kittingData)); }, [kittingData]); // LT ì¬ê³„ì‚°ì€ useState ì´ˆê¸°í™”ì—ì„œ ì²˜ë¦¬ë¨ useEffect(() => { safeStorage.setItem('pbk_todo_list', JSON.stringify(todoList)); }, [todoList]); // v15: ë‹¤í¬ëª¨ë“œ ì €ì¥ useEffect(() => { safeStorage.setItem('pbk_dark_mode', JSON.stringify(darkMode)); }, [darkMode]); // v15: ì•Œë¦¼ ì €ì¥ useEffect(() => { safeStorage.setItem('pbk_notifications', JSON.stringify(notifications)); }, [notifications]); // v15: ë°ì´í„° íˆìŠ¤í† ë¦¬ ì €ì¥ useEffect(() => { safeStorage.setItem('pbk_data_history', JSON.stringify(dataHistory)); }, [dataHistory]); // v15: KPI ë°ì´í„° ì €ì¥ useEffect(() => { safeStorage.setItem('pbk_kpi_data', JSON.stringify(kpiData)); }, [kpiData]); // ì˜¨ìŠµë„ ë°ì´í„° ì €ì¥ useEffect(() => { safeStorage.setItem('pbk_temp_humidity_data', JSON.stringify(tempHumidityData)); }, [tempHumidityData]); useEffect(() => { safeStorage.setItem('pbk_temp_humidity_recorder', tempHumidityRecorder); }, [tempHumidityRecorder]); // ë§ˆê° ì„ë°•/ë‹¹ì¼ í• ì¼ ì²´í¬ ë° ì•Œë¦¼ useEffect(() => { const checkDueSoonTodos = () => { const today = new Date().toISOString().split('T')[0]; const tomorrow = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0]; const dueSoon = todoList.filter(todo => !todo.completed && todo.dueDate && (todo.dueDate === today || todo.dueDate === tomorrow || todo.dueDate < today) ); setDueSoonTodos(dueSoon); if (dueSoon.length > 0) { setShowDueSoonAlert(true); document.title = `(${dueSoon.length}) âš ï¸ Warehouse Management`; } else { document.title = 'Warehouse Management'; } }; checkDueSoonTodos(); if ('Notification' in window) { setNotificationPermission(Notification.permission); } }, [todoList]); // Bin 100% ì•Œë¦¼ í™•ì¸ useEffect(() => { const checkFullBins = () => { const full = []; rackSummary.forEach(rack => { // ê° ë™ì˜ ëª¨ë“  Bin í™•ì¸ const rackBins = {}; inventoryData.filter(item => item.rack === rack.id).forEach(item => { const bin = item.bin; if (!rackBins[bin]) { rackBins[bin] = { count: 0, maxCount: 10 }; // ì„ì‹œë¡œ Binë‹¹ ìµœëŒ€ 10ê°œ í’ˆëª© } rackBins[bin].count++; }); // 100% ì°¬ Bin ì°¾ê¸° (ì„ì‹œ ê¸°ì¤€: í’ˆëª© ìˆ˜ê°€ 10ê°œ ì´ìƒì´ë©´ 100%) Object.entries(rackBins).forEach(([bin, data]) => { if (data.count >= 10) { full.push({ rack: rack.id, bin, count: data.count }); } }); }); setFullBins(full); }; if (inventoryData.length > 0) { checkFullBins(); } }, [inventoryData, rackSummary]); // íƒ­ì´ ë³´ì¼ ë•Œ ê¹œë¹¡ì„ íš¨ê³¼ (ë§ˆê° ì„ë°• í•­ëª© ìˆì„ ë•Œ) useEffect(() => { let interval; const today = new Date().toISOString().split('T')[0]; const urgentCount = todoList.filter(todo => !todo.completed && todo.dueDate && (todo.dueDate === today || todo.dueDate < today) ).length; if (urgentCount > 0) { let isAlert = true; interval = setInterval(() => { if (isAlert) { document.title = `ğŸš¨ (${urgentCount}) ë§ˆê° ì„ë°•!`; } else { document.title = `â° Warehouse Management`; } isAlert = !isAlert; }, 1500); } return () => { if (interval) clearInterval(interval); }; }, [todoList]); // ì˜¨ìŠµë„ ë¯¸ì…ë ¥ ì•Œë¦¼ ìƒíƒœ const [showTempAlert, setShowTempAlert] = useState(false); const [showUploadAlert, setShowUploadAlert] = useState(false); const [showOpenPOAlert, setShowOpenPOAlert] = useState(false); // ì˜¨ìŠµë„ ë¯¸ì…ë ¥ ì²´í¬ (í‰ì¼ ì˜¤í›„ 2ì‹œ ì´í›„ ~ í‡´ê·¼ ì „) useEffect(() => { const checkAlerts = () => { const now = new Date(); const dayOfWeek = now.getDay(); const currentHour = now.getHours(); // ì£¼ë§ì´ë©´ ì²´í¬ ì•ˆí•¨ if (dayOfWeek === 0 || dayOfWeek === 6) return; // ê³µíœ´ì¼ì´ë©´ ì²´í¬ ì•ˆí•¨ const todayStr = now.toISOString().split('T')[0]; if (KR_HOLIDAYS.has(todayStr)) return; // ì˜¤í›„ 2ì‹œ(14ì‹œ) ì´í›„ë©´ ì˜¨ìŠµë„ ì²´í¬ if (currentHour >= 14) { const today = now.toISOString().split('T')[0]; const todayData = tempHumidityData[today]; const hasInput = todayData && (todayData.temp || todayData.humidity); setShowTempAlert(!hasInput); } // ì˜¤ì „ 9ì‹œ ì´í›„ë©´ ì¬ê³ /Open PO ì—…ë¡œë“œ ì²´í¬ (ì˜¤ëŠ˜ ì—…ë¡œë“œ ì—¬ë¶€) if (currentHour >= 9) { const krNow = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Seoul' })); const todayISO = krNow.getFullYear() + '-' + String(krNow.getMonth()+1).padStart(2,'0') + '-' + String(krNow.getDate()).padStart(2,'0'); // dataHistoryì—ì„œ ì˜¤ëŠ˜ stock ì—…ë¡œë“œ ê¸°ë¡ í™•ì¸ const toKRDateStr = (ts) => { try { const d = new Date(ts); const kr = new Date(d.getTime() + 9 * 60 * 60 * 1000); return kr.toISOString().slice(0, 10); } catch(e) { return ''; } }; const stockUploadedToday = dataHistory.some(h => h.type === 'stock' && h.timestamp && toKRDateStr(h.timestamp) === todayISO ); // dataHistoryì—ì„œ ì˜¤ëŠ˜ openPO ì—…ë¡œë“œ ê¸°ë¡ í™•ì¸ const poUploadedToday = dataHistory.some(h => h.type === 'openPO' && h.timestamp && toKRDateStr(h.timestamp) === todayISO ); setShowUploadAlert(!stockUploadedToday); setShowOpenPOAlert(!poUploadedToday); } else { setShowUploadAlert(false); setShowOpenPOAlert(false); } }; checkAlerts(); const interval = setInterval(checkAlerts, 60000); return () => clearInterval(interval); }, [tempHumidityData, inventoryData, openPOData, dataHistory]); // TO DO ìˆ˜ì • í•¨ìˆ˜ const updateTodo = (id, field, value) => { setTodoList(prev => prev.map(todo => todo.id === id ? {...todo, [field]: value} : todo )); }; // TO DO ì‚­ì œ í™•ì¸ const confirmDeleteTodo = () => { setTodoList(prev => prev.filter(t => t.id !== deleteConfirm.id)); setDeleteConfirm({ show: false, type: '', id: null, text: '', count: 0 }); }; useEffect(() => { safeStorage.setItem('pbk_rack_config', JSON.stringify(rackConfig)); }, [rackConfig]); useEffect(() => { safeStorage.setItem('pbk_weight_data', JSON.stringify(weightData)); }, [weightData]); // í•„í„° ìƒíƒœ safeStorageì— ì €ì¥ (C2 ê°œì„ ) useEffect(() => { safeStorage.setItem('pbk_filter_inventorySortBy', inventorySortBy); safeStorage.setItem('pbk_filter_inventorySortOrder', inventorySortOrder); }, [inventorySortBy, inventorySortOrder]); useEffect(() => { safeStorage.setItem('pbk_filter_weightSortBy', weightSortBy); safeStorage.setItem('pbk_filter_weightSortOrder', weightSortOrder); }, [weightSortBy, weightSortOrder]); useEffect(() => { safeStorage.setItem('pbk_filter_pickSortBy', pickSortBy); safeStorage.setItem('pbk_filter_pickSortOrder', pickSortOrder); safeStorage.setItem('pbk_filter_pickFilterModel', pickFilterModel); safeStorage.setItem('pbk_filter_pickFilterStatus', pickFilterStatus); safeStorage.setItem('pbk_filter_pickFilterWorker', pickFilterWorker); safeStorage.setItem('pbk_filter_pickFilterUrgent', pickFilterUrgent); }, [pickSortBy, pickSortOrder, pickFilterModel, pickFilterStatus, pickFilterWorker, pickFilterUrgent]); useEffect(() => { safeStorage.setItem('pbk_filter_receiveSortBy', receiveSortBy); safeStorage.setItem('pbk_filter_receiveSortOrder', receiveSortOrder); safeStorage.setItem('pbk_filter_receiveFilterStatus', receiveFilterStatus); }, [receiveSortBy, receiveSortOrder, receiveFilterStatus]); // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (Ctrl+N: ìƒˆ ì…ê³ , Ctrl+K: ìƒˆ Kitting, Ctrl+D: ëŒ€ì‹œë³´ë“œ) useEffect(() => { const handleKeyDown = (e) => { // input, textareaì—ì„œëŠ” ë‹¨ì¶•í‚¤ ë¬´ì‹œ if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return; if (e.ctrlKey || e.metaKey) { switch(e.key.toLowerCase()) { case 'm': e.preventDefault(); setActiveTab('receive'); setShowReceiveModal(true); break; case 'k': e.preventDefault(); setActiveTab('kitting'); setShowKittingModal(true); break; case 'd': e.preventDefault(); setActiveTab('dashboard'); break; case 'b': e.preventDefault(); setShowBackupModal(true); break; case '/': case '?': e.preventDefault(); setShowShortcutHelp(true); break; case 'n': e.preventDefault(); setShowNotificationCenter(true); break; } } // ESCë¡œ ëª¨ë‹¬ ë‹«ê¸° if (e.key === 'Escape') { setShowShortcutHelp(false); setShowNotificationCenter(false); setShowSpaceOptimizationModal(false); setShowHistoryModal(false); } }; window.addEventListener('keydown', handleKeyDown); return () => window.removeEventListener('keydown', handleKeyDown); }, []); // ë¶ˆì¶œ Cycle ë‹´ë‹¹ì ë³€ê²½ ì‹œ Kitting ë‹´ë‹¹ì ìë™ ë™ê¸°í™” + Lead Time ì¬ê³„ì‚° useEffect(() => { if (pickCycles.length === 0 || kittingData.length === 0) return; // Production Orderë³„ ë¶ˆì¶œ ì •ë³´ ë§µ ìƒì„± const pickInfoMap = {}; pickCycles.forEach(p => { const po = p.productionOrder || p.orderId; if (po) { pickInfoMap[po] = { worker: p.worker, startTime: p.startTime, completed: p.completed, cycleMin: p.cycleMin, status: p.status }; } }); // Kitting ë‹´ë‹¹ì ë™ê¸°í™” + Lead Time ì¬ê³„ì‚° (ì™„ë£Œëœ ê²ƒë§Œ) let hasChanges = false; const updatedKitting = kittingData.map(k => { const pickInfo = pickInfoMap[k.productionOrder]; if (!pickInfo) return k; let updated = { ...k }; // ë‹´ë‹¹ì ë™ê¸°í™” if (pickInfo.worker && k.worker !== pickInfo.worker) { updated.worker = pickInfo.worker; hasChanges = true; } // ì™„ë£Œëœ Kittingì˜ Lead Time ì¬ê³„ì‚° (ì˜ì—…ì¼ ê¸°ì¤€) if (k.status === 'completed' && pickInfo.status === 'completed' && pickInfo.startTime) { const startTime = new Date(pickInfo.startTime); const endTime = pickInfo.completed ? new Date(pickInfo.completed) : new Date(); if (!isNaN(startTime.getTime()) && !isNaN(endTime.getTime()) && endTime > startTime) { const newLeadTime = getBusinessDays(startTime, endTime); if (newLeadTime >= 0 && Math.abs(newLeadTime - (k.leadTimeDays || 0)) > 0.05) { updated.leadTimeDays = newLeadTime; if (pickInfo.startTime) { updated.startedAt = pickInfo.startTime; } hasChanges = true; } } } return updated; }); if (hasChanges) { setKittingData(updatedKitting); } }, [pickCycles]); // ì´ì „ì— ì…ë ¥í•œ í˜‘ë ¥ì—…ì²´ ëª©ë¡ (ìë™ì™„ì„±ìš©) const previousVendors = React.useMemo(() => { const vendors = new Set(); receiveCycles.forEach(r => { if (r.vendor) vendors.add(r.vendor); }); return Array.from(vendors).sort(); }, [receiveCycles]); // í˜‘ë ¥ì—…ì²´ ìë™ì™„ì„± í•„í„°ë§ const filteredVendorSuggestions = React.useMemo(() => { if (!newReceive.vendor) return previousVendors.slice(0, 5); const term = newReceive.vendor.toLowerCase(); return previousVendors.filter(v => v.toLowerCase().includes(term)).slice(0, 5); }, [newReceive.vendor, previousVendors]); // ì •ë ¬/í•„í„°ëœ Pick ë°ì´í„° (A5 ê°œì„  - ê¸´ê¸‰ Order ìƒë‹¨ ê³ ì •) const filteredSortedPicks = React.useMemo(() => { let result = [...pickCycles]; // ì›”ë³„ í•„í„° (Basic Start Date ê¸°ì¤€) if (pickFilterMonth) { const ym=pickFilterMonth; const ymShort=ym.slice(2); result=result.filter(p=>p.startedAt?.startsWith(ym)||p.startedAt?.startsWith(ymShort)||p.basicStartDate?.startsWith(ym)||p.basicStartDate?.startsWith(ymShort)); } // ê²€ìƒ‰ í•„í„° if (pickSearchTerm) { const term = pickSearchTerm.toLowerCase(); result = result.filter(p => (p.productionOrder || p.orderId || '').toLowerCase().includes(term) || (p.materialDesc || '').toLowerCase().includes(term) ); } // Model í•„í„° if (pickFilterModel !== 'all') { result = result.filter(p => p.model === pickFilterModel); } // ìƒíƒœ í•„í„° if (pickFilterStatus !== 'all') { result = result.filter(p => p.status === pickFilterStatus); } // ë‹´ë‹¹ì í•„í„° if (pickFilterWorker !== 'all') { result = result.filter(p => p.worker === pickFilterWorker); } // ê¸´ê¸‰ í•„í„° if (pickFilterUrgent !== 'all') { result = result.filter(p => pickFilterUrgent === 'urgent' ? p.isUrgent : !p.isUrgent); } // ì •ë ¬ (A5 ê°œì„ : ê¸´ê¸‰ + ë¯¸ì™„ë£ŒëŠ” í•­ìƒ ìµœìƒë‹¨) result.sort((a, b) => { // 1ìˆœìœ„: ê¸´ê¸‰ + ë¯¸ì™„ë£ŒëŠ” ìµœìƒë‹¨ (ì™„ë£Œë˜ì§€ ì•Šì€ ê¸´ê¸‰ ê±´) const aIsUrgentPending = a.isUrgent && a.status !== 'completed'; const bIsUrgentPending = b.isUrgent && b.status !== 'completed'; if (aIsUrgentPending && !bIsUrgentPending) return -1; if (!aIsUrgentPending && bIsUrgentPending) return 1; // 2ìˆœìœ„: ì¼ë°˜ ì •ë ¬ let aVal, bVal; if (pickSortBy === 'productionOrder') { aVal = a.productionOrder || a.orderId || ''; bVal = b.productionOrder || b.orderId || ''; } else if (pickSortBy === 'basicStartDate') { aVal = a.basicStartDate || a.received || ''; bVal = b.basicStartDate || b.received || ''; } else if (pickSortBy === 'model') { aVal = a.model || ''; bVal = b.model || ''; } else if (pickSortBy === 'status') { const statusOrder = { 'waiting': 0, 'in-progress': 1, 'paused': 2, 'completed': 3 }; aVal = statusOrder[a.status] || 0; bVal = statusOrder[b.status] || 0; } if (pickSortOrder === 'asc') { return aVal > bVal ? 1 : aVal < bVal ? -1 : 0; } else { return aVal < bVal ? 1 : aVal > bVal ? -1 : 0; } }); return result; }, [pickCycles, pickFilterMonth, pickSearchTerm, pickFilterModel, pickFilterStatus, pickFilterWorker, pickFilterUrgent, pickSortBy, pickSortOrder]); // ì •ë ¬/í•„í„°ëœ Receive ë°ì´í„° const filteredSortedReceives = React.useMemo(() => { let result = [...receiveCycles]; // ê²€ìƒ‰ í•„í„° if (receiveSearchTerm) { const term = receiveSearchTerm.toLowerCase(); result = result.filter(r => (r.poNo || '').toLowerCase().includes(term) || (r.vendor || '').toLowerCase().includes(term) ); } // ìƒíƒœ í•„í„° if (receiveFilterStatus !== 'all') { result = result.filter(r => r.status === receiveFilterStatus); } // ì •ë ¬ result.sort((a, b) => { let aVal, bVal; if (receiveSortBy === 'poNo') { aVal = a.poNo || ''; bVal = b.poNo || ''; } else if (receiveSortBy === 'delivery') { aVal = a.delivery || ''; bVal = b.delivery || ''; } else if (receiveSortBy === 'vendor') { aVal = a.vendor || ''; bVal = b.vendor || ''; } if (receiveSortOrder === 'asc') { return aVal > bVal ? 1 : aVal < bVal ? -1 : 0; } else { return aVal < bVal ? 1 : aVal > bVal ? -1 : 0; } }); return result; }, [receiveCycles, receiveSearchTerm, receiveFilterStatus, receiveSortBy, receiveSortOrder]); // ë¬´ê²Œ ë°ì´í„° ìˆ˜ì • const updateWeight = (material, field, value) => { setWeightData(prev => ({ ...prev, [material]: { ...prev[material], [field]: field === 'w' ? parseFloat(value) || 0 : value } })); }; // ë¬´ê²Œ ë°ì´í„° ì—‘ì…€ ëŒ€ëŸ‰ ì—…ë¡œë“œ const handleWeightExcelUpload = async (e) => { const file = e.target.files[0]; if (!file) return; try { const XLSX = await new Promise((res)=>{if(window.XLSX){res(window.XLSX);return;}var s=document.createElement('script');s.src='https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js';s.onload=()=>res(window.XLSX);document.head.appendChild(s);}); const data = await file.arrayBuffer(); const workbook = XLSX.read(data); const sheetName = workbook.SheetNames[0]; const worksheet = workbook.Sheets[sheetName]; const jsonData = XLSX.utils.sheet_to_json(worksheet); if (jsonData.length === 0) { alert('âŒ ì—‘ì…€ íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; } // ì»¬ëŸ¼ëª… ìë™ ê°ì§€ (Material, Description, Weight, Bin ë“±) const firstRow = jsonData[0]; const keys = Object.keys(firstRow); // Material ì»¬ëŸ¼ ì°¾ê¸° const materialCol = keys.find(k => k.toLowerCase().includes('material') || k.toLowerCase() === 'mat' || k.toLowerCase() === 'í’ˆë²ˆ' || k.toLowerCase() === 'part' ) || keys[0]; // Description ì»¬ëŸ¼ ì°¾ê¸° const descCol = keys.find(k => k.toLowerCase().includes('desc') || k.toLowerCase().includes('í’ˆëª…') || k.toLowerCase().includes('name') ); // Weight ì»¬ëŸ¼ ì°¾ê¸° (g ë˜ëŠ” kg) const weightColG = keys.find(k => k.toLowerCase().includes('weight') && k.toLowerCase().includes('g') && !k.toLowerCase().includes('kg') ); const weightColKg = keys.find(k => k.toLowerCase().includes('weight') && k.toLowerCase().includes('kg') ); const weightCol = keys.find(k => k.toLowerCase().includes('weight') || k.toLowerCase().includes('ë¬´ê²Œ') || k.toLowerCase() === 'net weight' ); // Bin ì»¬ëŸ¼ ì°¾ê¸° const binCol = keys.find(k => k.toLowerCase().includes('bin') || k.toLowerCase().includes('storage') || k.toLowerCase().includes('ìœ„ì¹˜') ); let addedCount = 0; let updatedCount = 0; const newWeightData = { ...weightData }; jsonData.forEach(row => { const material = String(row[materialCol] || '').trim(); if (!material) return; // ë¬´ê²Œ ì²˜ë¦¬ (g â†’ kg ë³€í™˜) let weightKg = 0; if (weightColG && row[weightColG]) { weightKg = parseFloat(row[weightColG]) / 1000; // g â†’ kg } else if (weightColKg && row[weightColKg]) { weightKg = parseFloat(row[weightColKg]); // ì´ë¯¸ kg } else if (weightCol && row[weightCol]) { const w = parseFloat(row[weightCol]); // 1000 ì´ìƒì´ë©´ gë¡œ ê°„ì£¼, ì•„ë‹ˆë©´ kgë¡œ ê°„ì£¼ weightKg = w > 100 ? w / 1000 : w; } const desc = descCol ? String(row[descCol] || '') : ''; const bin = binCol ? String(row[binCol] || '') : ''; if (newWeightData[material]) { updatedCount++; } else { addedCount++; } newWeightData[material] = { d: desc || newWeightData[material]?.d || '', w: weightKg || newWeightData[material]?.w || 0, b: bin || newWeightData[material]?.b || '' }; }); setWeightData(newWeightData); alert(`âœ… ì—…ë¡œë“œ ì™„ë£Œ!\n- ì‹ ê·œ ì¶”ê°€: ${addedCount}ê°œ\n- ì—…ë°ì´íŠ¸: ${updatedCount}ê°œ\n- ì´: ${Object.keys(newWeightData).length}ê°œ`); } catch (error) { console.error('Excel upload error:', error); alert('âŒ ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n' + error.message); } e.target.value = ''; // ê°™ì€ íŒŒì¼ ì¬ì—…ë¡œë“œ ê°€ëŠ¥í•˜ê²Œ }; // ì‹ ê·œ Material ì¶”ê°€ const addNewMaterial = () => { if (!newMaterial.material.trim()) return; setWeightData(prev => ({ ...prev, [newMaterial.material]: { d: newMaterial.desc, w: parseFloat(newMaterial.weight) || 0, b: newMaterial.bin } })); setNewMaterial({ material: '', desc: '', weight: '', bin: '' }); setShowWeightModal(false); }; // Material ì‚­ì œ const deleteMaterial = (material) => { if (!confirm(`${material}ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return; setWeightData(prev => { const newData = { ...prev }; delete newData[material]; return newData; }); }; // ì—‘ì…€ ë‚´ë³´ë‚´ê¸° ê³µí†µ í•¨ìˆ˜ const [exportModalData, setExportModalData] = useState(null); const exportToExcel = async (data, filename, sheetName = 'Sheet1') => { if (!data || data.length === 0) return; const headers = Object.keys(data[0]); const rows = [headers.join('\t')]; data.forEach(row => { rows.push(headers.map(h => String(row[h] ?? '')).join('\t')); }); setExportModalData({ text: rows.join('\n'), filename, count: data.length }); }; // ì¬ê³  ëª©ë¡ ì—‘ì…€ ë‚´ë³´ë‚´ê¸° const exportInventory = () => { const data = inventoryData.map(item => ({ 'í’ˆë²ˆ': item.material, 'í’ˆëª…': item.description, 'Storage Bin': item.bin, 'ë™': getRackId(item.bin), 'ê°€ìš©ì¬ê³ ': item.stock, 'ë‹¨ìœ„': item.unit })); exportToExcel(data, 'PBK_ì¬ê³ ëª©ë¡', 'ì¬ê³ ëª©ë¡'); }; // ë¬´ê²Œ ì •ë³´ ì—‘ì…€ ë‚´ë³´ë‚´ê¸° const exportWeightData = () => { const data = Object.entries(weightData).map(([material, info]) => { const invItem = inventoryData.find(i => i.material === material); return { 'Material': material, 'Description': info.d || '', 'Storage Bin': info.b || '', 'ë¬´ê²Œ(g)': ((info.w || 0) * 1000).toFixed(1), 'ë¬´ê²Œ(kg)': (info.w || 0).toFixed(4), 'í˜„ì¬ì¬ê³ ': invItem?.stock || 0, 'ì´ë¬´ê²Œ(kg)': ((invItem?.stock || 0) * (info.w || 0)).toFixed(2) }; }); exportToExcel(data, 'PBK_ë¬´ê²Œì •ë³´', 'ë¬´ê²Œì •ë³´'); }; // ë™ë³„ í˜„í™© ì—‘ì…€ ë‚´ë³´ë‚´ê¸° const exportRackSummary = () => { const SPECIAL_AREAS = ['D2', 'E', 'F1', 'LABEL']; const data = rackSummary.map(rack => { // ê³µê°„ ì‚¬ìš©ë¥  ê³„ì‚° let curBoxes = 0, maxBoxes = 0; if (!SPECIAL_AREAS.includes(rack.id)) { const areaItems = inventoryData.filter(item => { const bin = item.bin || ''; return bin.startsWith(rack.id + '-') || bin === rack.id; }); const binGroups = {}; areaItems.forEach(item => { const bin = item.bin || rack.id; if (!binGroups[bin]) binGroups[bin] = []; binGroups[bin].push(item); }); Object.entries(binGroups).forEach(([bin, items]) => { items.forEach(item => { const qtyPerBox = MATERIAL_QTY_PER_BOX[item.material] || 1; curBoxes += (item.stock || 0) / qtyPerBox; }); const binInfo = BIN_RACK_INFO[bin] || { rackType: 'ê²½ëŸ‰ë™', rackCount: 1 }; const binBoxTypes = items.map(i => MATERIAL_BOX_MAP[i.material] || 'PLASTIC-S'); const tc = {}; binBoxTypes.forEach(t => { tc[t] = (tc[t] || 0) + 1; }); const mainBT = Object.entries(tc).sort((a, b) => b[1] - a[1])[0]?.[0] || 'PLASTIC-S'; if (binInfo.maxBoxes) { maxBoxes += binInfo.maxBoxes; } else if (binInfo.mixed) { binInfo.mixed.forEach(m => { const s = BOXES_PER_SHELF[m.type] || BOXES_PER_SHELF['ê²½ëŸ‰ë™']; maxBoxes += (s[mainBT] || s['PLASTIC-S'] || 2) * m.count; }); } else { const s = BOXES_PER_SHELF[binInfo.rackType] || BOXES_PER_SHELF['ê²½ëŸ‰ë™']; maxBoxes += (s[mainBT] || s['PLASTIC-S'] || 2) * binInfo.rackCount * (binInfo.shelves || 1); } }); } const spaceUtil = maxBoxes > 0 ? ((curBoxes / maxBoxes) * 100).toFixed(1) : 'N/A'; return { 'ë™ID': rack.id, 'ëª¨ë¸ì‹œë¦¬ì¦ˆ': RACK_MODEL_SERIES[rack.id] || 'ê¸°íƒ€', 'í’ˆëª©ìˆ˜': rack.items, 'ì´ì¬ê³ ': rack.stock, 'í˜„ì¬ë°•ìŠ¤ìˆ˜': curBoxes.toFixed(1), 'ìµœëŒ€ë°•ìŠ¤ìˆ˜': maxBoxes || 'N/A', 'ê³µê°„ì‚¬ìš©ë¥ (%)': spaceUtil, 'ì´ë¬´ê²Œ(kg)': rack.weight.toFixed(2), 'ìµœëŒ€ë¬´ê²Œ(kg)': rack.maxWeight >= 99999 ? 'ë¬´ì œí•œ' : rack.maxWeight }; }); exportToExcel(data, 'PBK_ë™ë³„í˜„í™©', 'ë™ë³„í˜„í™©'); }; // ë¶ˆì¶œ Cycle Time ì—‘ì…€ ë‚´ë³´ë‚´ê¸° const exportPickCycles = () => { const data = pickCycles.map(cycle => ({ 'Production Order': cycle.productionOrder, 'Material': cycle.material, 'Description': cycle.description, 'ìˆ˜ëŸ‰': cycle.quantity, 'ìš”ì²­ì‹œê°„': cycle.requestTime, 'ì™„ë£Œì‹œê°„': cycle.completeTime || '', 'ìƒíƒœ': cycle.status === 'completed' ? 'ì™„ë£Œ' : cycle.status === 'in-progress' ? 'ì§„í–‰ì¤‘' : 'ëŒ€ê¸°', 'Cycle Time(ë¶„)': cycle.cycleTime || '' })); exportToExcel(data, 'PBK_ë¶ˆì¶œCycleTime', 'ë¶ˆì¶œCycle'); }; // ì…ê³  Cycle Time ì—‘ì…€ ë‚´ë³´ë‚´ê¸° const exportReceiveCycles = () => { const data = receiveCycles.map(cycle => ({ 'Material': cycle.material, 'Description': cycle.description, 'ìˆ˜ëŸ‰': cycle.quantity, 'PO Number': cycle.poNumber || '', 'ë„ì°©ì‹œê°„': cycle.arrivalTime, 'MIGOì™„ë£Œì‹œê°„': cycle.migoTime || '', 'ì ì¹˜ì™„ë£Œì‹œê°„': cycle.putawayTime || '', 'ìƒíƒœ': cycle.status === 'completed' ? 'ì™„ë£Œ' : cycle.status === 'migo-done' ? 'MIGOì™„ë£Œ' : 'ë„ì°©', 'ì´CycleTime(ë¶„)': cycle.totalCycleTime || '' })); exportToExcel(data, 'PBK_ì…ê³ CycleTime', 'ì…ê³ Cycle'); }; // Kitting í˜„í™© ì—‘ì…€ ë‚´ë³´ë‚´ê¸° const exportKittingData = () => { const data = kittingData.map(order => ({ 'ì£¼ë¬¸ë²ˆí˜¸': order.orderId, 'ëª¨ë¸': order.model, 'ìˆ˜ëŸ‰': order.quantity, 'ì‹œì‘ì¼': order.startDate, 'ëª©í‘œì™„ë£Œì¼': order.targetDate, 'ì§„í–‰ë¥ (%)': order.progress, 'ìƒíƒœ': order.status === 'completed' ? 'ì™„ë£Œ' : order.status === 'in-progress' ? 'ì§„í–‰ì¤‘' : order.status === 'paused' ? 'ì¼ì‹œì •ì§€' : 'ëŒ€ê¸°', 'ì™„ë£Œí’ˆëª©': order.completedItems, 'ì´í’ˆëª©': order.totalItems })); exportToExcel(data, 'PBK_Kittingí˜„í™©', 'Kitting'); }; // TO DO ë¦¬ìŠ¤íŠ¸ ì—‘ì…€ ë‚´ë³´ë‚´ê¸° const exportTodoList = () => { const categoryNames = { general: 'ì¼ë°˜', data: 'ë°ì´í„°', process: 'í”„ë¡œì„¸ìŠ¤', kpi: 'KPI', other: 'ê¸°íƒ€' }; const priorityNames = { high: 'ë†’ìŒ', medium: 'ì¤‘ê°„', low: 'ë‚®ìŒ' }; const data = todoList.map(todo => ({ 'í• ì¼': todo.text, 'ì¹´í…Œê³ ë¦¬': categoryNames[todo.category] || todo.category, 'ìš°ì„ ìˆœìœ„': priorityNames[todo.priority] || todo.priority, 'ì™„ë£Œì—¬ë¶€': todo.completed ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ', 'ìƒì„±ì¼': todo.createdAt, 'ë§ˆê°ì¼': todo.dueDate || '' })); exportToExcel(data, 'PBK_TODOë¦¬ìŠ¤íŠ¸', 'TODO'); }; // ì €ì¥ëœ ì¬ê³  ë°ì´í„° ë¡œë“œ useEffect(() => { const savedInventory = safeStorage.getItem('pbk_inventory'); const savedLastUpdated = safeStorage.getItem('pbk_last_updated'); if (savedInventory) { const data = JSON.parse(savedInventory); setInventoryData(data); processRackSummary(data); } if (savedLastUpdated) { setLastUpdated(savedLastUpdated); } }, []); // ë™ ID ì¶”ì¶œ const getRackId = (bin) => { if (!bin) return 'UNKNOWN'; const binStr = String(bin).trim(); if (binStr.match(/^\d/)) return null; // Production Order Bin ì œì™¸ if (binStr.includes('-')) return binStr.split('-')[0]; return binStr; }; // ë™ë³„ ìš”ì•½ ê³„ì‚° const processRackSummary = useCallback((data) => { const rackMap = {}; data.forEach(item => { const rackId = getRackId(item.bin); if (!rackId) return; // Production Order Bin ì œì™¸ if (!rackMap[rackId]) { rackMap[rackId] = { id: rackId, zone: rackId.charAt(0), items: new Set(), stock: 0, weight: 0, bins: new Set() }; } rackMap[rackId].items.add(item.material); rackMap[rackId].stock += item.stock || 0; // weightDataì—ì„œ ë¬´ê²Œ ê°€ì ¸ì˜¤ê¸° (kg ë‹¨ìœ„) const itemWeight = weightData[item.material]?.w || 0; rackMap[rackId].weight += (item.stock || 0) * itemWeight; rackMap[rackId].bins.add(item.bin); }); const summary = Object.values(rackMap).map(rack => ({ id: rack.id, zone: rack.zone, items: rack.items.size, stock: rack.stock, weight: rack.weight, bins: rack.bins.size, maxBins: rackConfig[rack.id]?.maxBins || 10, maxWeight: rackConfig[rack.id]?.maxWeight || 200 })).sort((a, b) => b.stock - a.stock); setRackSummary(summary); }, [rackConfig, weightData]); // ì—‘ì…€ íŒŒì¼ íŒŒì‹± (SheetJS ì‚¬ìš©) const parseExcelFile = async (file) => { setIsLoading(true); setUploadError(null); try { // SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ if (!window.XLSX) { await new Promise((resolve, reject) => { const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js'; script.onload = resolve; script.onerror = reject; document.head.appendChild(script); }); } const data = await file.arrayBuffer(); const workbook = window.XLSX.read(data); const sheet = workbook.Sheets[workbook.SheetNames[0]]; const jsonData = window.XLSX.utils.sheet_to_json(sheet); // SAP ë°ì´í„° íŒŒì‹± // Description ì—†ëŠ” í–‰ (ë…¸ë€ìƒ‰) = Materialë³„ ì´ ì¬ê³  â†’ ì—¬ê¸°ì„œ ì¬ê³  ì¶”ì¶œ // Description ìˆëŠ” í–‰ = Bin ì •ë³´ + í’ˆëª… â†’ ë§¤í•‘ìš© // 1. Description ìˆëŠ” í–‰ì—ì„œ Materialë³„ ì •ë³´ ë§¤í•‘ (Bin, Description) const materialInfoMap = {}; jsonData.forEach(row => { const material = row['Material']; const desc = row['Material Description']; const bin = row['Storage Bin']; if (material && desc && desc.toString().trim() && bin) { const matKey = String(material); // Production Order Bin (ìˆ«ìë¡œ ì‹œì‘) ì œì™¸ if (String(bin).match(/^\d{10}/)) return; if (!materialInfoMap[matKey]) { materialInfoMap[matKey] = { description: String(desc), bins: [] }; } materialInfoMap[matKey].bins.push(String(bin)); } }); // 2. ë…¸ë€ìƒ‰ í–‰ (Description ì—†ëŠ” í–‰)ì—ì„œ ì´ ì¬ê³  ì¶”ì¶œ const inventory = jsonData .filter(row => { const material = row['Material']; const desc = row['Material Description']; // Materialì€ ìˆê³ , Descriptionì€ ë¹„ì–´ìˆëŠ” í–‰ (ë…¸ë€ìƒ‰) return material && (!desc || !desc.toString().trim()); }) .map(row => { const material = String(row['Material'] || ''); const info = materialInfoMap[material] || { description: '', bins: [] }; // ì²« ë²ˆì§¸ Binì„ ëŒ€í‘œ Binìœ¼ë¡œ ì‚¬ìš© const primaryBin = info.bins.length > 0 ? info.bins[0] : ''; return { material: material, description: info.description, bin: primaryBin, allBins: info.bins, // ëª¨ë“  Bin ì €ì¥ stock: parseFloat(row['Available stock']) || 0, unit: String(row['Base Unit of Measure'] || 'EA'), }; }) .filter(item => item.bin); // Bin ì •ë³´ê°€ ìˆëŠ” ê²ƒë§Œ (Production Order ì œì™¸ë¨) if (inventory.length === 0) { throw new Error('ìœ íš¨í•œ ì¬ê³  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. SAP ì—‘ì…€ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'); } // ì €ì¥ setInventoryData(inventory); processRackSummary(inventory); const now = new Date().toLocaleString('ko-KR'); setLastUpdated(now); safeStorage.setItem('pbk_inventory', JSON.stringify(inventory)); safeStorage.setItem('pbk_last_updated', now); setShowUploadModal(false); // v15: í† ìŠ¤íŠ¸, ì•Œë¦¼, íˆìŠ¤í† ë¦¬ ì¶”ê°€ showToast(`âœ… SAP ì¬ê³  ì—…ë¡œë“œ ì™„ë£Œ! ${inventory.length}ê°œ í’ˆëª©`, 'success'); addNotification('ì¬ê³  ë°ì´í„° ì—…ë¡œë“œ', `${inventory.length}ê°œ í’ˆëª©ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success'); addDataHistory('stock', `SAP ì¬ê³  ë°ì´í„° ì—…ë¡œë“œ (${inventory.length}ê°œ í’ˆëª©)`, inventory.length); } catch (error) { console.error('Excel parsing error:', error); setUploadError(error.message || 'ì—‘ì…€ íŒŒì¼ íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); showToast('âŒ íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨', 'error'); } finally { setIsLoading(false); } }; // íŒŒì¼ ë“œë¡­ í•¸ë“¤ëŸ¬ const handleDrop = useCallback((e) => { e.preventDefault(); const file = e.dataTransfer.files[0]; if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls'))) { parseExcelFile(file); } else { setUploadError('ì—‘ì…€ íŒŒì¼(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'); } }, []); const handleFileSelect = (e) => { const file = e.target.files[0]; if (file) { parseExcelFile(file); } }; // Open PO ì—‘ì…€ íŒŒì‹± const parseOpenPOFile = async (file) => { setIsLoading(true); setOpenPOError(null); try { if (!window.XLSX) { await new Promise((resolve, reject) => { const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js'; script.onload = resolve; script.onerror = reject; document.head.appendChild(script); }); } const data = await file.arrayBuffer(); const workbook = window.XLSX.read(data); const sheet = workbook.Sheets[workbook.SheetNames[0]]; const jsonData = window.XLSX.utils.sheet_to_json(sheet); // Zì—´: "Still to be delivered (qty)" > 0 í•„í„°ë§ const filtered = jsonData.filter(row => { const qty = parseFloat(row['Still to be delivered (qty)']); return qty > 0; }); // Materialë³„ë¡œ ê·¸ë£¹í™” (ê°™ì€ Materialì˜ ìˆ˜ëŸ‰ í•©ì‚°) const poByMaterial = {}; filtered.forEach(row => { const material = String(row['Material'] || '').trim(); const description = String(row['Short Text'] || '').trim(); const qty = parseFloat(row['Still to be delivered (qty)']) || 0; const unit = String(row['Order Unit'] || 'EA').trim(); const poNo = row['Purchasing Document']; if (material) { if (!poByMaterial[material]) { poByMaterial[material] = { material, description, totalQty: 0, unit, poNumbers: [] }; } poByMaterial[material].totalQty += qty; if (poNo && !poByMaterial[material].poNumbers.includes(poNo)) { poByMaterial[material].poNumbers.push(poNo); } } }); const openPOList = Object.values(poByMaterial); if (openPOList.length === 0) { throw new Error('ë‚©í’ˆ ì˜ˆì •ì¸ ìì¬ê°€ ì—†ìŠµë‹ˆë‹¤. (Still to be delivered > 0)'); } // ì €ì¥ setOpenPOData(openPOList); const now = new Date().toLocaleString('ko-KR'); setOpenPOLastUpdated(now); safeStorage.setItem('pbk_open_po', JSON.stringify(openPOList)); safeStorage.setItem('pbk_open_po_updated', now); setShowOpenPOModal(false); // v15: í† ìŠ¤íŠ¸, ì•Œë¦¼, íˆìŠ¤í† ë¦¬ ì¶”ê°€ showToast(`âœ… Open PO ì—…ë¡œë“œ ì™„ë£Œ! ${openPOList.length}ê°œ ìì¬`, 'success'); addNotification('Open PO ì—…ë¡œë“œ', `${openPOList.length}ê°œ ìì¬ ë‚©í’ˆ ì˜ˆì •ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success'); addDataHistory('openPO', `Open PO ë°ì´í„° ì—…ë¡œë“œ (${openPOList.length}ê°œ ìì¬)`, openPOList.length); } catch (error) { console.error('Open PO parsing error:', error); setOpenPOError(error.message || 'Open PO íŒŒì¼ íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); showToast('âŒ Open PO ì—…ë¡œë“œ ì‹¤íŒ¨', 'error'); } finally { setIsLoading(false); } }; // Open PO íŒŒì¼ í•¸ë“¤ëŸ¬ const handleOpenPODrop = useCallback((e) => { e.preventDefault(); const file = e.dataTransfer.files[0]; if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls'))) { parseOpenPOFile(file); } else { setOpenPOError('ì—‘ì…€ íŒŒì¼(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'); } }, []); const handleOpenPOFileSelect = (e) => { const file = e.target.files[0]; if (file) { parseOpenPOFile(file); } }; // Open POì—ì„œ ìì¬ ì°¾ê¸° í—¬í¼ í•¨ìˆ˜ const getOpenPOForMaterial = (material) => { return openPOData.find(po => po.material === material); }; // BOM íŒŒì¼ íŒŒì‹± í•¨ìˆ˜ (ìƒˆ í˜•ì‹ + Sub-component ì§€ì›) const parseBOMFile = async (file) => { setIsLoading(true); try { // XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ if (!window.XLSX) { await new Promise((resolve, reject) => { const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js'; script.onload = resolve; script.onerror = reject; document.head.appendChild(script); }); } const data = await file.arrayBuffer(); const workbook = window.XLSX.read(data, { type: 'array' }); // ëª¨ë¸ë³„ BOM ë°ì´í„° + Sub-component ë°ì´í„° const modelBomData = {}; const subComponentBomData = {}; workbook.SheetNames.forEach(sheetName => { // storage bin ì‹œíŠ¸ ì œì™¸ if (sheetName.toLowerCase().includes('storage')) return; const worksheet = workbook.Sheets[sheetName]; const jsonData = window.XLSX.utils.sheet_to_json(worksheet); if (jsonData.length === 0) return; const bomItems = {}; let validCount = 0; let excludedCount = 0; jsonData.forEach(row => { // Part No. = Component number ì»¬ëŸ¼ const partNo = row['Component number']; // Qty = Comp. Qty (CUn) ì»¬ëŸ¼ const qty = parseFloat(row['Comp. Qty (CUn)']) || 1; // Phantom item ì²´í¬ - Xë©´ ì œì™¸ const phantom = row['Phantom item'] || ''; // Item category ì²´í¬ - Lë§Œ í¬í•¨ (D, T ë“±ì€ ì œì™¸) const itemCategory = row['Item category'] || ''; // ì œì™¸ ì¡°ê±´ 1: Phantom item = X if (phantom.toString().toUpperCase() === 'X') { excludedCount++; return; } // ì œì™¸ ì¡°ê±´ 2: Item categoryê°€ Lì´ ì•„ë‹Œ ê²½ìš° (D, T ë“±) if (itemCategory.toString().toUpperCase() !== 'L') { excludedCount++; return; } if (partNo) { validCount++; bomItems[String(partNo).trim()] = qty; } }); // ì‹œíŠ¸ íƒ­ ì´ë¦„ìœ¼ë¡œ ì™„ì œí’ˆ/Sub-component êµ¬ë¶„ if (sheetName.startsWith('KB')) { // Sub-component subComponentBomData[sheetName] = bomItems; } else if (sheetName.startsWith('AS') || sheetName.includes('A2715') || sheetName.includes('HSM')) { // ì™„ì œí’ˆ - ëª¨ë¸ëª… ë§¤í•‘ let modelName = sheetName; if (sheetName === 'AS4500') modelName = 'RSC16'; else if (sheetName === 'AS6000') modelName = 'CSC16'; else if (sheetName === 'AS4600') modelName = 'FSC16'; else if (sheetName === 'AS8500') modelName = 'RSC48'; else if (sheetName === 'AS8000') modelName = 'CSC48'; else if (sheetName.includes('A2715') || sheetName.includes('HSM')) modelName = 'HSM3'; modelBomData[modelName] = bomItems; } }); if (Object.keys(modelBomData).length === 0) { alert('âŒ BOM ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì‹œíŠ¸ íƒ­ ì´ë¦„ì´ AS4500, AS8500, KB0xxx í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.'); setIsLoading(false); return; } // ì €ì¥ const now = new Date().toLocaleString('ko-KR'); setCustomBomData(modelBomData); setSubComponentBomData(subComponentBomData); setBomLastUpdated(now); safeStorage.setItem('pbk_custom_bom', JSON.stringify(modelBomData)); safeStorage.setItem('pbk_subcom_bom', JSON.stringify(subComponentBomData)); safeStorage.setItem('pbk_bom_updated', now); const modelCount = Object.keys(modelBomData).length; const subComCount = Object.keys(subComponentBomData).length; const totalModelParts = Object.values(modelBomData).reduce((sum, m) => sum + Object.keys(m).length, 0); const totalSubComParts = Object.values(subComponentBomData).reduce((sum, m) => sum + Object.keys(m).length, 0); // v15: í† ìŠ¤íŠ¸, ì•Œë¦¼, íˆìŠ¤í† ë¦¬ ì¶”ê°€ showToast(`âœ… BOM ì—…ë¡œë“œ ì™„ë£Œ! ${modelCount}ê°œ ëª¨ë¸`, 'success'); addNotification('BOM ë°ì´í„° ì—…ë¡œë“œ', `ì™„ì œí’ˆ ${modelCount}ê°œ ëª¨ë¸, Sub-com ${subComCount}ê°œê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success'); addDataHistory('bom', `BOM ë°ì´í„° ì—…ë¡œë“œ (ì™„ì œí’ˆ ${totalModelParts}ê°œ, Sub-com ${totalSubComParts}ê°œ ìì¬)`, totalModelParts + totalSubComParts); } catch (error) { console.error('BOM parsing error:', error); alert('âŒ BOM íŒŒì¼ íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n' + error.message); showToast('âŒ BOM ì—…ë¡œë“œ ì‹¤íŒ¨', 'error'); } finally { setIsLoading(false); } }; const handleBOMFileSelect = (e) => { const file = e.target.files[0]; if (file) { parseBOMFile(file); } e.target.value = ''; }; // BOM ì´ˆê¸°í™” (ê¸°ë³¸ BOMìœ¼ë¡œ ë³µì›) const resetBOMData = () => { if (confirm('BOM ë°ì´í„°ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì™„ì œí’ˆ + Sub-component ëª¨ë‘ ì´ˆê¸°í™”)')) { setCustomBomData(null); setSubComponentBomData(null); setBomLastUpdated(null); safeStorage.removeItem('pbk_custom_bom'); safeStorage.removeItem('pbk_subcom_bom'); safeStorage.removeItem('pbk_bom_updated'); alert('âœ… BOM ë°ì´í„°ê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.'); } }; // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ BOM ë°ì´í„° (ì‚¬ìš©ì ì—…ë¡œë“œ ë˜ëŠ” ê¸°ë³¸ê°’) const activeBomData = customBomData || MODEL_BOM_DATA; // í†µê³„ const totals = { items: new Set(inventoryData.map(i => i.material)).size, stock: inventoryData.reduce((s, i) => s + (i.stock || 0), 0), weight: rackSummary.reduce((s, r) => s + r.weight, 0), bins: new Set(inventoryData.map(i => i.bin)).size }; // Sub-component ìƒì‚° ê°€ëŠ¥ ëŒ€ìˆ˜ ê³„ì‚° const calculateSubComponentUnits = useCallback(() => { if (!subComponentBomData || inventoryData.length === 0) return {}; // ì¬ê³ ë¥¼ Material ê¸°ì¤€ìœ¼ë¡œ í•©ê³„ const stockByMaterial = {}; const descByMaterial = {}; inventoryData.forEach(item => { const mat = item.material; if (!stockByMaterial[mat]) stockByMaterial[mat] = 0; stockByMaterial[mat] += item.stock || 0; if (!descByMaterial[mat]) descByMaterial[mat] = item.description || ''; }); const results = {}; Object.entries(subComponentBomData).forEach(([subComName, bom]) => { let minUnits = Infinity; let bottleneck = null; let missingCount = 0; let totalBomItems = Object.keys(bom).length; let matchedItems = 0; Object.entries(bom).forEach(([material, requiredQty]) => { const currentStock = stockByMaterial[material] || 0; const description = descByMaterial[material] || ''; if (currentStock > 0) { matchedItems++; const possibleUnits = Math.floor(currentStock / requiredQty); if (possibleUnits < minUnits) { minUnits = possibleUnits; bottleneck = { material, description, currentStock, requiredQty, possibleUnits }; } } else { missingCount++; if (minUnits > 0) { minUnits = 0; bottleneck = { material, description, currentStock: 0, requiredQty, possibleUnits: 0 }; } } }); results[subComName] = { units: minUnits === Infinity ? 0 : minUnits, bottleneck, missingCount, totalBomItems, matchedItems, coverage: totalBomItems > 0 ? ((matchedItems / totalBomItems) * 100).toFixed(1) : '0' }; }); return results; }, [inventoryData, subComponentBomData]); const subComponentUnits = calculateSubComponentUnits(); // ìƒì‚° ê°€ëŠ¥ ëŒ€ìˆ˜ ê³„ì‚° (ì‚¬ìš©ì BOM ë˜ëŠ” ê¸°ë³¸ BOM ì‚¬ìš©) const calculateProducibleUnits = useCallback(() => { if (inventoryData.length === 0) return {}; // ì¬ê³ ë¥¼ Material ê¸°ì¤€ìœ¼ë¡œ í•©ê³„ ë° description ì €ì¥ const stockByMaterial = {}; const descByMaterial = {}; inventoryData.forEach(item => { const mat = item.material; if (!stockByMaterial[mat]) stockByMaterial[mat] = 0; stockByMaterial[mat] += item.stock || 0; if (!descByMaterial[mat]) descByMaterial[mat] = item.description || ''; }); const results = {}; const bomToUse = customBomData || MODEL_BOM_DATA; Object.keys(bomToUse).forEach(model => { const bom = bomToUse[model]; let minUnits = Infinity; let bottleneck = null; let missingCount = 0; let totalBomItems = Object.keys(bom).length; let matchedItems = 0; Object.entries(bom).forEach(([material, requiredQty]) => { const currentStock = stockByMaterial[material] || 0; const description = descByMaterial[material] || ''; if (currentStock > 0) { matchedItems++; const possibleUnits = Math.floor(currentStock / requiredQty); if (possibleUnits < minUnits) { minUnits = possibleUnits; bottleneck = { material, description, currentStock, requiredQty, possibleUnits }; } } else { missingCount++; if (minUnits > 0) { minUnits = 0; bottleneck = { material, description, currentStock: 0, requiredQty, possibleUnits: 0 }; } } }); results[model] = { units: minUnits === Infinity ? 0 : minUnits, bottleneck, missingCount, totalBomItems, matchedItems, coverage: ((matchedItems / totalBomItems) * 100).toFixed(1) }; }); return results; }, [inventoryData, customBomData]); const producibleUnits = calculateProducibleUnits(); const avgPickTime = pickCycles.filter(p => p.cycleMin).reduce((s, p, _, a) => s + p.cycleMin / a.length, 0) || 0; const avgReceiveTime = receiveCycles.filter(r => r.cycleMin).reduce((s, r, _, a) => s + r.cycleMin / a.length, 0) || 0; const avgLeadTime=(()=>{const cm=new Date().toISOString().slice(0,7);const arr=kittingData.filter(k=>k.status==='completed'&&k.leadTimeDays!=null&&k.leadTimeDays>=0&&(k.startedAt?.startsWith(cm)||k.basicStartDate?.startsWith(cm)));return arr.length>0?arr.reduce((s,k)=>s+k.leadTimeDays,0)/arr.length:0;})(); // C1 ê°œì„ : í˜„ì¬ í†µê³„ë¥¼ ë§¤ì¼ ìì •ì— ì´ì „ í†µê³„ë¡œ ì €ì¥ useEffect(() => { const today = new Date().toISOString().split('T')[0]; const lastSavedDate = safeStorage.getItem('pbk_stats_saved_date'); // ë‚ ì§œê°€ ë°”ë€Œë©´ í˜„ì¬ ê°’ì„ ì´ì „ ê°’ìœ¼ë¡œ ì €ì¥ if (lastSavedDate !== today && avgPickTime > 0) { const currentStats = { avgPickTime, avgReceiveTime, avgLeadTime, savedAt: today }; safeStorage.setItem('pbk_previous_stats', JSON.stringify(currentStats)); safeStorage.setItem('pbk_stats_saved_date', today); setPreviousStats(currentStats); } }, [avgPickTime, avgReceiveTime, avgLeadTime]); // í•„í„°ë§ const filteredRacks = rackSummary.filter(r => { if (selectedZone !== 'all' && r.zone !== selectedZone) return false; if (searchTerm && !r.id.toLowerCase().includes(searchTerm.toLowerCase())) return false; return true; }).sort((a, b) => { // ì‹œë¦¬ì¦ˆë³„ ìš°ì„ ìˆœìœ„: Maxwell 48 â†’ Maxwell 16 â†’ HSM 3.0 â†’ ê¸°íƒ€ const seriesOrder = { 'Maxwell 48': 0, 'Maxwell 16': 1, 'HSM 3.0': 2, 'Others': 3 }; const aSeries = RACK_MODEL_SERIES[a.id] || 'Others'; const bSeries = RACK_MODEL_SERIES[b.id] || 'Others'; const aOrder = seriesOrder[aSeries] ?? 3; const bOrder = seriesOrder[bSeries] ?? 3; if (aOrder !== bOrder) return aOrder - bOrder; // ê°™ì€ ì‹œë¦¬ì¦ˆ ë‚´ì—ì„œ ì•ŒíŒŒë²³ ìˆœ return a.id.localeCompare(b.id); }); // ì—¬ìœ  ê³µê°„ ìˆëŠ” ë™ const availableRacks = rackSummary .filter(r => r.bins < r.maxBins && !['D2', 'LABEL', 'E', 'E3'].includes(r.id)) .sort((a, b) => (b.maxBins - b.bins) - (a.maxBins - a.bins)); // Cycle Time ì™„ë£Œ ì²˜ë¦¬ const completePick = (id) => { const now = new Date(); const koreaTime = now.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false }).replace(/\. /g, '-').replace('.', ''); // í•œêµ­ ì‹œê°„ ë‚ ì§œ (YYYY-MM-DD) const koreaDate = now.toLocaleDateString('ko-KR', { timeZone: 'Asia/Seoul', year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\. /g, '-').replace('.', ''); // ë¨¼ì € productionOrder ì°¾ê¸° (productionOrder ë˜ëŠ” orderId) const targetPick = pickCycles.find(p => p.id === id); const productionOrder = targetPick?.productionOrder || targetPick?.orderId; setPickCycles(prev => prev.map(p => { if (p.id === id && p.startTime) { // ê·¼ë¬´ì‹œê°„ë§Œ ê³„ì‚° (í‰ì¼ 07:00~16:00, ì ì‹¬ 12:30~13:30 ì œì™¸) const cycleMin = calculateWorkingMinutes(p.startTime, now.toISOString()); return { ...p, completed: koreaTime, cycleMin, status: 'completed' }; } return p; })); // Kittingë„ ê°™ì´ ì™„ë£Œ ì²˜ë¦¬ if (productionOrder) { setKittingData(prev => prev.map(k => { if (k.productionOrder === productionOrder && k.status !== 'completed') { // ì‹œì‘ ì‹œê°„ì´ ìˆìœ¼ë©´ ì‹¤ì œ ì‘ì—… ì‹œê°„ ê³„ì‚°, ì—†ìœ¼ë©´ 0 let leadTimeDays = 0; if (k.startedAt) { const startTime = new Date(k.startedAt); leadTimeDays = getBusinessDays(startTime, now); // ì˜ì—…ì¼ ê¸°ì¤€ (ì£¼ë§+ê³µíœ´ì¼ ì œì™¸) } return { ...k, status: 'completed', completedAt: koreaDate, leadTimeDays }; } return k; })); } }; const completeReceive = (id) => { const now = new Date(); // í•œêµ­ ì‹œê°„ìœ¼ë¡œ í¬ë§·íŒ… const koreaTime = now.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false }).replace(/\. /g, '-').replace('.', '').replace(' ', ' '); setReceiveCycles(prev => prev.map(r => { if (r.id === id && r.startTime) { // ê·¼ë¬´ì‹œê°„ë§Œ ê³„ì‚° (í‰ì¼ 07:00~16:00) const cycleMin = calculateWorkingMinutes(r.startTime, now.toISOString()); return { ...r, migo: koreaTime, cycleMin, status: 'completed' }; } return r; })); }; // ì‹œì‘ ê¸°ëŠ¥ const startPick = (id) => { const now = new Date().toISOString(); // ë¨¼ì € productionOrder ì°¾ê¸° (productionOrder ë˜ëŠ” orderId) const targetPick = pickCycles.find(p => p.id === id); const productionOrder = targetPick?.productionOrder || targetPick?.orderId; setPickCycles(prev => prev.map(p => p.id === id ? { ...p, startTime: now, status: 'in-progress' } : p )); // Kittingë„ ê°™ì´ ì‹œì‘ ì²˜ë¦¬ if (productionOrder) { setKittingData(prev => prev.map(k => k.productionOrder === productionOrder && k.status === 'waiting' ? { ...k, status: 'in-progress', startedAt: now } : k )); } }; const startReceive = (id) => { const now = new Date().toISOString(); setReceiveCycles(prev => prev.map(r => r.id === id ? { ...r, startTime: now, status: 'in-progress' } : r )); }; // ì¼ì‹œì •ì§€ ê¸°ëŠ¥ const pausePick = (id) => { const now = new Date().toISOString(); // ë¨¼ì € productionOrder ì°¾ê¸° const targetPick = pickCycles.find(p => p.id === id); const productionOrder = targetPick?.productionOrder || targetPick?.orderId; setPickCycles(prev => prev.map(p => p.id === id ? { ...p, pausedAt: now, status: 'paused' } : p )); // Kittingë„ ê°™ì´ ì¼ì‹œì •ì§€ ì²˜ë¦¬ if (productionOrder) { setKittingData(prev => prev.map(k => k.productionOrder === productionOrder && k.status === 'in-progress' ? { ...k, status: 'paused', pausedAt: now } : k )); } }; const pauseReceive = (id) => { const now = new Date().toISOString(); setReceiveCycles(prev => prev.map(r => r.id === id ? { ...r, pausedAt: now, status: 'paused' } : r )); }; // ì¬ê°œ ê¸°ëŠ¥ const resumePick = (id) => { const now = new Date().toISOString(); // ë¨¼ì € productionOrder ì°¾ê¸° const targetPick = pickCycles.find(p => p.id === id); const productionOrder = targetPick?.productionOrder || targetPick?.orderId; setPickCycles(prev => prev.map(p => { if (p.id === id && p.pausedAt) { const pausedMs = new Date() - new Date(p.pausedAt); return { ...p, totalPausedMs: (p.totalPausedMs || 0) + pausedMs, pausedAt: null, status: 'in-progress' }; } return p; })); // Kittingë„ ê°™ì´ ì¬ê°œ ì²˜ë¦¬ if (productionOrder) { setKittingData(prev => prev.map(k => { if (k.productionOrder === productionOrder && k.status === 'paused') { const pausedMs = k.pausedAt ? new Date() - new Date(k.pausedAt) : 0; return { ...k, status: 'in-progress', totalPausedMs: (k.totalPausedMs || 0) + pausedMs, pausedAt: null }; } return k; })); } }; const resumeReceive = (id) => { setReceiveCycles(prev => prev.map(r => { if (r.id === id && r.pausedAt) { const pausedMs = new Date() - new Date(r.pausedAt); return { ...r, totalPausedMs: (r.totalPausedMs || 0) + pausedMs, pausedAt: null, status: 'in-progress' }; } return r; })); }; // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ const downloadCycleExcel = async (type) => { if (!window.XLSX) { await new Promise((resolve, reject) => { const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js'; script.onload = resolve; script.onerror = reject; document.head.appendChild(script); }); } let data, filename; if (type === 'pick') { data = pickCycles.map(p => ({ 'Production Order': p.productionOrder || p.orderId, 'Model': p.model, 'ë‹´ë‹¹ì': p.worker || '-', 'ê¸´ê¸‰': p.isUrgent ? 'ê¸´ê¸‰' : '-', 'Material Description': p.materialDesc || '-', 'ì‹œì‘ì˜ˆì •ì¼': p.basicStartDate || '-', 'ì‹œì‘ ì‹œê°„': p.startTime ? new Date(p.startTime).toLocaleString('ko-KR') : '-', 'ì™„ë£Œ ì‹œê°„': p.completed || '-', 'Cycle Time (ë¶„)': p.cycleMin || '-', 'ì¼ì‹œì •ì§€ ì‹œê°„ (ë¶„)': p.totalPausedMs ? Math.round(p.totalPausedMs / 60000) : 0, 'ìƒíƒœ': p.status === 'completed' ? 'ì™„ë£Œ' : p.status === 'paused' ? 'ì¼ì‹œì •ì§€' : p.status === 'in-progress' ? 'ì§„í–‰ì¤‘' : 'ëŒ€ê¸°' })); filename = `ë¶ˆì¶œ_Cycle_Time_${new Date().toISOString().slice(0,10)}.xlsx`; } else { data = receiveCycles.map(r => ({ 'No.': r.poNo, 'í˜‘ë ¥ì—…ì²´': r.vendor, 'ë‚©í’ˆ ì‹œê°': r.delivery ? r.delivery.replace(/^(\d{4}-\d{2}-\d{2})[\-T](\d{2}:\d{2}).*/, '$1 $2') : '-', 'ì‹œì‘ ì‹œê°„': r.startTime ? new Date(r.startTime).toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' }) : '-', 'MIGO ì™„ë£Œ': r.migo ? convertToKoreaTime(r.migo) : '-', 'Cycle Time (ë¶„)': r.cycleMin || '-', 'ì¼ì‹œì •ì§€ ì‹œê°„ (ë¶„)': r.totalPausedMs ? Math.round(r.totalPausedMs / 60000) : 0, 'ìƒíƒœ': r.status === 'completed' ? 'ì™„ë£Œ' : r.status === 'paused' ? 'ì¼ì‹œì •ì§€' : r.status === 'in-progress' ? 'ì§„í–‰ì¤‘' : 'ëŒ€ê¸°', 'Comments': r.comments || '' })); filename = `ì…ê³ _Cycle_Time_${new Date().toISOString().slice(0,10)}.xlsx`; } const ws = window.XLSX.utils.json_to_sheet(data); const wb = window.XLSX.utils.book_new(); window.XLSX.utils.book_append_sheet(wb, ws, 'Cycle Time'); window.XLSX.writeFile(wb, filename); }; // ì£¼ê°„ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ const downloadWeeklyReport = async () => { if (!window.XLSX) { await new Promise((resolve, reject) => { const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js'; script.onload = resolve; script.onerror = reject; document.head.appendChild(script); }); } const now = new Date(); const lastWeekStart = new Date(now); lastWeekStart.setDate(now.getDate() - now.getDay() - 6); // ì§€ë‚œì£¼ ì›”ìš”ì¼ lastWeekStart.setHours(0, 0, 0, 0); const lastWeekEnd = new Date(lastWeekStart); lastWeekEnd.setDate(lastWeekStart.getDate() + 6); // ì§€ë‚œì£¼ ì¼ìš”ì¼ lastWeekEnd.setHours(23, 59, 59, 999); const formatDate = (d) => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; // ì§€ë‚œì£¼ ë°ì´í„° í•„í„°ë§ const lastWeekPicks = pickCycles.filter(p => { if (!p.completed) return false; const completedDate = new Date(p.completed); return completedDate >= lastWeekStart && completedDate <= lastWeekEnd; }); const lastWeekReceives = receiveCycles.filter(r => { if (!r.migo) return false; const migoDate = new Date(r.migo); return migoDate >= lastWeekStart && migoDate <= lastWeekEnd; }); const lastWeekKittings = kittingData.filter(k => { if (!k.completedAt) return false; const completedDate = new Date(k.completedAt); return completedDate >= lastWeekStart && completedDate <= lastWeekEnd; }); // KPI ê³„ì‚° const avgPickTime = lastWeekPicks.length > 0 ? (lastWeekPicks.reduce((s, p) => s + (p.cycleMin || 0), 0) / lastWeekPicks.length).toFixed(1) : '-'; const avgReceiveTime = lastWeekReceives.length > 0 ? (lastWeekReceives.reduce((s, r) => s + (r.cycleMin || 0), 0) / lastWeekReceives.length).toFixed(1) : '-'; const avgLeadTime = lastWeekKittings.filter(k => k.leadTimeDays).length > 0 ? (lastWeekKittings.filter(k => k.leadTimeDays).reduce((s, k) => s + k.leadTimeDays, 0) / lastWeekKittings.filter(k => k.leadTimeDays).length).toFixed(2) : '-'; // í˜‘ë ¥ì—…ì²´ë³„ ì…ê³  í†µê³„ const vendorStats = {}; lastWeekReceives.forEach(r => { if (!vendorStats[r.vendor]) vendorStats[r.vendor] = { count: 0, totalTime: 0 }; vendorStats[r.vendor].count++; vendorStats[r.vendor].totalTime += r.cycleMin || 0; }); // KPI ìš”ì•½ ì‹œíŠ¸ const summaryData = [ { 'í•­ëª©': 'ğŸ“… ë¦¬í¬íŠ¸ ê¸°ê°„', 'ê°’': `${formatDate(lastWeekStart)} ~ ${formatDate(lastWeekEnd)}` }, { 'í•­ëª©': 'ğŸ“Š Kitting ì™„ë£Œ ê±´ìˆ˜', 'ê°’': `${lastWeekPicks.length}ê±´` }, { 'í•­ëª©': 'â±ï¸ í‰ê·  Kitting ì‹œê°„', 'ê°’': `${avgPickTime}ë¶„` }, { 'í•­ëª©': 'ğŸ“¦ ì…ê³  ì™„ë£Œ ê±´ìˆ˜', 'ê°’': `${lastWeekReceives.length}ê±´` }, { 'í•­ëª©': 'â±ï¸ í‰ê·  ì…ê³  ì‹œê°„', 'ê°’': `${avgReceiveTime}ë¶„` }, { 'í•­ëª©': 'ğŸ“ˆ Kitting ì™„ë£Œ ê±´ìˆ˜', 'ê°’': `${lastWeekKittings.length}ê±´` }, { 'í•­ëª©': 'ğŸ“… í‰ê·  ë¦¬ë“œíƒ€ì„', 'ê°’': `${avgLeadTime}ì¼` }, ]; // í˜‘ë ¥ì—…ì²´ë³„ ì‹œíŠ¸ const vendorData = Object.entries(vendorStats).map(([vendor, stats]) => ({ 'í˜‘ë ¥ì—…ì²´': vendor, 'ì…ê³  ê±´ìˆ˜': stats.count, 'í‰ê·  ì…ê³ ì‹œê°„(ë¶„)': stats.count > 0 ? (stats.totalTime / stats.count).toFixed(1) : '-' })).sort((a, b) => b['ì…ê³  ê±´ìˆ˜'] - a['ì…ê³  ê±´ìˆ˜']); // ì—‘ì…€ ìƒì„± const wb = window.XLSX.utils.book_new(); const ws1 = window.XLSX.utils.json_to_sheet(summaryData); window.XLSX.utils.book_append_sheet(wb, ws1, 'KPI ìš”ì•½'); const ws2 = window.XLSX.utils.json_to_sheet(vendorData); window.XLSX.utils.book_append_sheet(wb, ws2, 'í˜‘ë ¥ì—…ì²´ë³„ í†µê³„'); if (lastWeekPicks.length > 0) { const pickData = lastWeekPicks.map(p => ({ 'Production Order': p.productionOrder || p.orderId, 'Model': p.model, 'ë‹´ë‹¹ì': p.worker || '-', 'ì™„ë£Œ ì‹œê°„': p.completed, 'Cycle Time (ë¶„)': p.cycleMin || '-' })); const ws3 = window.XLSX.utils.json_to_sheet(pickData); window.XLSX.utils.book_append_sheet(wb, ws3, 'Kitting ìƒì„¸'); } if (lastWeekReceives.length > 0) { const receiveData = lastWeekReceives.map(r => ({ 'No.': r.poNo, 'í˜‘ë ¥ì—…ì²´': r.vendor, 'MIGO ì™„ë£Œ': r.migo, 'Cycle Time (ë¶„)': r.cycleMin || '-' })); const ws4 = window.XLSX.utils.json_to_sheet(receiveData); window.XLSX.utils.book_append_sheet(wb, ws4, 'ì…ê³  ìƒì„¸'); } const filename = `ì£¼ê°„ë¦¬í¬íŠ¸_${formatDate(lastWeekStart)}_${formatDate(lastWeekEnd)}.xlsx`; window.XLSX.writeFile(wb, filename); }; // ì˜¨ìŠµë„ PDF ìƒì„± í•¨ìˆ˜ const generateTempHumidityPDF = () => { const [year, month] = tempHumidityMonth.split('-').map(Number); const daysInMonth = new Date(year, month, 0).getDate(); // í…Œì´ë¸” í–‰ ìƒì„± let tableRows = ''; for (let day = 1; day <= 31; day++) { const dateKey = tempHumidityMonth + '-' + String(day).padStart(2, '0'); const data = tempHumidityData[dateKey] || { temp: '', humidity: '' }; const tempNum = parseFloat(data.temp); const humidNum = parseFloat(data.humidity); const tempStyle = !isNaN(tempNum) && (tempNum < 5 || tempNum > 40) ? 'color:red;font-weight:bold;' : ''; const humidStyle = !isNaN(humidNum) && (humidNum < 0 || humidNum > 75) ? 'color:red;font-weight:bold;' : ''; if (day > daysInMonth) { tableRows += '' + day + '---'; } else { const tempVal = data.temp || ''; const humidVal = data.humidity || ''; const recorder = (data.temp || data.humidity) ? tempHumidityRecorder : ''; tableRows += '' + day + '' + tempVal + '' + humidVal + '' + recorder + ''; } } // Word í˜¸í™˜ HTML ìƒì„± (mso ìŠ¤íƒ€ì¼ í¬í•¨) const htmlContent = `
Temp. & Humidity Check Log (Daily)
ESD Protected Work Area Check log - ${year}ë…„ ${String(month).padStart(2, '0')}ì›”
Temp. & Humidity Check Log(Daily)
ESD Protected Work Area Check log	Writer	Reviewer	Approver
${tempHumidityRecorder}		
${tableRows}
Day	Temp (â„ƒ)	Humidity (%)	Recorded by
* Spec: Temp +5~40â„ƒ / Humidity 0~75% (Equipment: NS-205B)
* Generated: ${new Date().toLocaleString('ko-KR')}

`; // Blobìœ¼ë¡œ doc íŒŒì¼ ë‹¤ìš´ë¡œë“œ (Wordì—ì„œ ì—´ ìˆ˜ ìˆëŠ” HTML) const blob = new Blob(['\ufeff' + htmlContent], { type: 'application/msword' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = year + '_' + String(month).padStart(2, '0') + '_ESD_Check_Sheet.doc'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); alert('íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\\n\\n' + year + '_' + String(month).padStart(2, '0') + '_ESD_Check_Sheet.doc\\n\\nWordì—ì„œ ì—´ì–´ PDFë¡œ ì €ì¥í•˜ê±°ë‚˜ ë°”ë¡œ ì¸ì‡„í•˜ì„¸ìš”.'); }; // CSV ë‚´ë³´ë‚´ê¸° í•¨ìˆ˜ (ì›ë³¸ docx í…œí”Œë¦¿ìš©) const exportTempHumidityCSV = () => { const [year, month] = tempHumidityMonth.split('-').map(Number); const daysInMonth = new Date(year, month, 0).getDate(); // CSV í—¤ë” let csvContent = 'Day,Temp,Humidity,Recorded_by\n'; // ê° ì¼ë³„ ë°ì´í„° for (let day = 1; day <= daysInMonth; day++) { const dateKey = tempHumidityMonth + '-' + String(day).padStart(2, '0'); const data = tempHumidityData[dateKey] || { temp: '', humidity: '' }; const temp = data.temp || ''; const humidity = data.humidity || ''; const recorder = (temp || humidity) ? tempHumidityRecorder : ''; csvContent += day + ',' + temp + ',' + humidity + ',' + recorder + '\n'; } // CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œ const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = year + '_' + String(month).padStart(2, '0') + '_temp_humidity_data.csv'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); }; const addPick = () => { if (!newPick.productionOrder || !newPick.model || !newPick.received) return; // ë¶ˆì¶œ Cycle ì¶”ê°€ setPickCycles(prev => [...prev, { id: Date.now(), ...newPick, startTime: null, completed: null, cycleMin: null, totalPausedMs: 0, pausedAt: null, status: 'waiting' }]); // Kittingì— ê°™ì€ Production Orderê°€ ìˆìœ¼ë©´ ë‹´ë‹¹ì ì—…ë°ì´íŠ¸ if (newPick.productionOrder && newPick.worker) { setKittingData(prev => prev.map(k => k.productionOrder === newPick.productionOrder ? { ...k, worker: newPick.worker } : k )); } setNewPick({ productionOrder: '', model: 'RSC48', received: '', worker: 'Z01', isUrgent: false }); setShowPickModal(false); }; // Order CSV ì—…ë¡œë“œ ì²˜ë¦¬ (ë¶ˆì¶œ Cycle + Kitting í˜„í™© ë™ì‹œ ì—…ë°ì´íŠ¸) const handleOrderCsvUpload = (e) => { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (event) => { try { const text = event.target.result; const lines = text.split('\n').filter(line => line.trim()); if (lines.length < 2) { alert('âŒ CSV íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; } // í—¤ë” íŒŒì‹± const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, '')); const orderIdx = headers.findIndex(h => /^Order$/i.test(h)); const descIdx = headers.findIndex(h => /Material description/i.test(h)); const materialNumIdx = headers.findIndex(h => /Material Number/i.test(h)); const startDateIdx = headers.findIndex(h => /Basic start date/i.test(h)); // ë‹´ë‹¹ì (Prodn Supervisor) ì»¬ëŸ¼ ì¶”ê°€ const supervisorIdx = headers.findIndex(h => /Prodn Supervisor/i.test(h) || /Production Supervisor/i.test(h) || /Supervisor/i.test(h)); if (orderIdx === -1) { alert('âŒ Order ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; } // Model ë§¤í•‘ í•¨ìˆ˜ (Material Number ê¸°ì¤€) // RSC16(AS4500), RSC48(AS8500), CSC48(AS8000), FSC16(AS4600), CSC16(AS6000), HSM3.0(A2715) const getModelFromMaterial = (materialNum) => { if (!materialNum) return 'Spare Parts'; const m = materialNum.toUpperCase(); if (m === 'AS4500') return 'RSC16'; if (m === 'AS8500') return 'RSC48'; if (m === 'AS8000') return 'CSC48'; if (m === 'AS4600') return 'FSC16'; if (m === 'AS6000') return 'CSC16'; if (m === 'A2715') return 'HSM3.0'; if(SUBCOM_INFO[materialNum])return 'Sub-com.'; if(SUBCOM_INFO[materialNum])return 'Sub-com.'; return 'Spare Parts'; }; // ë‚ ì§œ í˜•ì‹ í†µì¼ (YY-MM-DD â†’ YYYY-MM-DD) const normalizeDate = (d) => { if (!d) return ''; d = d.trim().split(' ')[0]; // YY-MM-DD (ì˜ˆ: 26-03-04) if (/^\d{2}-\d{2}-\d{2}$/.test(d)) return '20' + d; // DD.MM.YYYY (ì˜ˆ: 04.03.2026) if (/^\d{2}\.\d{2}\.\d{4}$/.test(d)) { var p=d.split('.'); return p[2]+'-'+p[1]+'-'+p[0]; } // MM/DD/YYYY (ì˜ˆ: 03/04/2026) if (/^\d{2}\/\d{2}\/\d{4}$/.test(d)) { var p=d.split('/'); return p[2]+'-'+p[0]+'-'+p[1]; } return d; }; // ë°ì´í„° íŒŒì‹± const newPickOrders = []; const newKittingOrders = []; const existingPickOrders = new Set(pickCycles.map(p => p.productionOrder)); const existingKittingOrders = new Set(kittingData.map(k => k.productionOrder)); const now = new Date().toISOString().slice(0, 16).replace('T', ' '); for (let i = 1; i < lines.length; i++) { // CSV íŒŒì‹± (ì‰¼í‘œ ì²˜ë¦¬) const row = lines[i].match(/(".*?"|[^,]+)(?=\s*,|\s*$)/g); if (!row) continue; const values = row.map(v => v.trim().replace(/^"|"$/g, '').replace(/\r/g, '')); const order = values[orderIdx]; if (!order) continue; const desc = descIdx >= 0 ? values[descIdx] : ''; const materialNum = materialNumIdx >= 0 ? values[materialNumIdx] : ''; const startDate = startDateIdx >= 0 ? values[startDateIdx] : ''; const model = getModelFromMaterial(materialNum); // ë‹´ë‹¹ì ì¶”ì¶œ (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ Z01) const worker = supervisorIdx >= 0 && values[supervisorIdx] ? values[supervisorIdx].trim() : 'Z01'; // ë¶ˆì¶œ Cycleì— ì¶”ê°€ (ì¤‘ë³µ ì•„ë‹Œ ê²½ìš°) if (!existingPickOrders.has(order)) { newPickOrders.push({ id: Date.now() + i, productionOrder: order, model: model, materialNum: materialNum, // Part No. materialDesc: desc, received: now, basicStartDate: normalizeDate(startDate), worker: worker, // ë‹´ë‹¹ì ìë™ ë§¤í•‘ startTime: null, completed: null, cycleMin: null, totalPausedMs: 0, pausedAt: null, status: 'waiting' }); existingPickOrders.add(order); } // Kitting í˜„í™©ì— ì¶”ê°€ (ì¤‘ë³µ ì•„ë‹Œ ê²½ìš°) if (!existingKittingOrders.has(order)) { newKittingOrders.push({ id: Date.now() + i + 100000, productionOrder: order, model: model, materialNum: materialNum, // Part No. materialDesc: desc, basicStartDate: normalizeDate(startDate) || new Date().toISOString().split('T')[0], worker: worker, // ë‹´ë‹¹ì ìë™ ë§¤í•‘ isUrgent: false, status: 'waiting', createdAt: new Date().toISOString(), completedAt: null, leadTimeDays: null }); existingKittingOrders.add(order); } } if (newPickOrders.length === 0 && newKittingOrders.length === 0) { alert('âš ï¸ ì¶”ê°€í•  ìƒˆë¡œìš´ Orderê°€ ì—†ìŠµë‹ˆë‹¤.\n(ì´ë¯¸ ë“±ë¡ëœ Orderì´ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„°)'); return; } // ë¶ˆì¶œ Cycle ì—…ë°ì´íŠ¸ if (newPickOrders.length > 0) { setPickCycles(prev => [...prev, ...newPickOrders]); } // Kitting í˜„í™© ì—…ë°ì´íŠ¸ if (newKittingOrders.length > 0) { setKittingData(prev => [...prev, ...newKittingOrders]); } alert(`âœ… Order ì—…ë¡œë“œ ì™„ë£Œ!\n\nğŸ“¦ ë¶ˆì¶œ Cycle: ${newPickOrders.length}ê°œ ì¶”ê°€\nğŸ“‹ Kitting í˜„í™©: ${newKittingOrders.length}ê°œ ì¶”ê°€`); } catch (error) { console.error('CSV parsing error:', error); alert('âŒ CSV íŒŒì¼ íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); } }; reader.readAsText(file); e.target.value = ''; }; // UTC ì‹œê°„ì„ í•œêµ­ ì‹œê°„ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ // ìƒˆë¡œ ì…ë ¥í•œ ë°ì´í„°(í•œêµ­ ì‹œê°„)ëŠ” ê·¸ëŒ€ë¡œ, ê¸°ì¡´ UTC ë°ì´í„°ë§Œ +9ì‹œê°„ const convertToKoreaTime = (timeStr) => { if (!timeStr || timeStr === '-') return timeStr; // "2026-02-23-13:54" í˜•ì‹ (ë‚ ì§œ-ì‹œê°„ ì‚¬ì´ í•˜ì´í”ˆ) â†’ ê³µë°±ìœ¼ë¡œ ì •ê·œí™” const m = timeStr.match(/^(\d{4}-\d{2}-\d{2})[\-T\s](\d{2}:\d{2}.*)$/); if (m) timeStr = m[1] + ' ' + m[2]; // "2026-02-03 12:00" í˜•ì‹ í™•ì¸ if (timeStr.includes('-') && timeStr.includes(' ') && timeStr.length >= 16) { const [datePart, timePart] = timeStr.split(' '); if (datePart && timePart) { const hour = parseInt(timePart.split(':')[0]); // 07:00 ~ 23:59 ë²”ìœ„ë©´ ì´ë¯¸ í•œêµ­ ì‹œê°„ìœ¼ë¡œ ê°„ì£¼ (ì •ìƒ ê·¼ë¬´/ìƒí™œ ì‹œê°„) // 00:00 ~ 06:59 ë²”ìœ„ë©´ UTCì¼ ê°€ëŠ¥ì„± ë†’ìŒ (í•œêµ­ì‹œê°„ 09:00~15:59) if (hour >= 7 && hour <= 23) { return timeStr; // ì´ë¯¸ í•œêµ­ ì‹œê°„, ê·¸ëŒ€ë¡œ ë°˜í™˜ } } } try { // ISO í˜•ì‹ì´ë‚˜ ë‹¤ë¥¸ í˜•ì‹ì˜ ë‚ ì§œ íŒŒì‹± let date; if (timeStr.includes('T')) { date = new Date(timeStr); } else { // "2026-02-03 04:35" í˜•ì‹ â†’ UTCë¡œ í•´ì„í•˜ì—¬ +9ì‹œê°„ const [datePart, timePart] = timeStr.split(' '); if (datePart && timePart) { const [year, month, day] = datePart.split('-'); const [hour, minute] = timePart.split(':'); date = new Date(Date.UTC(year, month - 1, day, hour, minute)); } else { return timeStr; } } if (isNaN(date.getTime())) return timeStr; // í•œêµ­ ì‹œê°„ìœ¼ë¡œ ë³€í™˜ const koreaTime = date.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false }); // "2026. 02. 03. 13:35" â†’ "2026-02-03 13:35" í˜•ì‹ìœ¼ë¡œ ë³€í™˜ return koreaTime.replace(/\. /g, '-').replace('.', ''); } catch (e) { return timeStr; } }; // ê·¼ë¬´ì‹œê°„ë§Œ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ (í‰ì¼ 07:00~16:00, í•œêµ­ ì‹œê°„ ê¸°ì¤€) const calculateWorkingMinutes = (startTime, endTime) => { const start = new Date(startTime); const end = new Date(endTime); const WORK_START_HOUR = 7; // ì˜¤ì „ 7ì‹œ const WORK_END_HOUR = 16; // ì˜¤í›„ 4ì‹œ const LUNCH_START = 12.5; // ì ì‹¬ ì‹œì‘ 12:30 const LUNCH_END = 13.5; // ì ì‹¬ ì¢…ë£Œ 13:30 let totalMinutes = 0; let current = new Date(start); // í•œêµ­ ì‹œê°„ëŒ€ ì˜¤í”„ì…‹ (UTC+9) const getKoreaHour = (date) => { const koreaTime = new Date(date.toLocaleString('en-US', { timeZone: 'Asia/Seoul' })); return koreaTime.getHours(); }; const getKoreaMinute = (date) => { const koreaTime = new Date(date.toLocaleString('en-US', { timeZone: 'Asia/Seoul' })); return koreaTime.getMinutes(); }; const getKoreaDay = (date) => { const koreaTime = new Date(date.toLocaleString('en-US', { timeZone: 'Asia/Seoul' })); return koreaTime.getDay(); }; while (current < end) { const dayOfWeek = getKoreaDay(current); // 0=ì¼, 1=ì›”, ..., 6=í†  const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 5; // ì›”~ê¸ˆ // í•œêµ­ì‹œê°„ ê¸°ì¤€ ë‚ ì§œ ë¬¸ìì—´ë¡œ ê³µíœ´ì¼ ì²´í¬ const krDate = new Date(current.toLocaleString('en-US', { timeZone: 'Asia/Seoul' })); const dateStr = krDate.getFullYear() + '-' + String(krDate.getMonth()+1).padStart(2,'0') + '-' + String(krDate.getDate()).padStart(2,'0'); const isHoliday = KR_HOLIDAYS.has(dateStr); if (isWeekday && !isHoliday) { const currentHour = getKoreaHour(current); const currentMinute = getKoreaMinute(current); const currentTime = currentHour + currentMinute / 60; // ì‹œê°„ì„ ì†Œìˆ˜ì ìœ¼ë¡œ ë³€í™˜ // ê·¼ë¬´ì‹œê°„ ë‚´ì¸ì§€ í™•ì¸ (07:00 ~ 16:00) // ì ì‹¬ì‹œê°„ ì œì™¸ (12:30 ~ 13:30) const isWorkingHour = currentHour >= WORK_START_HOUR && currentHour < WORK_END_HOUR; const isLunchTime = currentTime >= LUNCH_START && currentTime < LUNCH_END; if (isWorkingHour && !isLunchTime) { totalMinutes += 1; } } // 1ë¶„ì”© ì¦ê°€ current = new Date(current.getTime() + 60000); } return totalMinutes; }; const addReceive = () => { if (!newReceive.vendor) return; // ìë™ ë²ˆí˜¸ ê³„ì‚°: í˜„ì¬ ìµœëŒ€ê°’ + 1 const maxNo = receiveCycles.reduce((max, r) => { const num = parseInt(r.poNo) || 0; return num > max ? num : max; }, 0); const newPoNo = String(maxNo + 1); // í˜„ì¬ ì‹œê°„ì„ ë‚©í’ˆ ì‹œê°ìœ¼ë¡œ ì‚¬ìš© const now = new Date(); const deliveryStr = now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0')+'-'+String(now.getDate()).padStart(2,'0')+' '+String(now.getHours()).padStart(2,'0')+':'+String(now.getMinutes()).padStart(2,'0'); setReceiveCycles(prev => [...prev, { id: Date.now(), poNo: newPoNo, vendor: newReceive.vendor, delivery: deliveryStr, startTime: now.toISOString(), // í˜„ì¬ ì‹œê° ê¸°ì¤€ìœ¼ë¡œ Cycle Time ê³„ì‚° migo: null, cycleMin: null, totalPausedMs: 0, pausedAt: null, status: 'in-progress' // ë°”ë¡œ ì§„í–‰ì¤‘ ìƒíƒœ }]); setNewReceive({ poNo: '', vendor: '', delivery: '' }); setShowReceiveModal(false); }; // ===== ë‹¤ì¤‘ ì„ íƒ ê´€ë ¨ í•¨ìˆ˜ë“¤ ===== // Pick ì „ì²´ ì„ íƒ/í•´ì œ const toggleAllPicks = () => { if (selectedPicks.size === pickCycles.length) { setSelectedPicks(new Set()); } else { setSelectedPicks(new Set(pickCycles.map(p => p.id))); } }; // Pick ê°œë³„ ì„ íƒ/í•´ì œ const togglePickSelection = (id) => { const newSet = new Set(selectedPicks); if (newSet.has(id)) { newSet.delete(id); } else { newSet.add(id); } setSelectedPicks(newSet); }; // Receive ì „ì²´ ì„ íƒ/í•´ì œ const toggleAllReceives = () => { if (selectedReceives.size === receiveCycles.length) { setSelectedReceives(new Set()); } else { setSelectedReceives(new Set(receiveCycles.map(r => r.id))); } }; // Receive ê°œë³„ ì„ íƒ/í•´ì œ const toggleReceiveSelection = (id) => { const newSet = new Set(selectedReceives); if (newSet.has(id)) { newSet.delete(id); } else { newSet.add(id); } setSelectedReceives(newSet); }; // ì„ íƒëœ Pick ì¼ê´„ ì‹œì‘ const startSelectedPicks = () => { if (selectedPicks.size === 0) return; const now = new Date().toISOString(); const idsToStart = Array.from(selectedPicks); // ë¨¼ì € Production Order ëª©ë¡ ìˆ˜ì§‘ const productionOrders = pickCycles .filter(p => idsToStart.includes(p.id) && p.status === 'waiting') .map(p => p.productionOrder); setPickCycles(prev => prev.map(p => idsToStart.includes(p.id) && p.status === 'waiting' ? { ...p, startTime: now, status: 'in-progress' } : p )); // Kittingë„ ê°™ì´ ì‹œì‘ if (productionOrders.length > 0) { setKittingData(prev => prev.map(k => productionOrders.includes(k.productionOrder) && k.status === 'waiting' ? { ...k, status: 'in-progress', startedAt: now } : k )); } setSelectedPicks(new Set()); }; // ì„ íƒëœ Pick ì¼ê´„ ì™„ë£Œ const completeSelectedPicks = () => { if (selectedPicks.size === 0) return; const now = new Date(); const idsToComplete = Array.from(selectedPicks); // ë¨¼ì € Production Order ëª©ë¡ ìˆ˜ì§‘ const productionOrders = pickCycles .filter(p => idsToComplete.includes(p.id) && (p.status === 'in-progress' || p.status === 'paused') && p.startTime) .map(p => p.productionOrder); setPickCycles(prev => prev.map(p => { if (idsToComplete.includes(p.id) && (p.status === 'in-progress' || p.status === 'paused') && p.startTime) { const totalPaused = p.totalPausedMs || 0; const cycleMin = Math.round((now - new Date(p.startTime) - totalPaused) / 60000); return { ...p, completed: now.toISOString().slice(0,16).replace('T',' '), cycleMin, status: 'completed' }; } return p; })); // Kittingë„ ê°™ì´ ì™„ë£Œ if (productionOrders.length > 0) { setKittingData(prev => prev.map(k => { if (productionOrders.includes(k.productionOrder) && k.status !== 'completed') { // ì‹œì‘ ì‹œê°„ì´ ìˆìœ¼ë©´ ì‹¤ì œ ì‘ì—… ì‹œê°„ ê³„ì‚°, ì—†ìœ¼ë©´ 0 let leadTimeDays = 0; if (k.startedAt) { const startTime = new Date(k.startedAt); leadTimeDays = getBusinessDays(startTime, now); // ì˜ì—…ì¼ ê¸°ì¤€ (ì£¼ë§+ê³µíœ´ì¼ ì œì™¸) } return { ...k, status: 'completed', completedAt: now.toLocaleDateString('ko-KR', { timeZone: 'Asia/Seoul', year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\. /g, '-').replace('.', ''), leadTimeDays }; } return k; })); } setSelectedPicks(new Set()); }; // ì„ íƒëœ Pick ì¼ê´„ ì‚­ì œ (ëª¨ë‹¬ í˜¸ì¶œ) const deleteSelectedPicks = () => { if (selectedPicks.size === 0) return; setDeleteConfirm({ show: true, type: 'pick', id: null, text: '', count: selectedPicks.size }); }; // ì‹¤ì œ Pick ì‚­ì œ ì‹¤í–‰ const confirmDeletePicks = () => { const idsToDelete = [...selectedPicks]; setPickCycles(prev => prev.filter(p => !idsToDelete.includes(p.id))); setSelectedPicks(new Set()); setDeleteConfirm({ show: false, type: '', id: null, text: '', count: 0 }); }; // ì„ íƒëœ Receive ì¼ê´„ ì‹œì‘ const startSelectedReceives = () => { if (selectedReceives.size === 0) return; const now = new Date().toISOString(); const idsToStart = Array.from(selectedReceives); setReceiveCycles(prev => prev.map(r => idsToStart.includes(r.id) && r.status === 'waiting' ? { ...r, startTime: now, status: 'in-progress' } : r )); setSelectedReceives(new Set()); }; // ì„ íƒëœ Receive ì¼ê´„ ì™„ë£Œ const completeSelectedReceives = () => { if (selectedReceives.size === 0) return; const now = new Date(); const idsToComplete = Array.from(selectedReceives); setReceiveCycles(prev => prev.map(r => { if (idsToComplete.includes(r.id) && (r.status === 'in-progress' || r.status === 'paused') && r.startTime) { const totalPaused = r.totalPausedMs || 0; const cycleMin = Math.round((now - new Date(r.startTime) - totalPaused) / 60000); return { ...r, migo: now.toISOString().slice(0,16).replace('T',' '), cycleMin, status: 'completed' }; } return r; })); setSelectedReceives(new Set()); }; // ì„ íƒëœ Receive ì¼ê´„ ì‚­ì œ (ëª¨ë‹¬ í˜¸ì¶œ) const deleteSelectedReceives = () => { if (selectedReceives.size === 0) return; setDeleteConfirm({ show: true, type: 'receive', id: null, text: '', count: selectedReceives.size }); }; // ì‹¤ì œ Receive ì‚­ì œ ì‹¤í–‰ const confirmDeleteReceives = () => { const idsToDelete = [...selectedReceives]; setReceiveCycles(prev => prev.filter(r => !idsToDelete.includes(r.id))); setSelectedReceives(new Set()); setDeleteConfirm({ show: false, type: '', id: null, text: '', count: 0 }); }; // Kitting ì¶”ê°€ const addKitting = () => { if (!newKitting.productionOrder) return; const newItem = { id: Date.now(), ...newKitting, materialDesc: '', status: 'waiting', // waiting, in-progress, completed createdAt: new Date().toISOString(), completedAt: null, leadTimeDays: null }; setKittingData(prev => [...prev, newItem]); setNewKitting({ productionOrder: '', model: 'RSC48', basicStartDate: '', worker: 'Z01', isUrgent: false }); setShowKittingModal(false); }; // Kitting ì™„ë£Œ ì²˜ë¦¬ const completeKitting = (id) => { const now = new Date(); // ë¨¼ì € productionOrder ì°¾ê¸° const targetKitting = kittingData.find(k => k.id === id); const productionOrder = targetKitting?.productionOrder; setKittingData(prev => prev.map(k => { if (k.id === id) { // ì‹œì‘ ì‹œê°„ì´ ìˆìœ¼ë©´ ì‹¤ì œ ì‘ì—… ì‹œê°„ ê³„ì‚°, ì—†ìœ¼ë©´ 0 let leadTimeDays = 0; if (k.startedAt) { const startTime = new Date(k.startedAt); leadTimeDays = getBusinessDays(startTime, now); // ì˜ì—…ì¼ ê¸°ì¤€ (ì£¼ë§+ê³µíœ´ì¼ ì œì™¸) } return { ...k, status: 'completed', completedAt: now.toLocaleDateString('ko-KR', { timeZone: 'Asia/Seoul', year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\. /g, '-').replace('.', ''), leadTimeDays }; } return k; })); // ë¶ˆì¶œ Cycleë„ ê°™ì´ ì™„ë£Œ ì²˜ë¦¬ if (productionOrder) { const nowStr = now.toISOString().slice(0, 16).replace('T', ' '); setPickCycles(prev => prev.map(p => { if ((p.productionOrder === productionOrder || p.orderId === productionOrder) && p.status !== 'completed') { const cycleMin = p.startTime ? calculateWorkingMinutes(p.startTime, now.toISOString()) : 0; return { ...p, completed: nowStr, cycleMin, status: 'completed' }; } return p; })); } }; // Kitting ì‹œì‘ ì²˜ë¦¬ const startKitting = (id) => { const now = new Date().toISOString(); // ë¨¼ì € productionOrder ì°¾ê¸° const targetKitting = kittingData.find(k => k.id === id); const productionOrder = targetKitting?.productionOrder; setKittingData(prev => prev.map(k => k.id === id ? { ...k, status: 'in-progress', startedAt: now } : k )); // ë¶ˆì¶œ Cycleë„ ê°™ì´ ì‹œì‘ ì²˜ë¦¬ if (productionOrder) { setPickCycles(prev => prev.map(p => (p.productionOrder === productionOrder || p.orderId === productionOrder) && p.status === 'waiting' ? { ...p, startTime: now, status: 'in-progress' } : p )); } }; // Kitting ì¼ì‹œì •ì§€ ì²˜ë¦¬ const pauseKitting = (id) => { const now = new Date().toISOString(); // ë¨¼ì € productionOrder ì°¾ê¸° const targetKitting = kittingData.find(k => k.id === id); const productionOrder = targetKitting?.productionOrder; setKittingData(prev => prev.map(k => k.id === id ? { ...k, status: 'paused', pausedAt: now } : k )); // ë¶ˆì¶œ Cycleë„ ê°™ì´ ì¼ì‹œì •ì§€ ì²˜ë¦¬ if (productionOrder) { setPickCycles(prev => prev.map(p => (p.productionOrder === productionOrder || p.orderId === productionOrder) && p.status === 'in-progress' ? { ...p, pausedAt: now, status: 'paused' } : p )); } }; // Kitting ì¬ê°œ ì²˜ë¦¬ const resumeKitting = (id) => { const now = new Date(); // ë¨¼ì € productionOrder ì°¾ê¸° const targetKitting = kittingData.find(k => k.id === id); const productionOrder = targetKitting?.productionOrder; setKittingData(prev => prev.map(k => { if (k.id === id && k.status === 'paused') { const pausedMs = k.pausedAt ? now - new Date(k.pausedAt) : 0; return { ...k, status: 'in-progress', totalPausedMs: (k.totalPausedMs || 0) + pausedMs, pausedAt: null }; } return k; })); // ë¶ˆì¶œ Cycleë„ ê°™ì´ ì¬ê°œ ì²˜ë¦¬ if (productionOrder) { setPickCycles(prev => prev.map(p => { if ((p.productionOrder === productionOrder || p.orderId === productionOrder) && p.status === 'paused') { const pausedMs = p.pausedAt ? now - new Date(p.pausedAt) : 0; return { ...p, totalPausedMs: (p.totalPausedMs || 0) + pausedMs, pausedAt: null, status: 'in-progress' }; } return p; })); } }; // Kitting ì„ íƒ í† ê¸€ const toggleKittingSelection = (id) => { setSelectedKittings(prev => { const newSet = new Set(prev); if (newSet.has(id)) newSet.delete(id); else newSet.add(id); return newSet; }); }; // Kitting ì¼ê´„ ì™„ë£Œ const completeSelectedKittings = () => { if (selectedKittings.size === 0) return; const now = new Date(); const idsToComplete = Array.from(selectedKittings); // ë¨¼ì € Production Order ëª©ë¡ ìˆ˜ì§‘ const productionOrders = kittingData .filter(k => idsToComplete.includes(k.id) && k.status !== 'completed') .map(k => k.productionOrder); setKittingData(prev => prev.map(k => { if (idsToComplete.includes(k.id) && k.status !== 'completed') { // ì‹œì‘ ì‹œê°„ì´ ìˆìœ¼ë©´ ì‹¤ì œ ì‘ì—… ì‹œê°„ ê³„ì‚°, ì—†ìœ¼ë©´ 0 let leadTimeDays = 0; if (k.startedAt) { const startTime = new Date(k.startedAt); leadTimeDays = getBusinessDays(startTime, now); // ì˜ì—…ì¼ ê¸°ì¤€ (ì£¼ë§+ê³µíœ´ì¼ ì œì™¸) } return { ...k, status: 'completed', completedAt: now.toLocaleDateString('ko-KR', { timeZone: 'Asia/Seoul', year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\. /g, '-').replace('.', ''), leadTimeDays }; } return k; })); // ë¶ˆì¶œ Cycleë„ ê°™ì´ ì™„ë£Œ if (productionOrders.length > 0) { const nowStr = now.toISOString().slice(0, 16).replace('T', ' '); setPickCycles(prev => prev.map(p => { if (productionOrders.includes(p.productionOrder) && p.status !== 'completed') { const cycleMin = p.startTime ? calculateWorkingMinutes(p.startTime, now.toISOString()) : 0; return { ...p, completed: nowStr, cycleMin, status: 'completed' }; } return p; })); } setSelectedKittings(new Set()); }; // Kitting ì¼ê´„ ì‚­ì œ const deleteSelectedKittings = () => { if (selectedKittings.size === 0) return; setDeleteConfirm({ show: true, type: 'kitting', id: null, text: '', count: selectedKittings.size }); }; const confirmDeleteKittings = () => { const idsToDelete = [...selectedKittings]; setKittingData(prev => prev.filter(k => !idsToDelete.includes(k.id))); setSelectedKittings(new Set()); setDeleteConfirm({ show: false, type: '', id: null, text: '', count: 0 }); }; // Kitting CSV ì—…ë¡œë“œ const handleKittingCsvUpload = (e) => { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (event) => { try { const text = event.target.result; const lines = text.split('\n').filter(line => line.trim()); if (lines.length < 2) { alert('ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; } // í—¤ë” íŒŒì‹± const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, '')); const orderIdx = headers.findIndex(h => /^Order$/i.test(h)); const descIdx = headers.findIndex(h => /Material description/i.test(h)); const materialNumIdx = headers.findIndex(h => /Material Number/i.test(h)); const startDateIdx = headers.findIndex(h => /Basic start date/i.test(h)); if (orderIdx === -1) { alert('âŒ Order ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; } // Model ë§¤í•‘ í•¨ìˆ˜ (Material Number ê¸°ì¤€) - ë¶ˆì¶œê³¼ ë™ì¼ // RSC16(AS4500), RSC48(AS8500), CSC48(AS8000), FSC16(AS4600), CSC16(AS6000), HSM3.0(A2715) const getModelFromMaterial = (materialNum) => { if (!materialNum) return 'Spare Parts'; const m = materialNum.toUpperCase(); if (m === 'AS4500') return 'RSC16'; if (m === 'AS8500') return 'RSC48'; if (m === 'AS8000') return 'CSC48'; if (m === 'AS4600') return 'FSC16'; if (m === 'AS6000') return 'CSC16'; if (m === 'A2715') return 'HSM3.0'; return 'Spare Parts'; }; // ë‚ ì§œ í˜•ì‹ í†µì¼ const normalizeDate2 = (d) => { if (!d) return ''; d = d.trim().split(' ')[0]; if (/^\d{2}-\d{2}-\d{2}$/.test(d)) return '20' + d; if (/^\d{2}\.\d{2}\.\d{4}$/.test(d)) { var p=d.split('.'); return p[2]+'-'+p[1]+'-'+p[0]; } if (/^\d{2}\/\d{2}\/\d{4}$/.test(d)) { var p=d.split('/'); return p[2]+'-'+p[0]+'-'+p[1]; } return d; }; const newItems = []; for (let i = 1; i < lines.length; i++) { // CSV íŒŒì‹± (ì‰¼í‘œ ì²˜ë¦¬) const row = lines[i].match(/(".*?"|[^,]+)(?=\s*,|\s*$)/g); if (!row) continue; const values = row.map(v => v.trim().replace(/^"|"$/g, '').replace(/\r/g, '')); const productionOrder = values[orderIdx]; if (!productionOrder) continue; // ì¤‘ë³µ ì²´í¬ const exists = kittingData.some(k => k.productionOrder === productionOrder); if (exists) continue; const materialDesc = descIdx >= 0 ? values[descIdx] : ''; const materialNum = materialNumIdx >= 0 ? values[materialNumIdx] : ''; const startDate = startDateIdx >= 0 ? values[startDateIdx] : ''; const model = getModelFromMaterial(materialNum); newItems.push({ id: Date.now() + i, productionOrder, model, materialNum, materialDesc, basicStartDate: normalizeDate2(startDate) || new Date().toISOString().split('T')[0], worker: 'Z01', isUrgent: false, status: 'waiting', createdAt: new Date().toISOString(), completedAt: null, leadTimeDays: null }); } if (newItems.length > 0) { setKittingData(prev => [...prev, ...newItems]); alert(`âœ… ${newItems.length}ê°œì˜ Kitting í•­ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`); } else { alert('ì¶”ê°€í•  ìƒˆë¡œìš´ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. (ì¤‘ë³µ ì œì™¸)'); } } catch (error) { alert('âŒ CSV íŒŒì¼ íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); console.error(error); } }; reader.readAsText(file); e.target.value = ''; }; // Kitting ì—‘ì…€ ë‹¤ìš´ë¡œë“œ const downloadKittingExcel = async () => { try { const XLSX = await new Promise((res)=>{if(window.XLSX){res(window.XLSX);return;}var s=document.createElement('script');s.src='https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js';s.onload=()=>res(window.XLSX);document.head.appendChild(s);}); const data = kittingData.map(k => ({ 'Production Order': k.productionOrder, 'Model': k.model, 'Material Description': k.materialDesc || '', 'ì‹œì‘ì˜ˆì •ì¼': k.basicStartDate || '', 'ë‹´ë‹¹ì': k.worker || '', 'ê¸´ê¸‰': k.isUrgent ? 'ê¸´ê¸‰' : 'ì¼ë°˜', 'ìƒíƒœ': k.status === 'completed' ? 'ì™„ë£Œ' : k.status === 'in-progress' ? 'ì§„í–‰ì¤‘' : k.status === 'paused' ? 'ì¼ì‹œì •ì§€' : 'ëŒ€ê¸°', 'ì™„ë£Œì¼': k.completedAt || '', 'Lead Time(ì¼)': k.leadTimeDays || '' })); const worksheet = XLSX.utils.json_to_sheet(data); const workbook = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(workbook, worksheet, 'Kittingí˜„í™©'); XLSX.writeFile(workbook, `PBK_Kittingí˜„í™©_${new Date().toISOString().slice(0,10)}.xlsx`); } catch (error) { // í´ë°±: CSVë¡œ ë‹¤ìš´ë¡œë“œ const headers = ['Production Order', 'Model', 'Material Description', 'ì‹œì‘ì˜ˆì •ì¼', 'ë‹´ë‹¹ì', 'ê¸´ê¸‰', 'ìƒíƒœ', 'ì™„ë£Œì¼', 'Lead Time(ì¼)']; const rows = kittingData.map(k => [ k.productionOrder, k.model, k.materialDesc || '', k.basicStartDate || '', k.worker || '', k.isUrgent ? 'ê¸´ê¸‰' : 'ì¼ë°˜', k.status === 'completed' ? 'ì™„ë£Œ' : k.status === 'in-progress' ? 'ì§„í–‰ì¤‘' : 'ëŒ€ê¸°', k.completedAt || '', k.leadTimeDays || '' ]); const csvContent = [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n'); const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' }); const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = `Kitting_í˜„í™©_${new Date().toISOString().split('T')[0]}.csv`; link.click(); } }; // Kitting ìˆ˜ì • ì €ì¥ const saveEditKitting = () => { if (!editingKitting) return; setKittingData(prev => prev.map(k => k.id === editingKitting.id ? editingKitting : k)); setEditingKitting(null); }; // Kitting í•„í„°ë§ ë° ì •ë ¬ const filteredSortedKittings = React.useMemo(() => { let result = [...kittingData]; // ì›”ë³„ í•„í„° if (kittingFilterMonth) { const ym=kittingFilterMonth; const ymShort=ym.slice(2); result=result.filter(k=>{const dt=k.startedAt||k.completedAt;return dt?dt.startsWith(ym)||dt.startsWith(ymShort):k.basicStartDate?.startsWith(ym)||k.basicStartDate?.startsWith(ymShort);}); } // ê²€ìƒ‰ì–´ í•„í„° if (kittingSearchTerm) { const term = kittingSearchTerm.toLowerCase(); result = result.filter(k => k.productionOrder?.toLowerCase().includes(term) || k.materialDesc?.toLowerCase().includes(term) ); } // ëª¨ë¸ í•„í„° if (kittingFilterModel !== 'all') { if (kittingFilterModel === 'Maxwell 48') { result = result.filter(k => ['RSC48', 'CSC48'].includes(k.model)); } else if (kittingFilterModel === 'Maxwell 16') { result = result.filter(k => ['RSC16', 'CSC16', 'FSC16'].includes(k.model)); } else { result = result.filter(k => k.model === kittingFilterModel); } } // ìƒíƒœ í•„í„° if (kittingFilterStatus !== 'all') { result = result.filter(k => k.status === kittingFilterStatus); } // ì •ë ¬ result.sort((a, b) => { let aVal = a[kittingSortBy] || ''; let bVal = b[kittingSortBy] || ''; if (kittingSortOrder === 'asc') return aVal.localeCompare(bVal); return bVal.localeCompare(aVal); }); return result; }, [kittingData, kittingFilterMonth, kittingSearchTerm, kittingFilterModel, kittingFilterStatus, kittingSortBy, kittingSortOrder]); // Pick ìˆ˜ì • ì €ì¥ const saveEditPick = () => { if (!editingPick) return; // ë¶ˆì¶œ Cycle ì €ì¥ setPickCycles(prev => prev.map(p => p.id === editingPick.id ? editingPick : p)); // Kitting ë‹´ë‹¹ìë„ ê°™ì´ ë³€ê²½ const productionOrder = editingPick.productionOrder || editingPick.orderId; if (productionOrder && editingPick.worker) { setKittingData(prev => prev.map(k => k.productionOrder === productionOrder ? { ...k, worker: editingPick.worker } : k )); } setEditingPick(null); }; // Receive ìˆ˜ì • ì €ì¥ const saveEditReceive = () => { if (!editingReceive) return; // delivery í˜•ì‹ ì •ê·œí™” (í•˜ì´í”ˆ êµ¬ë¶„ â†’ ê³µë°± êµ¬ë¶„) const cleaned = {...editingReceive}; if (cleaned.delivery) { const dm = cleaned.delivery.match(/^(\d{4}-\d{2}-\d{2})[\-T\s](\d{2}:\d{2})/); if (dm) cleaned.delivery = dm[1] + ' ' + dm[2]; } setReceiveCycles(prev => prev.map(r => r.id === cleaned.id ? cleaned : r)); setEditingReceive(null); }; // ========== v15 í—¬í¼ í•¨ìˆ˜ë“¤ ========== // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ const showToast = (message, type = 'success') => { const id = Date.now(); setToasts(prev => [...prev, { id, message, type }]); setTimeout(() => { setToasts(prev => prev.filter(t => t.id !== id)); }, 3000); }; // v17: XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ ë™ì  ë¡œë“œ í—¬í¼ const ensureXLSX = () => new Promise((resolve, reject) => { if (window.XLSX) return resolve(); const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js'; script.onload = resolve; script.onerror = () => reject(new Error('XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨')); document.head.appendChild(script); }); // v17: GR Cancel SUM ì‹œíŠ¸ íŒŒì‹± í•¨ìˆ˜ (showToast ì´í›„ ì •ì˜) const parseGRCancelExcel = async (file) => { setGrCancelUploadStatus('loading'); setGrCancelUploadMsg('íŒŒì¼ ì½ëŠ” ì¤‘...'); try { await ensureXLSX(); } catch (err) { setGrCancelUploadStatus('error'); setGrCancelUploadMsg('âŒ XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨'); return; } const reader = new FileReader(); reader.onload = (e) => { try { const data = new Uint8Array(e.target.result); const workbook = window.XLSX.read(data, { type: 'array' }); const MONTH_NAMES = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']; const newQty = {}; const newCancel = {}; // â”€â”€ STEP 1: SUM ì‹œíŠ¸ íŒŒì‹± â”€â”€ const sumSheetName = workbook.SheetNames.find(n => n.toUpperCase() === 'SUM'); if (sumSheetName) { const ws = workbook.Sheets[sumSheetName]; const rows = window.XLSX.utils.sheet_to_json(ws, { header: 1, defval: null }); if (rows.length >= 5) { const headerRow = rows[0]; const qtyRow = rows[1]; const cancelRow = rows[3]; let currentYear = null; for (let col = 1; col < headerRow.length; col++) { const cell = headerRow[col]; if (cell === null || cell === undefined) continue; if (typeof cell === 'number' && cell >= 2020 && cell <= 2030) { currentYear = Math.round(cell); continue; } if (typeof cell === 'string' && MONTH_NAMES.includes(cell)) { if (!currentYear) continue; const mNum = MONTH_NAMES.indexOf(cell) + 1; const key = `${currentYear}-${String(mNum).padStart(2, '0')}`; const qty = qtyRow[col]; const cancel = cancelRow[col]; if (typeof qty === 'number' && qty > 0) newQty[key] = Math.round(qty); if (typeof cancel === 'number' && cancel >= 0) newCancel[key] = Math.round(cancel); } } } } const qtyCount = Object.keys(newQty).length; const cancelCount = Object.keys(newCancel).length; if (qtyCount === 0) throw new Error('SUM ì‹œíŠ¸ì—ì„œ ë°ì´í„°ë¥¼ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. SUM ì‹œíŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.'); setKpiData(prev => ({ ...prev, grCancel: { ...prev.grCancel, ...newCancel }, grCancelQty: { ...prev.grCancelQty, ...newQty } })); setGrCancelUploadStatus('success'); setGrCancelUploadMsg(`âœ… íŒŒì‹± ì™„ë£Œ: ${qtyCount}ê°œì›” (SUM + ê°œë³„ ì‹œíŠ¸ ë³´ì™„)`); showToast(`GR Cancel ë°ì´í„° ${qtyCount}ê°œì›” ë¡œë“œ ì™„ë£Œ!`, 'success'); } catch (err) { setGrCancelUploadStatus('error'); setGrCancelUploadMsg(`âŒ ì˜¤ë¥˜: ${err.message}`); showToast('íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨: ' + err.message, 'error'); } }; reader.readAsArrayBuffer(file); }; // v17: ì¬ê³  ì†ì‹¤ìœ¨ ì—‘ì…€ ì—…ë¡œë“œ íŒŒì‹± í•¨ìˆ˜ const parseInventoryLossExcel = async (file) => { setInventoryLossUploadStatus('loading'); setInventoryLossUploadMsg('íŒŒì¼ ì½ëŠ” ì¤‘...'); try { await ensureXLSX(); } catch (err) { setInventoryLossUploadStatus('error'); setInventoryLossUploadMsg('âŒ XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨'); return; } const reader = new FileReader(); reader.onload = (e) => { try { const data = new Uint8Array(e.target.result); const workbook = window.XLSX.read(data, { type: 'array' }); const sheetName = workbook.SheetNames.find(n => n === 'Ratio') || workbook.SheetNames[0]; const ws = workbook.Sheets[sheetName]; const rows = window.XLSX.utils.sheet_to_json(ws, { header: 1, defval: null }); const newInvAdj = {}; const headerRow = rows[0] || []; const adjustRow = rows[3] || []; for (let col = 1; col < headerRow.length; col++) { const h = headerRow[col]; if (!h) continue; const qMatch = typeof h === 'string' && h.match(/(\d{4})\s*\/\s*Q(\d)/); if (qMatch) { const year = parseInt(qMatch[1]); const quarter = parseInt(qMatch[2]); const month = quarter * 3; const key = `${year}-${String(month).padStart(2, '0')}`; const val = adjustRow[col]; if (typeof val === 'number') newInvAdj[key] = parseFloat((val * 100).toFixed(4)); } } if (Object.keys(newInvAdj).length > 0) { setKpiData(prev => ({ ...prev, inventoryAdjust: { ...prev.inventoryAdjust, ...newInvAdj } })); setInventoryLossUploadStatus('success'); setInventoryLossUploadMsg(`âœ… ${Object.keys(newInvAdj).length}ê°œ ê¸°ê°„ ë°ì´í„° ë¡œë“œ (ë¶„ê¸°ë³„). ì›”ë³„ í˜•ì‹ í™•ì • í›„ ì—…ë°ì´íŠ¸ ì˜ˆì •.`); showToast('ì¬ê³  ì†ì‹¤ìœ¨ ë°ì´í„° ì—…ë¡œë“œ ì™„ë£Œ', 'success'); } else { setInventoryLossUploadStatus('error'); setInventoryLossUploadMsg('âŒ íŒŒì‹±ëœ ë°ì´í„° ì—†ìŒ. í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.'); } } catch (err) { setInventoryLossUploadStatus('error'); setInventoryLossUploadMsg(`âŒ ì˜¤ë¥˜: ${err.message}`); showToast('íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨: ' + err.message, 'error'); } }; reader.readAsArrayBuffer(file); }; // ì•Œë¦¼ ì¶”ê°€ const addNotification = (title, message, type = 'info') => { const notification = { id: Date.now(), title, message, type, timestamp: new Date().toISOString(), read: false }; setNotifications(prev => [notification, ...prev].slice(0, 50)); // ìµœëŒ€ 50ê°œ ìœ ì§€ }; // ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ const markNotificationAsRead = (id) => { setNotifications(prev => prev.map(n => n.id === id ? { ...n, read: true } : n)); }; // ëª¨ë“  ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ const markAllNotificationsAsRead = () => { setNotifications(prev => prev.map(n => ({ ...n, read: true }))); }; // ì•Œë¦¼ ì‚­ì œ const deleteNotification = (id) => { setNotifications(prev => prev.filter(n => n.id !== id)); }; // ëª¨ë“  ì•Œë¦¼ ì‚­ì œ const clearAllNotifications = () => { setNotifications([]); }; // ë°ì´í„° íˆìŠ¤í† ë¦¬ ì¶”ê°€ const addDataHistory = (type, description, itemCount) => { const history = { id: Date.now(), type, description, itemCount, timestamp: new Date().toISOString() }; setDataHistory(prev => [history, ...prev].slice(0, 100)); // ìµœëŒ€ 100ê°œ ìœ ì§€ }; // ê²½ê³¼ ì‹œê°„ ê³„ì‚° (ìƒì„¸) const getElapsedTimeDetail = (dateString) => { if (!dateString) return 'ì •ë³´ ì—†ìŒ'; try { // í•œêµ­ì–´ ë‚ ì§œ í˜•ì‹ íŒŒì‹±: "2026. 2. 9. ì˜¤í›„ 3:30:00" ë˜ëŠ” "2026. 2. 9. ì˜¤ì „ 10:30:00" let past; if (dateString.includes('ì˜¤ì „') || dateString.includes('ì˜¤í›„')) { // í•œêµ­ì–´ í˜•ì‹ const isAM = dateString.includes('ì˜¤ì „'); const cleaned = dateString.replace('ì˜¤ì „', '').replace('ì˜¤í›„', '').trim(); const parts = cleaned.split(/[.\s:]+/).filter(p => p); if (parts.length >= 5) { let hours = parseInt(parts[3]); if (!isAM && hours !== 12) hours += 12; if (isAM && hours === 12) hours = 0; past = new Date( parseInt(parts[0]), // year parseInt(parts[1]) - 1, // month (0-indexed) parseInt(parts[2]), // day hours, parseInt(parts[4]), parseInt(parts[5]) || 0 ); } } // ISO í˜•ì‹ ë˜ëŠ” ê¸°íƒ€ í˜•ì‹ ì‹œë„ if (!past || isNaN(past.getTime())) { past = new Date(dateString); } if (isNaN(past.getTime())) { // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì›ë³¸ ë¬¸ìì—´ì—ì„œ ì‹œê°„ ë¶€ë¶„ ì œê±°í•˜ê³  ë°˜í™˜ return dateString.replace(/:\d{2}$/, ''); } const now = new Date(); const diffMs = now - past; const minutes = Math.floor(diffMs / (1000 * 60)); const hours = Math.floor(diffMs / (1000 * 60 * 60)); const days = Math.floor(diffMs / (1000 * 60 * 60 * 24)); if (days > 0) { return `${days}ì¼ ì „`; } else if (hours > 0) { return `${hours}ì‹œê°„ ì „`; } else if (minutes > 0) { return `${minutes}ë¶„ ì „`; } else { return 'ë°©ê¸ˆ ì „'; } } catch (e) { // ì—ëŸ¬ ì‹œ ì›ë³¸ ë°˜í™˜ return dateString.replace(/:\d{2}$/, ''); } }; // ê³µê°„ ìµœì í™” ë¶„ì„ (ê°œì„ ëœ ë²„ì „) const analyzeSpaceOptimization = () => { const suggestions = []; if (inventoryData.length === 0) return suggestions; const SPECIAL_AREAS = ['D2', 'E', 'F1', 'LABEL']; // 1. ì˜ì—­ë³„ ê³µê°„ ì‚¬ìš©ë¥  ê³„ì‚° (í•µì‹¬!) const areaUtils = []; rackSummary.forEach(rack => { if (SPECIAL_AREAS.includes(rack.id)) return; const areaItems = inventoryData.filter(item => { const bin = item.bin || ''; return bin.startsWith(rack.id + '-') || bin === rack.id; }); const binGroups = {}; areaItems.forEach(item => { const bin = item.bin || rack.id; if (!binGroups[bin]) binGroups[bin] = []; binGroups[bin].push(item); }); let totalCur = 0, totalMax = 0; Object.entries(binGroups).forEach(([bin, items]) => { let binCur = 0; items.forEach(item => { const qtyPerBox = MATERIAL_QTY_PER_BOX[item.material] || 1; binCur += (item.stock || 0) / qtyPerBox; }); totalCur += binCur; const binInfo = BIN_RACK_INFO[bin] || { rackType: 'ê²½ëŸ‰ë™', rackCount: 1 }; if (binInfo.maxBoxes) { totalMax += binInfo.maxBoxes; } else if (binInfo.mixed) { const binBoxTypes = items.map(i => MATERIAL_BOX_MAP[i.material] || 'PLASTIC-S'); const tc = {}; binBoxTypes.forEach(t => { tc[t] = (tc[t] || 0) + 1; }); const mainBT = Object.entries(tc).sort((a, b) => b[1] - a[1])[0]?.[0] || 'PLASTIC-S'; binInfo.mixed.forEach(m => { const s = BOXES_PER_SHELF[m.type] || BOXES_PER_SHELF['ê²½ëŸ‰ë™']; totalMax += (s[mainBT] || s['PLASTIC-S'] || 2) * m.count; }); } else { const binBoxTypes = items.map(i => MATERIAL_BOX_MAP[i.material] || 'PLASTIC-S'); const tc = {}; binBoxTypes.forEach(t => { tc[t] = (tc[t] || 0) + 1; }); const mainBT = Object.entries(tc).sort((a, b) => b[1] - a[1])[0]?.[0] || 'PLASTIC-S'; const s = BOXES_PER_SHELF[binInfo.rackType] || BOXES_PER_SHELF['ê²½ëŸ‰ë™']; const perShelf = s[mainBT] || s['PLASTIC-S'] || 2; totalMax += perShelf * binInfo.rackCount * (binInfo.shelves || 1); } }); const util = totalMax > 0 ? (totalCur / totalMax) * 100 : 0; areaUtils.push({ id: rack.id, util: Math.round(util), curBoxes: totalCur, maxBoxes: totalMax, items: rack.items }); }); // ì „ì²´ ê³µê°„ ì‚¬ìš©ë¥  const totalCur = areaUtils.reduce((s, a) => s + a.curBoxes, 0); const totalMax = areaUtils.reduce((s, a) => s + a.maxBoxes, 0); const overallUtil = totalMax > 0 ? Math.round((totalCur / totalMax) * 100) : 0; suggestions.push({ type: 'utilization_score', priority: overallUtil > 85 ? 'danger' : overallUtil > 70 ? 'warning' : overallUtil > 50 ? 'info' : 'success', title: 'ì „ì²´ ê³µê°„ ì‚¬ìš©ë¥ ', description: `í˜„ì¬ ${totalCur.toFixed(0)}ë°•ìŠ¤ / ìµœëŒ€ ${totalMax.toFixed(0)}ë°•ìŠ¤`, score: overallUtil, recommendation: overallUtil > 85 ? 'ê³µê°„ì´ ê±°ì˜ í¬í™” ìƒíƒœì…ë‹ˆë‹¤. ì¶”ê°€ ë™ í™•ë³´ë¥¼ ê²€í† í•˜ì„¸ìš”.' : overallUtil > 70 ? 'ì ì • ìˆ˜ì¤€ì…ë‹ˆë‹¤. íš¨ìœ¨ì ì¸ ë°°ì¹˜ë¥¼ ìœ ì§€í•˜ì„¸ìš”.' : 'ì—¬ìœ  ê³µê°„ì´ ì¶©ë¶„í•©ë‹ˆë‹¤.' }); // 2. ìœ„í—˜ ì˜ì—­ (80% ì´ìƒ) const dangerAreas = areaUtils.filter(a => a.util >= 80).sort((a, b) => b.util - a.util); if (dangerAreas.length > 0) { suggestions.push({ type: 'overloaded_bins', priority: 'danger', title: `ê³µê°„ ë¶€ì¡± ì˜ì—­ ${dangerAreas.length}ê°œ`, description: '80% ì´ìƒ ì ì¬ëœ ì˜ì—­ì…ë‹ˆë‹¤. ì¬ë°°ì¹˜ ë˜ëŠ” ë™ ì¶”ê°€ê°€ í•„ìš”í•©ë‹ˆë‹¤.', details: dangerAreas.slice(0, 8).map(a => ({ rack: a.id, bin: '', count: a.util, totalStock: a.items })), action: dangerAreas.map(a => `${a.id}(${a.util}%)`).join(', ') }); } // 3. ì—¬ìœ  ì˜ì—­ (30% ë¯¸ë§Œ) const lowAreas = areaUtils.filter(a => a.util < 30 && a.items > 0).sort((a, b) => a.util - b.util); if (lowAreas.length > 0) { suggestions.push({ type: 'empty_bins', priority: 'success', title: `ì—¬ìœ  ê³µê°„ ì˜ì—­ ${lowAreas.length}ê°œ`, description: '30% ë¯¸ë§Œ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤. ê³¼ë°€ ì˜ì—­ í’ˆëª© ì´ë™ì— í™œìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', details: lowAreas.slice(0, 8).map(a => ({ rack: a.id, bin: `${a.util}%`, count: 0, totalStock: a.items })), action: lowAreas.map(a => `${a.id}(${a.util}%)`).join(', ') }); } // 4. ì¬ë°°ì¹˜ ì¶”ì²œ (ê³¼ë°€ â†’ ì—¬ìœ ) if (dangerAreas.length > 0 && lowAreas.length > 0) { const recs = []; dangerAreas.slice(0, 3).forEach(da => { const sameSeries = lowAreas.find(la => { return RACK_MODEL_SERIES[la.id] === RACK_MODEL_SERIES[da.id]; }); if (sameSeries) { recs.push({ from: `${da.id}(${da.util}%)`, to: `${sameSeries.id}(${sameSeries.util}%)`, reason: 'ê°™ì€ ì‹œë¦¬ì¦ˆ ë‚´ ì¬ë°°ì¹˜' }); } }); if (recs.length > 0) { suggestions.push({ type: 'relocation_recommendation', priority: 'info', title: 'ì¬ë°°ì¹˜ ì¶”ì²œ', description: 'ê°™ì€ ì‹œë¦¬ì¦ˆ ë‚´ì—ì„œ ê³¼ë°€ â†’ ì—¬ìœ  ì˜ì—­ìœ¼ë¡œ í’ˆëª© ì´ë™ì„ ê¶Œì¥í•©ë‹ˆë‹¤.', details: recs, action: 'ê³µê°„ ê· í˜•ì´ ê°œì„ ë©ë‹ˆë‹¤.' }); } } return suggestions; }; // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ const validateUploadData = (data, type) => { const errors = []; const warnings = []; if (type === 'stock') { // í•„ìˆ˜ í•„ë“œ ì²´í¬ data.forEach((row, idx) => { if (!row.material) { errors.push(`í–‰ ${idx + 1}: Material ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.`); } if (!row.bin) { warnings.push(`í–‰ ${idx + 1}: Bin ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤ (Material: ${row.material})`); } if (row.stock < 0) { errors.push(`í–‰ ${idx + 1}: ì¬ê³  ìˆ˜ëŸ‰ì´ ìŒìˆ˜ì…ë‹ˆë‹¤ (${row.stock})`); } }); // ì¤‘ë³µ ì²´í¬ const duplicates = {}; data.forEach(row => { const key = `${row.material}-${row.bin}`; duplicates[key] = (duplicates[key] || 0) + 1; }); Object.entries(duplicates).forEach(([key, count]) => { if (count > 1) { warnings.push(`ì¤‘ë³µ ë°ì´í„°: ${key} (${count}ê±´)`); } }); } if (type === 'openPO') { data.forEach((row, idx) => { if (!row.material) { errors.push(`í–‰ ${idx + 1}: Material ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.`); } if (!row.poNo) { warnings.push(`í–‰ ${idx + 1}: PO ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.`); } if (row.qty <= 0) { warnings.push(`í–‰ ${idx + 1}: ìˆ˜ëŸ‰ì´ 0 ì´í•˜ì…ë‹ˆë‹¤.`); } }); } if (type === 'bom') { Object.entries(data).forEach(([model, items]) => { if (Object.keys(items).length === 0) { warnings.push(`${model}: BOM í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.`); } Object.entries(items).forEach(([material, qty]) => { if (qty <= 0) { warnings.push(`${model} - ${material}: ìˆ˜ëŸ‰ì´ 0 ì´í•˜ì…ë‹ˆë‹¤.`); } }); }); } return { isValid: errors.length === 0, errors, warnings, summary: `${errors.length}ê°œ ì˜¤ë¥˜, ${warnings.length}ê°œ ê²½ê³ ` }; }; // ë°ì´í„° ì´ˆê¸°í™” const clearData = () => { if (confirm('ëª¨ë“  ì¬ê³  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { setInventoryData([]); setRackSummary([]); setLastUpdated(null); safeStorage.removeItem('pbk_inventory'); safeStorage.removeItem('pbk_last_updated'); showToast('ì¬ê³  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info'); addNotification('ë°ì´í„° ì´ˆê¸°í™”', 'ëª¨ë“  ì¬ê³  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning'); } }; // ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ) const exportAllData = () => { const exportData = { version: '1.2', exportDate: new Date().toISOString(), inventory: inventoryData, weightData: weightData, pickCycles: pickCycles, receiveCycles: receiveCycles, kittingData: kittingData, todoList: todoList, rackConfig: rackConfig, lastUpdated: lastUpdated, tempHumidityData: tempHumidityData, tempHumidityRecorder: tempHumidityRecorder, openPOData: openPOData, openPOLastUpdated: openPOLastUpdated, customBomData: customBomData, bomLastUpdated: bomLastUpdated }; const jsonStr = JSON.stringify(exportData, null, 2); setBackupData(jsonStr); }; const selectAllBackupText = () => { const textarea = document.getElementById('backup-textarea'); if (textarea) { textarea.select(); textarea.setSelectionRange(0, textarea.value.length); alert('âœ… í…ìŠ¤íŠ¸ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤!\nCtrl+Cë¡œ ë³µì‚¬ í›„ ë©”ëª¨ì¥ì— ë¶™ì—¬ë„£ê¸°í•˜ì„¸ìš”.'); } }; // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (JSON íŒŒì¼ì—ì„œ ë³µì›) const importAllData = (e) => { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (event) => { try { const importData = JSON.parse(event.target.result); if (!importData.version) { alert('âŒ ìœ íš¨í•˜ì§€ ì•Šì€ ë°±ì—… íŒŒì¼ì…ë‹ˆë‹¤.'); return; } if (confirm(`${importData.exportDate?.slice(0,10) || 'ì•Œ ìˆ˜ ì—†ìŒ'} ë°±ì—…ì„ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\ní˜„ì¬ ë°ì´í„°ê°€ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.`)) { if (importData.inventory) { setInventoryData(importData.inventory); processRackSummary(importData.inventory); safeStorage.setItem('pbk_inventory', JSON.stringify(importData.inventory)); } if (importData.weightData) { setWeightData(importData.weightData); safeStorage.setItem('pbk_weight_data', JSON.stringify(importData.weightData)); } if (importData.pickCycles) { setPickCycles(importData.pickCycles); safeStorage.setItem('pbk_pick_cycles', JSON.stringify(importData.pickCycles)); } if (importData.receiveCycles) { setReceiveCycles(importData.receiveCycles); safeStorage.setItem('pbk_receive_cycles', JSON.stringify(importData.receiveCycles)); } if (importData.rackConfig) { setRackConfig(importData.rackConfig); safeStorage.setItem('pbk_rack_config', JSON.stringify(importData.rackConfig)); } if (importData.kittingData) { setKittingData(importData.kittingData); safeStorage.setItem('pbk_kitting_data', JSON.stringify(importData.kittingData)); } if (importData.todoList) { setTodoList(importData.todoList); safeStorage.setItem('pbk_todo_list', JSON.stringify(importData.todoList)); } if (importData.lastUpdated) { setLastUpdated(importData.lastUpdated); safeStorage.setItem('pbk_last_updated', importData.lastUpdated); } // ì˜¨ìŠµë„ ë°ì´í„° ë³µì› if (importData.tempHumidityData) { setTempHumidityData(importData.tempHumidityData); safeStorage.setItem('pbk_temp_humidity_data', JSON.stringify(importData.tempHumidityData)); } if (importData.tempHumidityRecorder) { setTempHumidityRecorder(importData.tempHumidityRecorder); safeStorage.setItem('pbk_temp_humidity_recorder', importData.tempHumidityRecorder); } // Open PO ë°ì´í„° ë³µì› if (importData.openPOData) { setOpenPOData(importData.openPOData); safeStorage.setItem('pbk_open_po_data', JSON.stringify(importData.openPOData)); } if (importData.openPOLastUpdated) { setOpenPOLastUpdated(importData.openPOLastUpdated); safeStorage.setItem('pbk_open_po_last_updated', importData.openPOLastUpdated); } // BOM ë°ì´í„° ë³µì› if (importData.customBomData) { setCustomBomData(importData.customBomData); safeStorage.setItem('pbk_custom_bom_data', JSON.stringify(importData.customBomData)); } if (importData.bomLastUpdated) { setBomLastUpdated(importData.bomLastUpdated); safeStorage.setItem('pbk_bom_last_updated', importData.bomLastUpdated); } alert('âœ… ë°ì´í„°ê°€ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤!'); } } catch (error) { alert('âŒ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); console.error(error); } }; reader.readAsText(file); e.target.value = ''; // ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ê²Œ }; return (
{/* v15: í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */}
{toasts.map(toast => (
{toast.message}
))}
{/* v15: ë¡œë”© ì˜¤ë²„ë ˆì´ */} {isLoading && (
{loadingText || 'ì²˜ë¦¬ ì¤‘...'}

)} {/* Header */}
â¬¡ Promega
Warehouse Management {APP_VERSION}
{totals.items > 0 ? `${totals.items.toLocaleString()}ê°œ í’ˆëª© | ${rackSummary.length}ê°œ ë™ | ${totals.bins}ê°œ Bin` : 'SAP ì—‘ì…€ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”'}

{/* PCìš© ë²„íŠ¼ë“¤ */}
{/* v15: ë‹¨ì¶•í‚¤ ë„ì›€ë§ */} setShowShortcutHelp(true)} className="p-2 bg-white/10 hover:bg-white/20 rounded-lg transition" title="ë‹¨ì¶•í‚¤ ë„ì›€ë§ (Ctrl+?)" > {/* v15: ì•Œë¦¼ ì„¼í„° */} setShowNotificationCenter(true)} className="p-2 bg-white/10 hover:bg-white/20 rounded-lg transition relative" title="ì•Œë¦¼ ì„¼í„° (Ctrl+N)" > {(() => { const now = new Date(); const overdueReceiveCount = receiveCycles.filter(r => { if (r.status === 'completed') return false; if (!r.startTime) return false; return (now - new Date(r.startTime)) / (1000 * 60 * 60) >= 4; }).length; const unreadCount = notifications.filter(n => !n.read).length; const totalAlerts = unreadCount + overdueReceiveCount + (showTempAlert ? 1 : 0) + (showUploadAlert ? 1 : 0) + (showOpenPOAlert ? 1 : 0); return totalAlerts > 0 ? ( {totalAlerts} ) : null; })()} {/* v15: ë‹¤í¬ ëª¨ë“œ í† ê¸€ */} setDarkMode(!darkMode)} className="p-2 bg-white/10 hover:bg-white/20 rounded-lg transition" title={darkMode ? 'ë¼ì´íŠ¸ ëª¨ë“œ' : 'ë‹¤í¬ ëª¨ë“œ'} > {darkMode ? : } Ops Dashboard setShowBackupModal(true)} className="flex items-center gap-2 px-3 py-2 bg-orange-500 hover:bg-orange-600 rounded-lg transition text-sm" title="ë°ì´í„° ë°±ì—… ë° ë³µì›" > ë°±ì—…/ë³µì› setShowDataUploadModal(true)} className="flex items-center gap-2 px-3 py-2 bg-indigo-500 hover:bg-indigo-600 rounded-lg transition text-sm" > ë°ì´í„° ê´€ë¦¬ {(lastUpdated || openPOLastUpdated || bomLastUpdated) && (
ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸

{lastUpdated && (
Stock: {lastUpdated.replace(/:\d{2}$/, '').replace(/^20/, '')}

)} {openPOLastUpdated && (
Open PO: {openPOLastUpdated.replace(/:\d{2}$/, '').replace(/^20/, '')}

)} {bomLastUpdated && (
BOM: {bomLastUpdated.replace(/:\d{2}$/, '').replace(/^20/, '')}

)}
)}
{/* ëª¨ë°”ì¼ìš© ì—…ë¡œë“œ ë²„íŠ¼ */}
setDarkMode(!darkMode)} className="p-2 bg-white/20 hover:bg-white/30 rounded-lg transition" > {darkMode ? : } setShowNotificationCenter(true)} className="p-2 bg-white/20 hover:bg-white/30 rounded-lg transition relative" > {notifications.filter(n => !n.read).length > 0 && ( {notifications.filter(n => !n.read).length} )} setShowDataUploadModal(true)} className="p-2 bg-white/20 hover:bg-white/30 rounded-lg transition" >
{/* PCìš© Nav - ìƒë‹¨ */}
{[ { id: 'dashboard', label: 'Overview', icon: BarChart3 }, { id: 'receive', label: 'ì…ê³  Cycle', icon: Database }, { id: 'kitting', label: 'Kitting L/T', icon: Package }, { id: 'pick', label: 'Kitting Cycle', icon: Clock }, { id: 'kpi', label: 'KPI', icon: TrendingUp }, { id: 'analysis', label: 'Area Analysis', icon: BarChart3 }, { id: 'locate', label: 'ìì¬ ìœ„ì¹˜', icon: Search }, { id: 'layout', label: 'ë™ ë°°ì¹˜ë„', icon: Warehouse }, { id: 'view3d', label: '3D ë·°', icon: Box }, { id: 'temphumidity', label: 'ì˜¨ìŠµë„ ê´€ë¦¬', icon: Thermometer }, { id: 'todo', label: 'TO DO', icon: Check }, ].map(tab => ( setActiveTab(tab.id)} className={`flex items-center gap-1.5 px-2.5 py-2.5 text-xs font-medium border-b-2 transition whitespace-nowrap ${ activeTab === tab.id ? 'border-indigo-600 text-indigo-600 bg-indigo-50' : darkMode ? 'border-transparent text-gray-300 hover:text-white' : 'border-transparent text-gray-600 hover:text-gray-900' }`} > {tab.label} {tab.id === 'todo' && dueSoonTodos.length > 0 && ( {dueSoonTodos.length} )} {tab.id === 'receive' && (() => { const now = new Date(); const overdueCount = receiveCycles.filter(r => { if (r.status === 'completed') return false; if (!r.startTime) return false; return (now - new Date(r.startTime)) / (1000 * 60 * 60) >= 4; }).length; return overdueCount > 0 ? ( {overdueCount} ) : null; })()} {tab.id === 'rack' && fullBins.length > 0 && ( {fullBins.length} )} ))}
{/* ëª¨ë°”ì¼ìš© í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */}
{[ { id: 'dashboard', label: 'Overview', icon: BarChart3 }, { id: 'receive', label: 'ì…ê³ ', icon: Database }, { id: 'kitting', label: 'Kitting', icon: Package }, { id: 'pick', label: 'Cycle', icon: Clock }, { id: 'more', label: 'ë”ë³´ê¸°', icon: List }, ].map(tab => ( { if (tab.id === 'more') { setShowMobileMenu(true); } else { setActiveTab(tab.id); } }} className={`flex flex-col items-center gap-1 px-3 py-1 rounded-lg transition ${ activeTab === tab.id ? 'text-indigo-600' : 'text-gray-500' }`} > {tab.label} {tab.id === 'receive' && receiveCycles.filter(r => r.status === 'in-progress').length > 0 && ( )} ))}
{/* ëª¨ë°”ì¼ ë”ë³´ê¸° ë©”ë‰´ ëª¨ë‹¬ */} {showMobileMenu && (
setShowMobileMenu(false)}>
e.stopPropagation()}>
ë©”ë‰´
{[ { id: 'dashboard', label: 'Overview', icon: BarChart3 }, { id: 'receive', label: 'ì…ê³ ', icon: Database }, { id: 'kitting', label: 'Kitting', icon: Package }, { id: 'pick', label: 'Cycle', icon: Clock }, { id: 'kpi', label: 'KPI', icon: TrendingUp }, { id: 'analysis', label: 'Analysis', icon: BarChart3 }, { id: 'todo', label: 'TO DO', icon: Check }, ].map(tab => ( { setActiveTab(tab.id); setShowMobileMenu(false); }} className={`flex flex-col items-center gap-2 p-3 rounded-xl transition ${ activeTab === tab.id ? 'bg-indigo-100 text-indigo-600' : 'bg-gray-50 text-gray-600' }`} > {tab.label} ))}
{ setShowBackupModal(true); setShowMobileMenu(false); }} className="flex items-center justify-center gap-2 p-3 bg-orange-100 text-orange-600 rounded-xl" > ë°±ì—…/ë³µì› { setShowDataUploadModal(true); setShowMobileMenu(false); }} className="flex items-center justify-center gap-2 p-3 bg-indigo-100 text-indigo-600 rounded-xl" > ë°ì´í„° ê´€ë¦¬
)} {/* Main */}
{/* No Data Message */} {inventoryData.length === 0 && activeTab !== 'pick' && activeTab !== 'receive' && activeTab !== 'todo' && activeTab !== 'kitting' && (
ì¬ê³  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤
SAPì—ì„œ ì¶”ì¶œí•œ ì¬ê³  ë¦¬ìŠ¤íŠ¸ ì—‘ì…€ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.

setShowUploadModal(true)} className="inline-flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700" > ì—‘ì…€ ì—…ë¡œë“œ
)} {/* Dashboard */} {activeTab === 'dashboard' && inventoryData.length === 0 && (
{/* ZBIN/ME2N ë¯¸ì—…ë¡œë“œ ì•Œë¦¼ */}
ğŸ“Š
ì˜¤ëŠ˜ ì¬ê³  ë°ì´í„° ë¯¸ì—…ë¡œë“œ!

ZBIN(Stock) ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.

setShowDataUploadModal(true)} className="px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 text-sm font-medium"> ì—…ë¡œë“œí•˜ê¸°
{/* Open PO ë¯¸ì—…ë¡œë“œ ì•Œë¦¼ */} {showOpenPOAlert && (
ğŸ“‹
Open PO ë°ì´í„° ë¯¸ì—…ë¡œë“œ!

ME2N(Open PO) ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.

setShowOpenPOModal(true)} className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm font-medium"> ì—…ë¡œë“œí•˜ê¸°
)} {/* ì˜¨ìŠµë„ ë¯¸ì…ë ¥ ì•Œë¦¼ */} {showTempAlert && (
ğŸŒ¡ï¸
ì˜¨ìŠµë„ ë¯¸ì…ë ¥!

ì˜¤ëŠ˜ì˜ ì˜¨ë„/ìŠµë„ê°€ ì•„ì§ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

setActiveTab('temphumidity')} className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium"> ì…ë ¥í•˜ëŸ¬ ê°€ê¸°
)}
)} {activeTab === 'dashboard' && inventoryData.length > 0 && (
{/* ì˜¨ìŠµë„ ë¯¸ì…ë ¥ ì•Œë¦¼ ë°°ë„ˆ */} {showTempAlert && (
ğŸŒ¡ï¸
ì˜¨ìŠµë„ ë¯¸ì…ë ¥!

ì˜¤ëŠ˜ì˜ ì˜¨ë„/ìŠµë„ê°€ ì•„ì§ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì˜¨ìŠµë„ ê´€ë¦¬ íƒ­ì—ì„œ ì…ë ¥í•´ì£¼ì„¸ìš”.

setActiveTab('temphumidity')} className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium"> ì…ë ¥í•˜ëŸ¬ ê°€ê¸°
)} {/* ì¬ê³  ë°ì´í„° ë¯¸ì—…ë¡œë“œ ì•Œë¦¼ */} {showUploadAlert && (
ğŸ“Š
ì˜¤ëŠ˜ ì¬ê³  ë°ì´í„° ë¯¸ì—…ë¡œë“œ!

ZBIN(Stock) ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.

setShowDataUploadModal(true)} className="px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 text-sm font-medium"> ì—…ë¡œë“œí•˜ê¸°
)} {/* Open PO ë¯¸ì—…ë¡œë“œ ì•Œë¦¼ */} {showOpenPOAlert && (
ğŸ“‹
Open PO ë°ì´í„° ë¯¸ì—…ë¡œë“œ!

ME2N(Open PO) ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.

setShowOpenPOModal(true)} className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm font-medium"> ì—…ë¡œë“œí•˜ê¸°
)} {/* C3 ê°œì„ : ì—…ë°ì´íŠ¸ í•„ìš” ì•Œë¦¼ ë°°ë„ˆ */} {(() => { if (!lastUpdated) return null; const lastUpdateDate = new Date(lastUpdated.replace(/\. /g, '-').replace('.', '')); const hoursSinceUpdate = (new Date() - lastUpdateDate) / (1000 * 60 * 60); const needsUpdate = hoursSinceUpdate > 24; if (needsUpdate) { return (
ì¬ê³  ë°ì´í„° ê°±ì‹  í•„ìš”

ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {lastUpdated} ({Math.floor(hoursSinceUpdate)}ì‹œê°„ ì „)

setShowUploadModal(true)} className="px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 flex items-center gap-2" > SAP Stock ì—…ë¡œë“œ
); } return null; })()} {/* ì…ê³  ë¯¸ì²˜ë¦¬ ì•Œë¦¼ - 1ì¼ ì´ìƒ ê²½ê³¼ */} {(() => { const now = new Date(); const overdueReceives = receiveCycles.filter(r => { if (r.status === 'completed') return false; if (!r.startTime) return false; const startTime = new Date(r.startTime); const hoursPassed = (now - startTime) / (1000 * 60 * 60); return hoursPassed >= 4; // 4ì‹œê°„ ì´ìƒ ê²½ê³¼ }); if (overdueReceives.length > 0) { return (
âš ï¸ ì…ê³  ë¯¸ì²˜ë¦¬ {overdueReceives.length}ê±´

4ì‹œê°„ ì´ìƒ MIGO ë¯¸ì™„ë£Œ: {overdueReceives.map(r => `${r.vendor}(No.${r.poNo})`).join(', ')}

setActiveTab('receive')} className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 flex items-center gap-2" > ì…ê³  Cycle ì´ë™
); } return null; })()} {/* KPI - ì „ì›” ëŒ€ë¹„ ì¦ê° í‘œì‹œ */}
{(() => { // ì´ë²ˆ ë‹¬ê³¼ ì§€ë‚œ ë‹¬ ë°ì´í„° ë¶„ë¦¬ const now = new Date(); const thisMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`; const lastMonthDate = new Date(now.getFullYear(), now.getMonth() - 1, 1); const lastMonth = `${lastMonthDate.getFullYear()}-${String(lastMonthDate.getMonth() + 1).padStart(2, '0')}`; // ë¶ˆì¶œì‹œê°„ - ì´ë²ˆ ë‹¬ vs ì§€ë‚œ ë‹¬ const thisMonthPicks = pickCycles.filter(p => p.status === 'completed' && p.cycleMin && p.completed?.startsWith(thisMonth)); const lastMonthPicks = pickCycles.filter(p => p.status === 'completed' && p.cycleMin && p.completed?.startsWith(lastMonth)); const thisMonthPickAvg = thisMonthPicks.length > 0 ? thisMonthPicks.reduce((s, p) => s + p.cycleMin, 0) / thisMonthPicks.length : 0; const lastMonthPickAvg = lastMonthPicks.length > 0 ? lastMonthPicks.reduce((s, p) => s + p.cycleMin, 0) / lastMonthPicks.length : 0; const pickDiff = lastMonthPickAvg > 0 ? thisMonthPickAvg - lastMonthPickAvg : 0; // ì…ê³ ì‹œê°„ - ì´ë²ˆ ë‹¬ vs ì§€ë‚œ ë‹¬ const thisMonthReceives = receiveCycles.filter(r => r.status === 'completed' && r.cycleMin && r.migo?.startsWith(thisMonth)); const lastMonthReceives = receiveCycles.filter(r => r.status === 'completed' && r.cycleMin && r.migo?.startsWith(lastMonth)); const thisMonthReceiveAvg = thisMonthReceives.length > 0 ? thisMonthReceives.reduce((s, r) => s + r.cycleMin, 0) / thisMonthReceives.length : 0; const lastMonthReceiveAvg = lastMonthReceives.length > 0 ? lastMonthReceives.reduce((s, r) => s + r.cycleMin, 0) / lastMonthReceives.length : 0; const receiveDiff = lastMonthReceiveAvg > 0 ? thisMonthReceiveAvg - lastMonthReceiveAvg : 0; // ë¦¬ë“œíƒ€ì„ - ì´ë²ˆ ë‹¬ vs ì§€ë‚œ ë‹¬ const thisMonthKittings = kittingData.filter(k => k.status === 'completed' && k.leadTimeDays && k.completedAt?.startsWith(thisMonth)); const lastMonthKittings = kittingData.filter(k => k.status === 'completed' && k.leadTimeDays && k.completedAt?.startsWith(lastMonth)); const thisMonthLeadAvg = thisMonthKittings.length > 0 ? thisMonthKittings.reduce((s, k) => s + k.leadTimeDays, 0) / thisMonthKittings.length : 0; const lastMonthLeadAvg = lastMonthKittings.length > 0 ? lastMonthKittings.reduce((s, k) => s + k.leadTimeDays, 0) / lastMonthKittings.length : 0; const leadDiff = lastMonthLeadAvg > 0 ? thisMonthLeadAvg - lastMonthLeadAvg : 0; return ( <>
setShowReceiveDetailModal(true)} >
í‰ê·  ì…ê³ ì‹œê°„ â–¶ í´ë¦­

{avgReceiveTime.toFixed(0)}ë¶„

0 ? 'text-red-500' : receiveDiff < 0 ? 'text-green-500' : 'text-gray-400'}`}> {receiveDiff !== 0 ? (receiveDiff > 0 ? 'â†‘' : 'â†“') + Math.abs(receiveDiff).toFixed(0) + 'ë¶„' : '-'} ì „ì›”ëŒ€ë¹„
ì™„ë£Œ {receiveCycles.filter(r => r.status === 'completed').length}ê±´ ê¸°ì¤€

setShowLeadTimeDetailModal(true)} >
í‰ê·  Kitting ë¦¬ë“œíƒ€ì„ â–¶ í´ë¦­

{avgLeadTime.toFixed(1)}ì¼

0 ? 'text-red-500' : leadDiff < 0 ? 'text-green-500' : 'text-gray-400'}`}> {leadDiff !== 0 ? (leadDiff > 0 ? 'â†‘' : 'â†“') + Math.abs(leadDiff).toFixed(1) + 'ì¼' : '-'} ì „ì›”ëŒ€ë¹„
Kitting ì™„ë£Œ {kittingData.filter(k => k.status === 'completed').length}ê±´ ê¸°ì¤€

setShowPickDetailModal(true)} >
í‰ê·  Kitting ì‹œê°„ â–¶ í´ë¦­

{avgPickTime.toFixed(0)}ë¶„

0 ? 'text-red-500' : pickDiff < 0 ? 'text-green-500' : 'text-gray-400'}`}> {pickDiff !== 0 ? (pickDiff > 0 ? 'â†‘' : 'â†“') + Math.abs(pickDiff).toFixed(0) + 'ë¶„' : '-'} ì „ì›”ëŒ€ë¹„
ì™„ë£Œ {pickCycles.filter(p => p.status === 'completed').length}ê±´ ê¸°ì¤€

); })()}
{/* ì£¼ê°„ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ */}
ğŸ“Š ì£¼ê°„ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ
{/* ğŸ­ ìƒì‚° ê°€ëŠ¥ ëŒ€ìˆ˜ */}
ğŸ­ ëª¨ë¸ë³„ ìƒì‚° ê°€ëŠ¥ ëŒ€ìˆ˜
{lastUpdated && ( { const lastUpdateDate = new Date(lastUpdated.replace(/\. /g, '-').replace('.', '')); const hoursSinceUpdate = (new Date() - lastUpdateDate) / (1000 * 60 * 60); return hoursSinceUpdate > 24 ? 'bg-amber-100 text-amber-700' : 'bg-green-100 text-green-700'; })() }`}> ğŸ“… {lastUpdated} )}
{/* ìš”ì•½ ì¹´ë“œ */} {(() => { const TARGET_STOCK = { 'RSC16': { min: 10, max: 30 }, 'CSC16': { min: 5, max: 10 }, 'FSC16': { min: 2, max: 2 }, 'RSC48': { min: 10, max: 20 }, 'CSC48': { min: 3, max: 10 }, 'HSM3': { min: 1, max: 5 } }; const modelStatus = Object.entries(TARGET_STOCK).map(([model, range]) => { const info = MODEL_WEIGHTS[model]; const currentStock = inventoryData.filter(i => i.material === info?.code).reduce((sum, i) => sum + (i.stock || 0), 0); let status = 'ok'; if (currentStock > range.max) status = 'over'; else if (currentStock >= range.min) status = 'ok'; else if (currentStock >= range.min * 0.5) status = 'warning'; else status = 'shortage'; return { model, currentStock, status }; }); const overStock = modelStatus.filter(m => m.status === 'over'); const okStock = modelStatus.filter(m => m.status === 'ok'); const warningStock = modelStatus.filter(m => m.status === 'warning'); const shortageStock = modelStatus.filter(m => m.status === 'shortage'); return (
setShowModelDetailModal('excess')} >
ğŸ“¦ ê³¼ë‹¤ ì¬ê³ 

{overStock.length}ëª¨ë¸

setShowModelDetailModal('normal')} >
âœ… ì ì • ì¬ê³ 

{okStock.length}ëª¨ë¸

setShowModelDetailModal('caution')} >
âš ï¸ ë¶€ì¡± ì£¼ì˜

{warningStock.length}ëª¨ë¸

setShowModelDetailModal('urgent')} >
ğŸš¨ ë¶€ì¡± ê¸´ê¸‰

{shortageStock.length}ëª¨ë¸

); })()} {/* ìƒ‰ìƒ ë²”ë¡€ */}
ê³¼ë‹¤ (ìµœëŒ€ ì´ˆê³¼) ì ì • (ìµœì†Œ~ìµœëŒ€) ì£¼ì˜ (ìµœì†Œì˜ 50% ì´ìƒ) ê¸´ê¸‰ (ìµœì†Œì˜ 50% ë¯¸ë§Œ)
{/* ëª¨ë¸ ëª©ë¡ - ì¹´ë“œ ë°•ìŠ¤ í˜•ì‹ */}
{/* Maxwell 16 ì‹œë¦¬ì¦ˆ */}
16 Maxwell 16 ì‹œë¦¬ì¦ˆ
{Object.entries(MODEL_WEIGHTS).filter(([_, info]) => info.series === '16').map(([model, info]) => { const prodInfo = producibleUnits[model] || { units: 0, coverage: '0' }; const TARGET = { RSC16: { min: 10, max: 30 }, CSC16: { min: 5, max: 10 }, FSC16: { min: 2, max: 2 } }; const range = TARGET[model] || { min: 10, max: 30 }; const currentStock = inventoryData.filter(i => i.material === info.code).reduce((sum, i) => sum + (i.stock || 0), 0); const status = currentStock > range.max ? 'over' : currentStock >= range.min ? 'ok' : currentStock >= range.min * 0.5 ? 'warning' : 'shortage'; const bgColor = status === 'over' ? 'bg-purple-50 border-purple-300' : status === 'ok' ? 'bg-emerald-50 border-emerald-300' : status === 'warning' ? 'bg-amber-50 border-amber-300' : 'bg-red-50 border-red-300'; const textColor = status === 'over' ? 'text-purple-700' : status === 'ok' ? 'text-emerald-700' : status === 'warning' ? 'text-amber-700' : 'text-red-700'; const statusLabel = status === 'over' ? 'ê³¼ë‹¤' : status === 'ok' ? 'ì ì •' : status === 'warning' ? 'ì£¼ì˜' : 'ê¸´ê¸‰'; const statusIcon = status === 'over' ? 'ğŸ“¦' : status === 'ok' ? 'âœ…' : status === 'warning' ? 'âš ï¸' : 'ğŸš¨'; return (
{model}

{info.code}

{statusIcon} {statusLabel}
{prodInfo.units}ëŒ€

Safety Stock: {range.min}~{range.max}ëŒ€

í˜„ì¬ ì¬ê³ : {currentStock.toLocaleString()} EA

{prodInfo.bottleneck && (
ë³‘ëª©: {prodInfo.bottleneck.material} | {prodInfo.bottleneck.description?.slice(0, 15) || '-'} | ì¬ê³ : {prodInfo.bottleneck.currentStock} EA {(() => { const openPO = getOpenPOForMaterial(prodInfo.bottleneck.material); return openPO ? ( | ğŸ“¦ {openPO.totalQty.toLocaleString()} {openPO.unit} ) : ( | âš ï¸ Open PO ì—†ìŒ ); })()}

)}
); })}
{/* Maxwell 48 ì‹œë¦¬ì¦ˆ */}
48 Maxwell 48 ì‹œë¦¬ì¦ˆ
{Object.entries(MODEL_WEIGHTS).filter(([_, info]) => info.series === '48').map(([model, info]) => { const prodInfo = producibleUnits[model] || { units: 0, coverage: '0' }; const TARGET = { RSC48: { min: 10, max: 20 }, CSC48: { min: 3, max: 10 } }; const range = TARGET[model] || { min: 10, max: 20 }; const currentStock = inventoryData.filter(i => i.material === info.code).reduce((sum, i) => sum + (i.stock || 0), 0); const status = currentStock > range.max ? 'over' : currentStock >= range.min ? 'ok' : currentStock >= range.min * 0.5 ? 'warning' : 'shortage'; const bgColor = status === 'over' ? 'bg-purple-50 border-purple-300' : status === 'ok' ? 'bg-emerald-50 border-emerald-300' : status === 'warning' ? 'bg-amber-50 border-amber-300' : 'bg-red-50 border-red-300'; const textColor = status === 'over' ? 'text-purple-700' : status === 'ok' ? 'text-emerald-700' : status === 'warning' ? 'text-amber-700' : 'text-red-700'; const statusLabel = status === 'over' ? 'ê³¼ë‹¤' : status === 'ok' ? 'ì ì •' : status === 'warning' ? 'ì£¼ì˜' : 'ê¸´ê¸‰'; const statusIcon = status === 'over' ? 'ğŸ“¦' : status === 'ok' ? 'âœ…' : status === 'warning' ? 'âš ï¸' : 'ğŸš¨'; return (
{model}

{info.code}

{statusIcon} {statusLabel}
{prodInfo.units}ëŒ€

Safety Stock: {range.min}~{range.max}ëŒ€

í˜„ì¬ ì¬ê³ : {currentStock.toLocaleString()} EA

{prodInfo.bottleneck && (
ë³‘ëª©: {prodInfo.bottleneck.material} | {prodInfo.bottleneck.description?.slice(0, 15) || '-'} | ì¬ê³ : {prodInfo.bottleneck.currentStock} EA {(() => { const openPO = getOpenPOForMaterial(prodInfo.bottleneck.material); return openPO ? ( | ğŸ“¦ {openPO.totalQty.toLocaleString()} {openPO.unit} ) : ( | âš ï¸ Open PO ì—†ìŒ ); })()}

)}
); })} {/* ë¹ˆ ì¹´ë“œë¡œ ì •ë ¬ ë§ì¶”ê¸° */}
-
{/* HSM ì‹œë¦¬ì¦ˆ */}
HSM HSM ì‹œë¦¬ì¦ˆ
{Object.entries(MODEL_WEIGHTS).filter(([_, info]) => info.series === 'HSM').map(([model, info]) => { const prodInfo = producibleUnits[model] || { units: 0, coverage: '0' }; const range = { min: 1, max: 5 }; const currentStock = inventoryData.filter(i => i.material === info.code).reduce((sum, i) => sum + (i.stock || 0), 0); const status = currentStock > range.max ? 'over' : currentStock >= range.min ? 'ok' : currentStock >= range.min * 0.5 ? 'warning' : 'shortage'; const bgColor = status === 'over' ? 'bg-purple-50 border-purple-300' : status === 'ok' ? 'bg-emerald-50 border-emerald-300' : status === 'warning' ? 'bg-amber-50 border-amber-300' : 'bg-red-50 border-red-300'; const textColor = status === 'over' ? 'text-purple-700' : status === 'ok' ? 'text-emerald-700' : status === 'warning' ? 'text-amber-700' : 'text-red-700'; const statusLabel = status === 'over' ? 'ê³¼ë‹¤' : status === 'ok' ? 'ì ì •' : status === 'warning' ? 'ì£¼ì˜' : 'ê¸´ê¸‰'; const statusIcon = status === 'over' ? 'ğŸ“¦' : status === 'ok' ? 'âœ…' : status === 'warning' ? 'âš ï¸' : 'ğŸš¨'; return (
{model}

{info.code}

{statusIcon} {statusLabel}
{prodInfo.units}ëŒ€

Safety Stock: {range.min}~{range.max}ëŒ€

í˜„ì¬ ì¬ê³ : {currentStock.toLocaleString()} EA

{prodInfo.bottleneck && (
ë³‘ëª©: {prodInfo.bottleneck.material} | {prodInfo.bottleneck.description?.slice(0, 15) || '-'} | ì¬ê³ : {prodInfo.bottleneck.currentStock} EA {(() => { const openPO = getOpenPOForMaterial(prodInfo.bottleneck.material); return openPO ? ( | ğŸ“¦ {openPO.totalQty.toLocaleString()} {openPO.unit} ) : ( | âš ï¸ Open PO ì—†ìŒ ); })()}

)}
); })} {/* ë¹ˆ ì¹´ë“œë¡œ ì •ë ¬ ë§ì¶”ê¸° */}
-
-
ğŸ’¡ ë³‘ëª© ìì¬ = ê°€ì¥ ë¨¼ì € ì†Œì§„ë˜ëŠ” ìì¬. í•´ë‹¹ ìì¬ ì¬ê³  ë¶€ì¡± ì‹œ ìƒì‚° ë¶ˆê°€.

{/* ğŸ”§ Sub-component ìƒì‚° ê°€ëŠ¥ ëŒ€ìˆ˜ */} {subComponentBomData && Object.keys(subComponentBomData).length > 0 && (
ğŸ”§ Sub-component ìƒì‚° ê°€ëŠ¥ ëŒ€ìˆ˜
{Object.keys(subComponentBomData).length}ê°œ Sub-com
{/* ìš”ì•½ ì¹´ë“œ */} {(() => { const SUBCOM_SAFETY = { min: 10, max: 50 }; // Sub-component Safety Stock ê¸°ì¤€ const SUBCOM_SAFETY_KB0770 = { min: 20, max: 100 }; // KB0770ì€ 1ëŒ€ë‹¹ 2EA ì‚¬ìš© const subComStatus = Object.entries(subComponentUnits).map(([name, info]) => { const currentStock = inventoryData.filter(i => i.material === name).reduce((sum, i) => sum + (i.stock || 0), 0); const range = name === 'KB0770' ? SUBCOM_SAFETY_KB0770 : SUBCOM_SAFETY; let status = 'ok'; if (currentStock > range.max) status = 'over'; else if (currentStock >= range.min) status = 'ok'; else if (currentStock >= range.min * 0.5) status = 'warning'; else status = 'shortage'; return { name, currentStock, status }; }); const overStock = subComStatus.filter(m => m.status === 'over'); const okStock = subComStatus.filter(m => m.status === 'ok'); const warningStock = subComStatus.filter(m => m.status === 'warning'); const shortageStock = subComStatus.filter(m => m.status === 'shortage'); return (
setShowSubcomDetailModal('excess')} >
ğŸ“¦ ê³¼ë‹¤ ì¬ê³ 

{overStock.length}Sub

setShowSubcomDetailModal('normal')} >
âœ… ì ì • ì¬ê³ 

{okStock.length}Sub

setShowSubcomDetailModal('caution')} >
âš ï¸ ë¶€ì¡± ì£¼ì˜

{warningStock.length}Sub

setShowSubcomDetailModal('urgent')} >
ğŸš¨ ë¶€ì¡± ê¸´ê¸‰

{shortageStock.length}Sub

); })()} {/* ìƒ‰ìƒ ë²”ë¡€ */}
ê³¼ë‹¤ (50ëŒ€ ì´ˆê³¼, KB0770: 100ëŒ€ ì´ˆê³¼) ì ì • (10~50ëŒ€, KB0770: 20~100ëŒ€) ì£¼ì˜ (5~9ëŒ€) ê¸´ê¸‰ (5ëŒ€ ë¯¸ë§Œ)
{/* Maxwell 16 ì‹œë¦¬ì¦ˆ Sub-component */} {(() => { const subCom48 = ['KB0770', 'KB0778', 'KB0840', 'KB0768', 'KB0776', 'KB0780', 'KB0835', 'KB0775', 'KB0771']; const SUBCOM_SAFETY = { min: 10, max: 50 }; const filtered16 = Object.entries(subComponentUnits) .filter(([name]) => !subCom48.includes(name)) .sort((a, b) => a[1].units - b[1].units); if (filtered16.length === 0) return null; return (
16 Maxwell 16 ì‹œë¦¬ì¦ˆ
{filtered16.map(([subComName, info]) => { const currentStock = inventoryData.filter(i => i.material === subComName).reduce((sum, i) => sum + (i.stock || 0), 0); const range = SUBCOM_SAFETY; const status = currentStock > range.max ? 'over' : currentStock >= range.min ? 'ok' : currentStock >= range.min * 0.5 ? 'warning' : 'shortage'; const bgColor = status === 'over' ? 'bg-purple-50 border-purple-300' : status === 'ok' ? 'bg-emerald-50 border-emerald-300' : status === 'warning' ? 'bg-amber-50 border-amber-300' : 'bg-red-50 border-red-300'; const textColor = status === 'over' ? 'text-purple-700' : status === 'ok' ? 'text-emerald-700' : status === 'warning' ? 'text-amber-700' : 'text-red-700'; const statusLabel = status === 'over' ? 'ê³¼ë‹¤' : status === 'ok' ? 'ì ì •' : status === 'warning' ? 'ì£¼ì˜' : 'ê¸´ê¸‰'; const statusIcon = status === 'over' ? 'ğŸ“¦' : status === 'ok' ? 'âœ…' : status === 'warning' ? 'âš ï¸' : 'ğŸš¨'; return (
{subComName}

{statusIcon} {statusLabel}
{info.units}ëŒ€

Safety Stock: {range.min}~{range.max}ëŒ€

í˜„ì¬ ì¬ê³ : {currentStock.toLocaleString()} EA

{info.bottleneck && info.units < 20 && (
ë³‘ëª©: {info.bottleneck.material} | ì¬ê³ : {info.bottleneck.currentStock} EA {(() => { const openPO = getOpenPOForMaterial(info.bottleneck.material); return openPO ? ( | ğŸ“¦ {openPO.totalQty.toLocaleString()} {openPO.unit} ) : ( | âš ï¸ Open PO ì—†ìŒ ); })()}

)}
); })}
); })()} {/* ì‹œë¦¬ì¦ˆ êµ¬ë¶„ì„  */}
{/* Maxwell 48 ì‹œë¦¬ì¦ˆ Sub-component */} {(() => { const subCom48 = ['KB0770', 'KB0778', 'KB0840', 'KB0768', 'KB0776', 'KB0780', 'KB0835', 'KB0775', 'KB0771']; const SUBCOM_SAFETY = { min: 10, max: 50 }; const SUBCOM_SAFETY_KB0770 = { min: 20, max: 100 }; // KB0770ì€ 1ëŒ€ë‹¹ 2EA ì‚¬ìš© const filtered48 = Object.entries(subComponentUnits) .filter(([name]) => subCom48.includes(name)) .sort((a, b) => a[1].units - b[1].units); if (filtered48.length === 0) return null; return (
48 Maxwell 48 ì‹œë¦¬ì¦ˆ
{filtered48.map(([subComName, info]) => { const currentStock = inventoryData.filter(i => i.material === subComName).reduce((sum, i) => sum + (i.stock || 0), 0); const range = subComName === 'KB0770' ? SUBCOM_SAFETY_KB0770 : SUBCOM_SAFETY; const status = currentStock > range.max ? 'over' : currentStock >= range.min ? 'ok' : currentStock >= range.min * 0.5 ? 'warning' : 'shortage'; const bgColor = status === 'over' ? 'bg-purple-50 border-purple-300' : status === 'ok' ? 'bg-emerald-50 border-emerald-300' : status === 'warning' ? 'bg-amber-50 border-amber-300' : 'bg-red-50 border-red-300'; const textColor = status === 'over' ? 'text-purple-700' : status === 'ok' ? 'text-emerald-700' : status === 'warning' ? 'text-amber-700' : 'text-red-700'; const statusLabel = status === 'over' ? 'ê³¼ë‹¤' : status === 'ok' ? 'ì ì •' : status === 'warning' ? 'ì£¼ì˜' : 'ê¸´ê¸‰'; const statusIcon = status === 'over' ? 'ğŸ“¦' : status === 'ok' ? 'âœ…' : status === 'warning' ? 'âš ï¸' : 'ğŸš¨'; return (
{subComName}

{subComName === 'KB0770' &&
1ëŒ€ë‹¹ 2EA

}
{statusIcon} {statusLabel}
{info.units}ëŒ€

Safety Stock: {range.min}~{range.max}ëŒ€

í˜„ì¬ ì¬ê³ : {currentStock.toLocaleString()} EA

{info.bottleneck && info.units < 20 && (
ë³‘ëª©: {info.bottleneck.material} | ì¬ê³ : {info.bottleneck.currentStock} EA {(() => { const openPO = getOpenPOForMaterial(info.bottleneck.material); return openPO ? ( | ğŸ“¦ {openPO.totalQty.toLocaleString()} {openPO.unit} ) : ( | âš ï¸ Open PO ì—†ìŒ ); })()}

)}
); })}
); })()}
ğŸ’¡ Sub-component = ì™„ì œí’ˆ ì¡°ë¦½ì— í•„ìš”í•œ ë°˜ì œí’ˆ/ì¡°ë¦½í’ˆ. BOM íŒŒì¼ì˜ KB ì‹œíŠ¸ ê¸°ì¤€.

)} {/* ğŸ“¦ ë°œì£¼ ì œì•ˆ */}
ğŸ’¡ ë°œì£¼ ì œì•ˆ (BOM ë³‘ëª© ìì¬ ê¸°ì¤€)
{(() => { const TARGET_STOCK = { 'RSC16': { min: 10, max: 30 }, 'CSC16': { min: 10, max: 30 }, 'FSC16': { min: 5, max: 20 }, 'RSC48': { min: 10, max: 30 }, 'CSC48': { min: 10, max: 30 }, 'HSM3': { min: 3, max: 30 } }; // ë¶€ì¡± ëª¨ë¸ì˜ ë³‘ëª© ìì¬ ìˆ˜ì§‘ const shortageItems = []; const overItems = []; Object.entries(TARGET_STOCK).forEach(([model, range]) => { const current = producibleUnits[model]?.units || 0; const bottleneck = producibleUnits[model]?.bottleneck; if (current < range.min && bottleneck) { // ë¶€ì¡±: ë°œì£¼ í•„ìš” const needQty = (range.min - current) * (bottleneck.requiredQty || 1); shortageItems.push({ model, material: bottleneck.material, description: bottleneck.description, currentStock: bottleneck.currentStock, needQty, shortage: range.min - current, min: range.min, type: 'shortage' }); } else if (current > range.max && bottleneck) { // ê³¼ë‹¤: ë°œì£¼ ì—°ê¸° overItems.push({ model, material: bottleneck.material, description: bottleneck.description, currentStock: bottleneck.currentStock, excess: current - range.max, max: range.max, type: 'over' }); } }); return (
{/* ë°œì£¼ í•„ìš” (ë¶€ì¡±) */} {shortageItems.length > 0 && (
ğŸš¨ ë°œì£¼ í•„ìš” (ë¶€ì¡± ìì¬)
{shortageItems.map((item, idx) => { const openPO = getOpenPOForMaterial(item.material); return ( ); })}
ëª¨ë¸	ë³‘ëª© ìì¬	Description	í˜„ì¬ ì¬ê³ 	ë¶€ì¡± ëŒ€ìˆ˜	ì œì•ˆ	Open PO
{item.model}	{item.material}	{item.description?.slice(0, 25) || '-'}	{item.currentStock?.toLocaleString()} EA	-{item.shortage}ëŒ€	{openPO ? ( ğŸ“¦ ë°œì£¼ ì§„í–‰ ì¤‘ ) : ( ğŸ›’ ë°œì£¼ í•„ìš” )}	{openPO ? ( ğŸ“¦ {openPO.totalQty.toLocaleString()} {openPO.unit} ) : ( - )}
)} {/* ë°œì£¼ ì—°ê¸° (ê³¼ë‹¤) */} {overItems.length > 0 && (
ğŸ“¦ ë°œì£¼ ì—°ê¸° ê²€í†  (ê³¼ë‹¤ ì¬ê³ )
{overItems.map((item, idx) => ( ))}
ëª¨ë¸	ë³‘ëª© ìì¬	Description	í˜„ì¬ ì¬ê³ 	ì´ˆê³¼ ëŒ€ìˆ˜	ì œì•ˆ
{item.model}	{item.material}	{item.description?.slice(0, 25) || '-'}	{item.currentStock?.toLocaleString()} EA	+{item.excess}ëŒ€	ğŸ“… ë°œì£¼ ì—°ê¸°
)} {shortageItems.length === 0 && overItems.length === 0 && (
âœ… ëª¨ë“  ëª¨ë¸ì´ ì ì • ì¬ê³  ë²”ìœ„ ë‚´ì…ë‹ˆë‹¤.

)}
); })()}
{/* A1 ê°œì„ : ë¶€ì¡± ìì¬ ìƒì„¸ ëª©ë¡ + Open PO ë§¤ì¹­ */}
ğŸš¨ ë¶€ì¡±/ì €ì¬ê³  ìì¬ í˜„í™© (Open PO ë§¤ì¹­) {customBomData && ì‚¬ìš©ì BOM}
{(() => { // ëª¨ë“  ëª¨ë¸ì˜ BOMì„ ê²€ì‚¬í•˜ì—¬ ë¶€ì¡± ìì¬ ìˆ˜ì§‘ const allShortages = []; const stockByMaterial = {}; const descByMaterial = {}; inventoryData.forEach(item => { stockByMaterial[item.material] = (stockByMaterial[item.material] || 0) + item.stock; descByMaterial[item.material] = item.description || ''; }); // ëª¨ë¸ë³„ BOM ê²€ì‚¬ (ì‚¬ìš©ì BOM ë˜ëŠ” ê¸°ë³¸ BOM) const bomToUse = customBomData || MODEL_BOM_DATA; Object.entries(bomToUse).forEach(([model, bom]) => { Object.entries(bom).forEach(([material, requiredQty]) => { const currentStock = stockByMaterial[material] || 0; const possibleUnits = Math.floor(currentStock / requiredQty); // ëª¨ë¸ë³„ ë¶€ì¡± ê¸°ì¤€: HSM3=3ëŒ€, ë‚˜ë¨¸ì§€=10ëŒ€ const threshold = (model === 'HSM3' || model === 'HSM3.0') ? 3 : 10; if (possibleUnits < threshold && requiredQty > 0) { const openPO = openPOData.find(po => po.material === material); const existingIdx = allShortages.findIndex(s => s.material === material); if (existingIdx === -1) { allShortages.push({ material, description: descByMaterial[material] || openPO?.description || '-', currentStock, requiredQty, possibleUnits, models: [model], openPO: openPO ? { qty: openPO.totalQty, unit: openPO.unit, poNumbers: openPO.poNumbers } : null, urgency: possibleUnits === 0 ? 'critical' : possibleUnits < Math.ceil(threshold/2) ? 'high' : 'medium' }); } else { if (!allShortages[existingIdx].models.includes(model)) { allShortages[existingIdx].models.push(model); } } } }); }); // ê¸´ê¸‰ë„ ìˆœìœ¼ë¡œ ì •ë ¬ allShortages.sort((a, b) => { const urgencyOrder = { critical: 0, high: 1, medium: 2 }; return urgencyOrder[a.urgency] - urgencyOrder[b.urgency] || a.possibleUnits - b.possibleUnits; }); const criticalCount = allShortages.filter(s => s.urgency === 'critical').length; const highCount = allShortages.filter(s => s.urgency === 'high').length; const withPOCount = allShortages.filter(s => s.openPO).length; const noPOCount = allShortages.filter(s => !s.openPO).length; return (
{/* ìš”ì•½ ì¹´ë“œ */}
setShowShortageDetailModal('critical')}>
{criticalCount}

ìƒì‚°ë¶ˆê°€ (0ëŒ€)

setShowShortageDetailModal('high')}>
{highCount}

ê¸´ê¸‰ (1~4ëŒ€)

setShowShortageDetailModal('withPO')}>
{withPOCount}

ë°œì£¼ ì§„í–‰ì¤‘

setShowShortageDetailModal('noPO')}>
{noPOCount}

ë°œì£¼ í•„ìš”

{/* ë¶€ì¡± ìì¬ í…Œì´ë¸” */} {allShortages.length > 0 ? (
{allShortages.slice(0, 20).map((item, idx) => ( ))}
ê¸´ê¸‰ë„	Material	Description	í˜„ì¬ì¬ê³ 	ìƒì‚°ê°€ëŠ¥	í•´ë‹¹ëª¨ë¸	Open PO
{item.urgency === 'critical' ? 'ğŸ”´ ê¸´ê¸‰' : item.urgency === 'high' ? 'ğŸŸ  ì£¼ì˜' : 'ğŸŸ¡ ê´€ì°°'}	{item.material}	{item.description?.slice(0, 30) || '-'}	{item.currentStock.toLocaleString()}	{item.possibleUnits}ëŒ€	
{item.models.slice(0, 3).map((m, i) => ( {m} ))} {item.models.length > 3 && ( +{item.models.length - 3} )}
{item.openPO ? (
âœ… {item.openPO.qty.toLocaleString()} {item.openPO.unit} {item.openPO.poNumbers?.length > 0 && ( PO: {item.openPO.poNumbers[0]} )}
) : ( âŒ ë°œì£¼ í•„ìš” )}
{allShortages.length > 20 && (
... ì™¸ {allShortages.length - 20}ê°œ ìì¬

)}
) : (
âœ… ëª¨ë“  ìì¬ê°€ ì¶©ë¶„í•©ë‹ˆë‹¤. (ê¸°ì¤€: 10ëŒ€, HSM3: 3ëŒ€ ì´ìƒ)

)}
ğŸ’¡ ê¸°ì¤€: 10ëŒ€ ë¯¸ë§Œ ìƒì‚° ê°€ëŠ¥í•œ ìì¬ë¥¼ ë¶€ì¡± ìì¬ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤ (HSM3: 3ëŒ€ ë¯¸ë§Œ). Open PO ë°ì´í„°ëŠ” ë§ˆì§€ë§‰ ì—…ë¡œë“œ ê¸°ì¤€ì…ë‹ˆë‹¤.

); })()}
{/* Area Summary */}
ğŸ“ Areaë³„ í˜„í™©
{['A', 'B', 'C', 'D', 'E', 'F', 'S'].map(zone => { const zoneRacks = rackSummary.filter(r => r.zone === zone); const zoneStock = zoneRacks.reduce((s, r) => s + r.stock, 0); const zoneItems = zoneRacks.reduce((s, r) => s + r.items, 0); if (zoneRacks.length === 0) return null; return (
{zone} Area

{zoneRacks.length}ê°œ ë™

{zoneItems}ê°œ í’ˆëª©

{zoneStock.toLocaleString()} EA

); })}
)} {/* ğŸ“ ìì¬ ìœ„ì¹˜ ê²€ìƒ‰ */} {activeTab === 'locate' && (
{/* ê²€ìƒ‰ í—¤ë” */}
ğŸ“ ìì¬ ìœ„ì¹˜ ê²€ìƒ‰
Material ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´ ì°½ê³  ë‚´ ë³´ê´€ ìœ„ì¹˜ë¥¼ ì•ˆë‚´í•©ë‹ˆë‹¤.

{locateSearch
 { setLocateSearch(e.target.value); if(locateQuery) setLocateQuery(''); }} onKeyDown={e => { if(e.key === 'Enter'){setLocateQuery(locateSearch);} }} /> {/* ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ */} {locateSearch && locateSearch.length >= 2 && !locateQuery && inventoryData.length > 0 && (() => { const q = locateSearch.trim().toUpperCase(); const suggestions = inventoryData.filter(item => (item.material || '').toUpperCase().includes(q) || (item.description || '').toUpperCase().includes(q) ).reduce((acc, item) => { if (!acc.find(a => a.material === item.material)) acc.push(item); return acc; }, []).slice(0, 8); if (suggestions.length === 0) return null; return (
{suggestions.map((s, i) => ( { setLocateSearch(s.material); setLocateQuery(s.material); }} > {s.material} {s.description} {s.bin} ))}
); })()}
setLocateQuery(locateSearch)} className="px-6 py-3 bg-amber-500 hover:bg-amber-600 rounded-lg font-bold text-lg transition shrink-0" > ğŸ” ê²€ìƒ‰
{/* ê²€ìƒ‰ ê²°ê³¼ */} {locateQuery && (() => { const q = locateQuery.trim().toUpperCase(); // inventoryDataì—ì„œ Part No. ë§¤ì¹­ const matches = inventoryData.filter(item => (item.material || '').toUpperCase().includes(q) || (item.description || '').toUpperCase().includes(q) ); if (matches.length === 0) { return (
ğŸ”

"{locateQuery}" ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.

SAP ì¬ê³  ë°ì´í„°ì— ë“±ë¡ëœ Material ë²ˆí˜¸ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.

); } // Binë³„ ê·¸ë£¹í•‘ const binGroups = {}; matches.forEach(item => { const bin = item.bin || 'Unknown'; if (!binGroups[bin]) binGroups[bin] = []; binGroups[bin].push(item); }); // ê° Binì˜ ìœ„ì¹˜ ì •ë³´ ë§¤í•‘ const locationResults = Object.entries(binGroups).map(([bin, items]) => { const area = bin.split('-')[0] || bin; const series = RACK_MODEL_SERIES[area] || 'ê¸°íƒ€'; const binInfo = BIN_RACK_INFO[bin] || { rackType: 'ê²½ëŸ‰ë™', rackCount: 1 }; // BIN_LEVEL_MAPì—ì„œ ì‹¤ì œ ë‹¨ìˆ˜/ìœ„ì¹˜ ì¡°íšŒ const blm = BIN_LEVEL_MAP[bin] || {l: binInfo.shelves || 3, p: 1}; const levels = blm.l; const rackLevel = blm.p; const totalStock = items.reduce((s, i) => s + (i.stock || 0), 0); const totalWeight = items.reduce((s, i) => s + ((weightData[i.material]?.w || 0) * (i.stock || 0)), 0); return { bin, area, series, binInfo, levels, rackLevel, items, totalStock, totalWeight }; }); const seriesColor = { 'Maxwell 48': { bg: 'bg-red-50', border: 'border-red-400', text: 'text-red-700', badge: 'bg-red-500' }, 'Maxwell 16': { bg: 'bg-blue-50', border: 'border-blue-400', text: 'text-blue-700', badge: 'bg-blue-500' }, 'HSM 3.0': { bg: 'bg-orange-50', border: 'border-orange-400', text: 'text-orange-700', badge: 'bg-orange-500' }, 'ê¸°íƒ€': { bg: 'bg-gray-50', border: 'border-gray-400', text: 'text-gray-700', badge: 'bg-gray-500' } }; return (
{/* ìš”ì•½ */}
ê²€ìƒ‰: {locateQuery} {matches.length}ê°œ í’ˆëª© {Object.keys(binGroups).length}ê°œ Bin ì´ {matches.reduce((s,i) => s + (i.stock||0), 0).toLocaleString()} EA
{/* Binë³„ ìœ„ì¹˜ ì¹´ë“œ â€” ì»´íŒ©íŠ¸ */} {locationResults.sort((a,b) => a.bin.localeCompare(b.bin)).map((loc, idx) => { const sc = seriesColor[loc.series] || seriesColor['ê¸°íƒ€']; return (
{/* ì¹´ë“œ í—¤ë” â€” ì»´íŒ©íŠ¸ */}
{loc.series}
ğŸ“ {loc.bin}
{loc.binInfo.rackType} Â· {loc.levels}ë‹¨
{loc.items.length}ê°œ í’ˆëª© Â· {loc.totalStock.toLocaleString()} EA
{/* ë™(ì™¼) + í’ˆëª©(ì¤‘ê°„, ë‹¨ ë§ì¶¤) + ë¯¸ë‹ˆë§µ(ì˜¤ë¥¸) */}
{/* SVG ë™ ì¼ëŸ¬ìŠ¤íŠ¸ */} {(() => { const lvls = loc.levels; const shelfH = 48, pad = 8, pillarW = 8; const svgW = 160, svgH = lvls * shelfH + pad * 2 + 10; return (); })()} {/* í’ˆëª© â€” í•´ë‹¹ ë‹¨ ë†’ì´+í¬ê¸°ì— ë§ì¶¤ */}
{Array.from({length: loc.levels}, (_, i) => { const levelNum = i + 1; const isHere = levelNum === loc.rackLevel; return (
{isHere ? (
{loc.items.slice(0, 3).map((item, j) => (
{item.material} {item.description} {(item.stock||0).toLocaleString()} EA
))} {loc.items.length > 3 && ì™¸ {loc.items.length-3}ê°œ}
) : null}
); })}
{/* ë¯¸ë‹ˆë§µ (ì˜¤ë¥¸ìª½ ê³ ì •) */}
{ setActiveTab('layout'); }} className="text-xs px-3 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600 transition"> ğŸ—ºï¸ ë°°ì¹˜ë„ì—ì„œ ë³´ê¸° Â· {loc.area}
); })} {/* ì „ì²´ ê²°ê³¼ í…Œì´ë¸” */} {matches.length > 3 && (
ğŸ“‹ ì „ì²´ ê²€ìƒ‰ ê²°ê³¼ ({matches.length}ê±´)
{matches.map((item, i) => { const area = (item.bin||'').split('-')[0]; const series = RACK_MODEL_SERIES[area] || 'ê¸°íƒ€'; return ( ); })}
Material	Description	Bin	ì˜ì—­	ì‹œë¦¬ì¦ˆ	ì¬ê³ 
{item.material}	{item.description}	{item.bin}	{area}	{series}	{(item.stock||0).toLocaleString()}
)}
); })()} {/* ì´ˆê¸° ì•ˆë‚´ */} {!locateQuery && (
ğŸ“¦

Material ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì—¬ ìì¬ ìœ„ì¹˜ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”

Material ë²ˆí˜¸ ë˜ëŠ” Descriptionìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{['710335', '712626', 'KB0781', 'Motor', 'Heater'].map(ex => ( { setLocateSearch(ex); setLocateQuery(ex); }} className="px-3 py-1.5 bg-gray-100 hover:bg-indigo-100 text-sm text-gray-600 rounded-lg transition"> {ex} ))}
)}
)} {/* ğŸ­ ë™ ë°°ì¹˜ë„ ì—ë””í„° (ì¸ë¼ì¸ ì„ë² ë”©) */} {activeTab === 'layout' && (
ğŸ­ ì°½ê³  ë™ ë°°ì¹˜ë„ ì—ë””í„°
ê·¸ë¦¬ë“œ 1ì¹¸ = 0.5m (50cm) | ìƒì‚°ì°½ê³  117.91í‰ Â· ìƒì‚°ë¼ì¸+ì°½ê³  195.01í‰
ğŸ’¡ ì´ë™(V): í™”ë©´ ìŠ¤í¬ë¡¤ Â· ì„ íƒ(S): ë™ ì„ íƒ/ì´ë™ Â· ì¸¡ì •(M): ê±°ë¦¬ ì¸¡ì • Â· í…ìŠ¤íŠ¸(T): ë¼ë²¨ ì¶”ê°€
